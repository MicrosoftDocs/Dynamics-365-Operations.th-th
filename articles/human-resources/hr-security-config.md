---
title: แนวคิดเกี่ยวกับการตั้งค่าคอนฟิกความปลอดภัยสำหรับตารางเสมือนตามข้อจำกัด
description: บทความนี้จะอธิบายสถาปัตยกรรมในการสร้างการรวมระหว่าง Microsoft Dynamics 365 Human Resources กับระบบอื่นๆ
author: twheeloc
ms.date: 11/19/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: CDSIntegrationAdministration
audience: Application User
ms.custom: 7521
ms.assetid: ''
ms.search.region: Global
ms.author: twheeloc
ms.search.validFrom: 2020-10-05
ms.dyn365.ops.version: Human Resources
ms.openlocfilehash: 219ceb0adae0cee5f74a39140ab74af9fdac1eb6
ms.sourcegitcommit: ea79bf014bbf495ac8e28db29502c8bd85a75f32
ms.translationtype: HT
ms.contentlocale: th-TH
ms.lasthandoff: 11/11/2022
ms.locfileid: "9759662"
---
# <a name="security-configuration-concepts-for-virtual-table-based-integrations"></a>แนวคิดเกี่ยวกับการตั้งค่าคอนฟิกความปลอดภัยสำหรับตารางเสมือนตามข้อจำกัด

[!include [Applies to Human Resources](../includes/applies-to-hr.md)]

บทความนี้จะอธิบายสถาปัตยกรรมในการใช้ [ตารางเสมือน Microsoft Dataverse (เอนทิตี้)](/dev-itpro/power-platform/virtual-entities-overview) เพื่อสร้างการรวมระหว่าง Dynamics 365 Human Resources และระบบของบุคคลที่สาม โฟกัสของบทความอยู่ในการตั้งค่าคอนฟิกความปลอดภัย และแง่มุมของการรับรองความถูกต้องและการตรวจสอบความถูกต้อง ที่กําหนดระหว่างขอบเขตของระบบเพื่อสร้างฟังก์ชันระบบที่ปลอดภัย

## <a name="prerequisite-reference-articles"></a>บทความอ้างอิงข้อกำหนดเบื้องต้น

บทความต่อไปนี้แสดงข้อมูลเพิ่มเติมเกี่ยวกับแนวคิดในบทความนี้:

- [ภาพรวมของเอนทิตี้เสมือน](/dev-itpro/power-platform/virtual-entities-overview)
- [เริ่มต้นใช้งานตารางเสมือน (เอนทิตี้)](/developer/data-platform/virtual-entities/get-started-ve)
- [ใช้การรับรองความถูกต้องแบบเซิร์ฟเวอร์ต่อเซิร์ฟเวอร์ของผู้เช่าหลายราย (Microsoft Dataverse)](/developer/data-platform/use-multi-tenant-server-server-authentication)
- [ใช้การรับรองความถูกต้อง OAuth กับ Microsoft Dataverse (Dataverse)](/developer/data-platform/authenticate-oauth)
- [โฟลว์ข้อมูลเฉพาะตัวของไคลเอนต์ OAuth 2.0 บนแพลตฟอร์มเอกลักษณ์ Microsoft](/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow)
- [การรับรองความถูกต้องและการอนุญาต](/dev-itpro/power-platform/authentication-and-authorization)

## <a name="architecture"></a>สถาปัตยกรรม 

แผนภาพใหม่ต่อไปนี้แสดงแนวคิดหลักที่เกี่ยวข้องกับการรวมที่ใช้ตารางเสมือน (เอนทิตี้)

![การรวมตารางเสมือนตามข้อจำกัด](./media/Hosts.jpg)

ต่อไปนี้เป็นคําอธิบายขององค์ประกอบบางอย่างในแผนภาพก่อนหน้านี้:

- **Microsoft** – Microsoft โฮสต์และดําเนินงานผลิตภัณฑ์ Dynamics 365 ต่างๆ ในนามของลูกค้า

    - **Azure Active Directory (Azure AD) ผู้เช่า C** – ผู้เช่า Azure AD ที่เป็นของ Microsoft เป็นผู้เช่าที่มีการลงทะเบียนแอปลิเคชัน Dynamics 365

- **การรวมคู่ค้า**

    - **ระบบการรวม** – ระบบที่รวมอยู่กับ Dynamics 365 ซึ่งอาจเป็นระบบค่าจ้างหรือระบบใดๆ ที่อาศัยข้อมูลที่จัดเก็บไว้ใน Dynamics 365
    - **อะแดปเตอร์** – ซอฟต์แวร์หรือบริการที่รับผิดชอบการโต้ตอบกับทั้ง Dynamics 365 และระบบการรวม

        > [!NOTE]
        > ถ้าอะแดปเตอร์มีไว้ใช้โดยลูกค้า Dynamics 365 หลายราย ความคาดหวังคือจะมีการลงทะเบียนอะแดปเตอร์เป็นแอปลิเคชันหลายผู้เช่าใน Azure AD

    - **Azure AD ผู้เช่า A** – ผู้เช่า Azure AD ที่เป็นของคู่ค้าการรวม เป็นผู้เช่าที่มีการลงทะเบียรหัสนแอปลิเคชันของอะแดปเตอร์

- **ลูกค้าร่วมกัน** – ลูกค้าที่ใช้ Dynamics 365 Human Resources และโซลูชันของคู่ค้าแบบรวม

    - **Dynamics 365 Finance หรือ Human Resources** – อินสแตนซ์เฉพาะลูกค้าของ Dynamics 365 Finance หรือ Human Resources ที่มีข้อมูลลูกค้าซึ่งระบบการรวมต้องการ
    - **Dataverse** – สภาพแวดล้อม Dataverse เฉพาะลูกค้าซึ่งเชื่อมโยงกับ Finance หรือ Human Resources Dataverse มี Web API เพื่อโต้ตอบกับข้อมูล Dynamics 365
    - **Azure AD ผู้เช่า B** – ผู้เช่า Azure AD ของลูกค้า โดยจะทำหน้าที่เป็นผู้ให้บริการข้อมูลเฉพาะตัว (เซิร์ฟเวอร์การตรวจสอบ) และโทเคนปัญหาที่อนุญาตให้ผู้เรียกเรียกอินสแตนซ์ Dataverse ของลูกค้าได้

## <a name="basic-request-flow"></a>โฟลว์คำของพื้นฐาน

ส่วนนี้อธิบายขั้นตอนพื้นฐานของการร้องขอทั่วไปที่เกี่ยวข้องกับการรวม อ้างอิงแผนภาพที่แสดงก่อนหน้านี้บทความนี้

การร้องขอโดยทั่วไป จะขอให้อะแดปเตอร์สอบถาม Dynamics 365 สำหรับเป็นข้อมูล แล้วบันทึกและซิงค์ข้อมูลนั้นกับระบบรวม

1. อะแดปเตอร์จะเรียก Dataverse Web API เพื่อสอบถามเกี่ยวกับข้อมูลที่เกี่ยวข้อง

    > [!NOTE]
    > การรับรองความถูกต้องเป็นเงื่อนไขเบื้องต้น และการซื้อโทเคนเป็นส่วนหลักของกระบวนการ การรับรองความถูกต้องจะการอธิบายอยู่ในส่วน [การรับรองความถูกต้องและการอนุญาตที่ขอบเขตของระบบ](#authentication-and-authorization-at-system-boundaries)

    การเรียกนี้จะเปรียบเทียบกับ Dataverse Web API เพื่อสอบถามข้อมูลแอปพลิเคชันที่เปิดผ่านตารางเสมือน (ดู "2 การซิงโครไนส์แรกเริ่ม" และ "3 ซิงค์ส่วนที่แตกต่าง" ในแผนภาพ)

2. Dataverse จัดการการร้องขอโดยการสอบถามตารางเสมือนผ่านปลั๊กอินเอนทิตี้เสมือน ("พร็อกซีของตารางเสมือน" ในแผนภาพ) การร้องขอ Dataverse จะถูกส่งต่อไปยังบริการเอนทิตี้เสมือนของ Finance หรือ Human Resources เพื่อสอบถามเกี่ยวกับข้อมูลที่จัดเก็บทางกายภาพในฐานข้อมูล Finance หรือ Human Resources
3. บริการเอนทิตี้เสมือนของ Finance หรือ Human Resources จะแปลการร้องขอจากเอนทิตี้เสมือนเป็นการสอบถาม โดยเทียบกับเอนทิตี้ของ Finance หรือ Human Resources ที่กลับไปยังเอนทิตี้เสมือน Dataverse ข้อมูลจะถูกดึงข้อมูลจากฐานข้อมูล ที่แปลกลับเป็นการแสดงเอนทิตี้ Dataverse และส่งคืนไปที่ผู้เรียก
4. อะแดปเตอร์จะเสร็จสิ้นการแม็ปและการแปลข้อมูลที่จำเป็นใดๆ และเรียกไปยังระบบการรวม เพื่อเก็บข้อมูลในฐานข้อมูลระบบรวมต่อไป (ดู "4 บันทึกข้อมูล" ในแผนภาพ)

## <a name="authentication-and-authorization-at-system-boundaries"></a>การรับรองความถูกต้องและการตรวจสอบที่ขอบเขตของระบบ

*การรับรองความถูกต้อง* จะตรวจสอบว่าข้อมูลเฉพาะตัวของผู้ใช้หรือแอปพลิเคชันนั้นพิสูจน์ตัวตนแล้ว และยืนยันว่าผู้ใช้หรือแอปพลิเคชันยืนยันว่าผู้ใช้เป็นผู้ใช้เหล่านั้น *การตรวจสอบ* จะมอบสิทธิ์ให้แก่ผู้ใช้หรือแอปพลิเคชันในการเข้าถึงสิทธิ์ระดับแอปพลิเคชันเฉพาะ สำหรับข้อมูลเพิ่มเติมที่ ดูที่ [การรับรองความถูกต้องเทียบกับการตรวจสอบ](/azure/active-directory/develop/authentication-vs-authorization)

การเรียกระหว่างระบบโดยส่วนใหญ่ในแผนภาพหนึ่งๆ ก่อนหน้าในบทความนี้ เกี่ยวข้องกับอะแดปเตอร์ อะแดปเตอร์ต้องรับรองตัวเองเพื่อทำการเรียกต่อไปนี้:

- การเรียกไปยัง Dataverse
- การเรียกไปยังระบบการรวม

ดูขอบเขตของระบบในแผนภาพ ทุกเว็บที่ร้องขอระหว่างระบบต้องมีการรับรองความถูกต้อง และต้องผ่านการตรวจสอบระดับแอปพลิเคชันก่อนที่จะส่งคืนข้อมูลไปยังผู้เรียก หากต้องการต้องขอจากตารางเสมือนของ Dynamics 365 ที่มีการสนับสนุนโดย Finance หรือ Human Resources การรับรองความถูกต้องและการตรวจสอบ จะบังคับใช้ที่ขอบเขตของระบต่อไปนี้:

- การเรียกระหว่างอะแดปเตอร์และปลายทาง Dataverse Web API (OData)
- การเรียกระหว่างปลั๊กอินเอนทิตี้เสมือน Dataverse กับบริการเอนทิตี้เสมือนของ Finance หรือ Human Resources

ทั้งสองกรณี การตรวจสอบการรับรองความถูกต้องจะเกิดก่อน จากนั้นการตรวจสอบระดับแอปพลิเคชันจะเสร็จสิ้น เพื่อให้แน่ใจว่าผู้ใช้หรือแอปพลิเคชันที่รับรองความถูกต้องมีสิทธิระดับแอปพลิเคชันที่ถูกต้อง ในการดึงข้อมูลที่ร้องขอ

การรับรองความถูกต้องเพื่อเรียก Dataverse ได้รับการจัดการผ่านโทเคนผู้ถือ ซึ่งต้องรวมไว้เป็นส่วนหัวของ HTTP ในการร้องขอเว็บไปยัง Dataverse อะแดปเตอร์ต้องเรียกใช้โทเคนจากอินสแตนซ์ Azure AD ของผู้เช่า B (ดู "1 รับโทเคน" ในแผนภาพ) การดำเนินการ Azure AD ในฐานะตัวให้บริการข้อมูลเฉพาะตัวในขั้นตอนการรับรองความถูกต้อง

อะแดปเตอร์จะรับรองความถูกต้องโดยระบุข้อมูลเเฉพาะตัวของแอพลิเคชัน (ที่ไม่ใช่ข้อมูลลับ ตามที่ลงทะเบียนไว้ใน Azure AD ของผู้เช่า A) และข้อมูลลับหรือใบรับรองของแอพลิเคชันที่มีเฉพาะแอพลิเคชันอะแดปเตอร์เท่านั้น

หลังจากที่ผู้ใช้หรือแอพลิเคชันได้รับการรับรองความถูกต้องเพื่อเรียกไปยัง Dataverseแล้ว จะมีการตรวจสอบการรับรองความถูกต้องระดับ Dataverse แต่ละการร้องขอ การตรวจสอบเหล่านี้จะตรวจสอบให้แน่ใจว่าผู้เรียก (ข้อมูลเฉพาะตัวของแอพลิเคชันอะแดปเตอร์ ซึ่งกำหนด "\<guid A\>" ในแผนภาพ) จะมีสิทธิ์ของแอพลิเคชันที่เหมาะสม การตรวจสอบระดับแอพลิเคชันจะถูกจัดการใน Dataverse ผ่านผู้ใช้แอพลิเคชันที่แสดงถึงรหัสแอพลิเคชันของอะแดปเตอร์ สิทธิ์ระดับแอพลิเคชันมีการจัดการโดยการให้สิทธิการเข้าถึงบทบาทแอพลิเคชัน Dataverse ที่กําหนดเฉพาะ บทบาทเหล่านั้นให้สิทธิ์แบบ Granular แก่แอพลิเคชัน

สำหรับคำแนะนำโดยละเอียด ดูที่ [ใช้การรับรองความถูกต้องระหว่างเซิร์ฟเวอร์ของผู้เช่าหลายคน](/power-apps/developer/data-platform/use-multi-tenant-server-server-authentication)

ถ้าสิทธิ์แอพลิเคชันระดับ Dataverse ผ่านการตรวจสอบ ปลั๊กอินเอนทิตี้เสมือนจะเรียกไปยังปลายทางบริการเอนทิตี้เสมือน ในสภาพแวดล้อม Finance หรือ Human Resources การรับรองความถูกต้องระหว่างเซิร์ฟเวอร์ (S2S) ใช้ในการเรียกนี้ จะใช้ข้อมูลเฉพาะตัวและข้อมูลลับที่ตั้งค่าคอนฟิกในเรกคอร์ดการตั้งค่าคอนฟิกแหล่งข้อมูลเสมือนของการเงินและการดําเนินงาน

![เรกคอร์ดการตั้งค่าคอนฟิกแหล่งข้อมูลเสมือนของการเงินและการดําเนินงานในสภาพแวดล้อม sandbox](./media/sandbox.jpg)

สำหรับข้อมูลเพิ่มเติม ให้ดู [ตั้งค่าคอนฟิกเอนทิตีเสมือน Dataverse](/dev-itpro/power-platform/admin-reference)

การเรียกจากปลั๊กอินเอนทิตีเสมือน Dataverse ไปยัง Finance หรือ Human Resources จะรวมข้อมูลเฉพาะตัวอะแดปเตอร์ของการเรียกเดิมไปยัง Dataverse จากอะแดปเตอร์ (ข้อมูลเฉพาะตัวที่กำหนด "\<guid A\>" ในแผนภาพสถาปัตยกรรม) หากแหล่งข้อมูลเอนทิตี้เสมือนมีการตั้งค่าคอนฟิกอย่างถูกต้อง และผ่านการรับรองความถูกต้องของ S2S บริการเอนทิตี้เสมือนใน Finance or Human Resources จะรันการสอบถามในบริบทที่มีผู้เรียกเดิม ( อะแดปเตอร์ \<guid A\>) การตรวจสอบสิทธิ์ของแอพลิเคชัน (การตรวจสอบ) ที่ระดับ Finance หรือ Human Resources จะเสร็จสิ้นเพื่อให้แน่ใจว่าอะแดปเตอร์มีสิทธิที่ต้องใช้ในการเข้าถึงเอนทิตี้ข้อมูลที่ร้องขอผ่านการสอบถาม

ความปลอดภัยของ Finance และ Human Resources มีการจัดการในลักษณะต่อไปนี้

1. โดยการแม็ปข้อมูลเฉพาะตัวอะแดปเตอร์ (\<guid A\>) กับผู้ใช้ Finance หรือ Human Resources เฉพาะ การแม็ปนี้เสร็จสิ้นบนหน้า **แอพลิเคชัน Azure Active Directory** Azure หากต้องการข้อมูลเพิ่มเติม โปรดดู [ลงทะเบียนแอปพลิเคชันภายนอกของคุณ](/dev-itpro/data-entities/services-home-page.md#register-your-external-application)
2. โดยการให้บทบาทในระดับแอพลิเคชัน หน้าที่ และสิทธิ์การใช้งานที่เหมาะสมแก่ผู้ใช้ Finance หรือ Human Resources สำหรับข้อมูลเพิ่มเติม ให้ดูที่ [ความปลอดภัยตามบทบาท](/dev-itpro/sysadmin/role-based-security)

ถ้าแอพลิเคชันอะแดปเตอร์ (\<guid A\>) ได้รับสิทธิ์ที่ต้องใช้ในการเข้าถึงข้อมูลที่ร้องขอ เหตุการณ์ต่อไปนี้จะเกิดขึ้น

1. การสอบถามจะรัน
2. ข้อมูลจะถูกแปลกลับไปยังหน้าเอนทิตี้ Dataverse
3. ข้อมูลจะถูกส่งคืนไปยังอะแดปเตอร์

> [!IMPORTANT]
> ในระหว่างการพัฒนา คุณสามารถรันอะแดปเตอร์ได้ โดยใช้ผู้ใช้ Finance หรือ Human Resources ที่มีบทบาทผู้ดูแลระบบ อย่างไรก็ตาม ในสภาพแวดล้อมการทำงานจริง อะแดปเตอร์ไม่ควรรันด้วยสิทธิ์ระดับผู้ดูแลระบบ

## <a name="key-takeaways"></a>ประเด็นที่สำคัญ

ต่อไปนี้เป็นผลกระทบที่สําคัญบางอย่างของตารางเสมือนหรือสถาปัตยกรรมเอนทิตี้

- การตั้งค่าคอนฟิกความปลอดภัยของตารางเสมือนที่สนับสนุนโดย Human Resources ได้รับการจัดการใน Human Resources
- ลูกค้า ("ลูกค้าร่วมกัน" ในแผนภาพสถาปัตยกรรมซึ่งอธิบายไว้ก่อนหน้าในบทความนี้) จะควบคุมสิทธิ์ทั้งหมดที่ได้รับให้กับข้อมูลเฉพาะตัวของอะแดปเตอร์การรวม (ที่ชื่อ "\<guid A\>" ในแผนภาพ)
- ลูกค้ารับผิดชอบการตั้งค่าคอนฟิกความปลอดภัยที่ถูกต้องของสภาพแวดล้อม Human Resources ของพวกเขา คู่ค้าการรวมที่สร้างอะแดปเตอร์ต้องให้ข้อแนะนําเกี่ยวกับสิทธิ์ที่อะแดปเตอร์ต้องการ
