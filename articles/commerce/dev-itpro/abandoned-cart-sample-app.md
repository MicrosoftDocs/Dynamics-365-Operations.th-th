---
title: ตรวจหารถเข็นที่ถูกละทิ้งและส่งการแจ้งเตือนให้ลูกค้า
description: หัวข้อนี้จะอธิบายวิธีการปรับแต่งแอปตัวอย่างของตัวเชื่อมต่อรถเข็นที่ละทิ้งของ Microsoft Dynamics 365 Commerce เพื่อตรวจหารถเข็นที่ถูกละทิ้งและส่งการแจ้งเตือนทางอีเมลสำหรับเตือนความจำให้กับลูกค้า
author: bicyclingfool
ms.date: 02/25/2022
ms.topic: article
audience: Application User, Developer, IT Pro
ms.reviewer: v-chgriffin
ms.search.region: Global
ms.author: stuharg
ms.search.validFrom: 2017-06-20
ms.openlocfilehash: 82848f1ff068cea0adfc6ec1b33fc4bb035f78dc
ms.sourcegitcommit: 374bbdde90fc9a68c0799158a50409bfbe8ca64e
ms.translationtype: HT
ms.contentlocale: th-TH
ms.lasthandoff: 02/25/2022
ms.locfileid: "8353369"
---
# <a name="detect-abandoned-carts-and-send-notifications-to-customers"></a>ตรวจหารถเข็นที่ถูกละทิ้งและส่งการแจ้งเตือนให้ลูกค้า

[!include [banner](../includes/banner.md)]

หัวข้อนี้จะอธิบายวิธีการปรับแต่งแอปตัวอย่างของตัวเชื่อมต่อรถเข็นที่ละทิ้งของ Microsoft Dynamics 365 Commerce เพื่อตรวจหารถเข็นที่ถูกละทิ้งและส่งการแจ้งเตือนทางอีเมลสำหรับเตือนความจำให้กับลูกค้า

ความสามารถในการกู้คืนรายได้และรักษาลูกค้าผ่านการแจ้งเตือนรถเข็นที่ถูกละทิ้งเป็นความสามารถที่สำคัญที่ Dynamics 365 Commerce รองรับ ด้วยการปรับแต่งแอปตัวอย่างของตัวเชื่อมต่อรถเข็นที่ละทิ้งของ Commerce ผู้ค้าปลีกสามารถเข้าถึงรถเข็นซื้อของบน Retail Server ที่ยังไม่ได้แก้ไขในระหว่างกรอบเวลาที่ผู้ค้าปลีกกําหนด รถเข็นเหล่านั้นสามารถเรียกดู เสริมด้วยข้อมูลผลิตภัณฑ์และลูกค้า และส่งต่อไปยังผู้ให้บริการการตลาดทางอีเมลบุคคลที่สาม ซึ่งสามารถสร้างการแจ้งเตือนทางอีเมลและส่งให้กับลูกค้าได้

การแจ้งเตือนทางอีเมลของรถเข็นที่ละทิ้งซึ่งลูกค้าได้รับสามารถมีข้อมูลต่อไปนี้:

- ชื่อของลูกค้า
- นามสกุลของลูกค้า
- ที่อยู่อีเมลของลูกค้า
- URL ที่ส่งลูกค้ากลับไปยังรถเข็น
- สกุลเงินของธุรกรรม
- รายการผลิตภัณฑ์ในรถเข็นของลูกค้า สำหรับผลิตภัณฑ์แต่ละอย่าง จะมีข้อมูลต่อไปนี้:

    - ชื่อที่แสดงของผลิตภัณฑ์
    - รหัสผลิตภัณฑ์ (ใช้เพื่อรวบรวม URL ไปยังหน้ารายละเอียดผลิตภัณฑ์)
    - รูปภาพของผลิตภัณฑ์ที่สามารถปรับขนาดโดยอัตโนมัติเพื่อรองรับขนาดมุมมองที่ต่างกัน
    - ข้อความแสดงแทนสำหรับรูปภาพผลิตภัณฑ์
    - ราคาต่อหน่วยของผลิตภัณฑ์

## <a name="abandoned-cart-connector-sample"></a>ตัวอย่างตัวเชื่อมต่อรถเข็นที่ละทิ้ง

แบบจำลองตัวเชื่อมต่อที่ Microsoft จัดหาผ่านชุดการพัฒนาซอฟต์แวร์ Retail (SDK) ช่วยให้สามารถเรียกข้อมูลรถเข็นที่ถูกละทิ้งและส่งไปยังผู้ให้บริการด้านการตลาดทางอีเมลของบุคคลที่สาม ตัวเชื่อมต่อนี้จัดการกับการสื่อสารกับ Retail Server ใช้ Azure Key Vault เพื่อความปลอดภัย จัดการการจัดกำหนดการของการเรียกข้อมูลรถเข็นเพื่อเปิดกรอบเวลาที่ระบุ และเรียกข้อมูลใบสั่งและผลิตภัณฑ์ นอกจากนี้ ยังมีการใช้งานตัวอย่างสำหรับการรวมกับผู้ให้บริการการตลาดทางอีเมลของบุคคลที่สามด้วย ตัวเชื่อมต่อถูกสร้างขึ้นเพื่อสื่อสารกับ [Emarsys](https://emarsys.com) ในแบบสำเร็จรูป อย่างไรก็ตาม คุณสามารถปรับแต่งเพื่อรวมกับโซลูชันอื่นๆ เช่น Constant Contact, Mailchimp และ SendGrid ได้อย่างง่ายดาย

ภาพประกอบต่อไปนี้แสดงส่วนประกอบของแอปตัวอย่างของตัวเชื่อมต่อรถเข็นที่ถูกละทิ้ง

![ส่วนประกอบของแอปตัวอย่างของตัวเชื่อมต่อรถเข็นที่ถูกละทิ้ง](media/AbandonedCartConnector.png)

> [!IMPORTANT]
> บางภูมิภาคต้องการให้ลูกค้าสามารถเลือกไม่แสดงข้อมูลรถเข็นของตนผ่านไปยังผู้ให้บริการการตลาดทางอีเมล หรือร้องขอให้ลบข้อมูลออก แต่ Microsoft ไม่มีตัวเลือกเหล่านี้ให้กับลูกค้า ดังนั้น หากคุณวางแผนที่จะทำธุรกิจในภูมิภาคที่กำหนดตัวเลือกนี้ คุณต้องจัดเตรียมโครงสร้างพื้นฐานที่จำเป็นและการปรับแต่งเพื่อติดตามการกำหนดลักษณะของลูกค้า และป้องกันไม่ให้ข้อมูลลูกค้าถูกส่งไปยังแพลตฟอร์มอีเมลของคุณ คุณต้องกําหนดกระบวนการลบข้อมูลลูกค้าจากผู้ให้บริการการตลาดทางอีเมลของคุณตามการร้องขอของลูกค้าด้วย

## <a name="obtain-the-code-sample"></a>ขอรับโค้ดตัวอย่าง

แอปตัวอย่างของตัวเชื่อมต่อรถเข็นที่ถูกละทิ้งรวมอยู่ใน Retail SDK เป็นรุ่น 10.0.16 โค้ดมีอยู่ใน **\\RetailSDK\\Code\\SampleExtensions\\RetailServer\\Extensions.AbandonedCartSample** สำหรับข้อมูลเพิ่มเติมเกี่ยวกับ Retail SDK และวิธีการขอรับ ดูที่ [ชุดการพัฒนาซอฟต์แวร์ (SDK) ของ Retail](retail-sdk/retail-sdk-overview.md)

> [!NOTE]
> แม้ว่าโค้ดตัวอย่างจะเปิดใช้งานครั้งแรกในรุ่น 10.0.16 แต่โค้ดก็จะเข้ากันได้กับรุ่น 10.0.13 และที่ใหม่กว่าของ Retail Server

## <a name="prerequisites-and-dependencies"></a>ข้อกำหนดเบื้องต้นและการขึ้นต่อกัน

ก่อนที่คุณจะสามารถปรับใช้และตั้งค่าคอนฟิกโค้ดตัวอย่างของตัวเชื่อมต่อรถเข็นที่ถูกละทิ้ง ต้องเป็นไปตามข้อกําหนดเบื้องต้นต่อไปนี้

### <a name="access-to-commerce-resources"></a>เข้าถึงทรัพยากร Commerce

เมื่อต้องการตั้งค่าคอนฟิกและปรับใช้แอปตัวเชื่อมต่อรถเข็นที่ละทิ้ง คุณต้องมีสิทธิ์เข้าถึงทรัพยากร Commerce ต่อไปนี้

- ผู้ดูแลระบบเข้าถึงศูนย์ควบคุม Commerce สำหรับสภาพแวดล้อมของคุณ
- เข้าถึงโครงการ Microsoft Dynamics Lifecycle Services (LCS) สำหรับสภาพแวดล้อมของคุณ

### <a name="azure-cosmos-db"></a>Azure Cosmos DB

แอปตัวเชื่อมต่อรถเข็นที่ถูกละทิ้งใช้ Azure Cosmos DB เพื่อติดตามรหัสและเวลาประทับของรถเข็นที่มีการเรียกข้อมูลก่อนหน้านี้ คุณสามารถใช้ Azure Cosmos DB เพื่อเก็บข้อมูลนี้ต่อไป หรือคุณสามารถเลือกปรับแต่งตัวอย่างของโค้ดเพื่อรวมกับตัวเลือกที่จัดเก็บข้อมูลอื่นได้ หากต้องการทราบข้อมูลเพิ่มเติมเกี่ยวกับ Azure Cosmos DB ดูที่ [ยินดีต้อนรับสู่ Azure Cosmos DB](/azure/cosmos-db/introduction)

หากคุณใช้ Azure Cosmos DB คุณสมบัติต้องตรงข้อกำหนดเบื้องต้นต่อไปนี้คุณจึงจะสามารถเรียกใช้ตัวอย่างได้:

- คุณต้องมีบัญชี Azure Cosmos DB ที่ใช้งานอยู่ หากคุณไม่มีบัญชี ดูที่ [สร้างบัญชีฐานข้อมูล](/azure/cosmos-db/create-sql-api-dotnet#create-a-database-account)
- คุณต้องเรียกดูค่า **URI** และ **PRIMARY KEY** (หรือ **SECONDARY KEY**) จากเบลด **คีย์** ของบัญชี Azure Cosmos DB ในพอร์ทัล Azure หากต้องการทราบข้อมูลเพิ่มเติมเกี่ยวกับวิธีการเรียกข้อมูลปลายทางและคีย์ของบัญชี Azure Cosmos DB ของคุณ ดูที่ [ดู คัดลอก และสร้างคีย์การเข้าถึงและรหัสผ่านใหม่](/azure/cosmos-db/manage-account#keys)

### <a name="azure-key-vault"></a>Azure Key Vault

แอปตัวเชื่อมต่อรถเข็นที่ถูกละทิ้งใช้ Key Vault เพื่อจัดเก็บชื่อและข้อมูลลับของส่วนประกอบต่างๆ ที่ต้องมีการเข้าถึงที่ปลอดภัย

หากต้องการตั้งค่า Key Vault ให้ทำตามขั้นตอนเหล่านี้

1. ปฏิบัติตามคำแนะนำใน [จัดการ Key Vault ใน Azure Stack Hub โดยใช้พอร์ทัล](/azure-stack/user/azure-stack-key-vault-manage-portal?view=azs-2002&preserve-view=true)
2. สร้างข้อมูลลับสำหรับข้อมูลต่อไปนี้

    - ชื่อผู้ใช้และข้อมูลลับของ API ใน Emarsys Application Programming Interface (API)
    - รหัสและข้อมูลลับของแอปพลิเคชันรถเข็นที่ถูกละทิ้ง

โค้ดตัวอย่างของตัวเชื่อมต่อรถเข็นที่ถูกละทิ้งจะใช้ข้อมูลประจำตัวเริ่มต้นของ Azure เพื่อเข้าถึง Key Vault คุณต้องให้สิทธิ์ของ **รายการ** และ **อ่าน** กับข้อมูลประจำตัวที่คุณวางแผนจะใช้เข้าถึง Key Vault

สำหรับข้อมูลเพิ่มเติมเกี่ยวกับข้อมูลประจำตัวเริ่มต้นของ Azure ดูที่ [คลาส DefaultAzureCredential](/dotnet/api/azure.identity.defaultazurecredential?view=azure-dotnet&preserve-view=true)

## <a name="create-an-abandoned-cart-connector-sample-app-application-id-for-the-azure-ad-tenant"></a>สร้างรหัสแอปพลิเคชันของแอปตัวอย่างตัวเชื่อมต่อรถเข็นที่ถูกละทิ้งสำหรับผู้เช่า Azure AD

คุณต้องสร้างรหัสแอปพลิเคชันของแอปตัวอย่างตัวเชื่อมต่อรถเข็นที่ถูกละทิ้งสำหรับผู้เช่า Azure Active Directory (AD) สำหรับข้อมูลเกี่ยวกับวิธีการสร้างรหัสแอปพลิเคชัน ดูที่ [ใช้พอร์ทัลเพื่อสร้างแอปพลิเคชัน Azure AD และผู้ใช้งานบริการที่สามารถเข้าถึงทรัพยากร](/azure/active-directory/develop/howto-create-service-principal-portal)

## <a name="add-the-abandoned-cart-connector-sample-app-application-id-to-the-allow-list-for-the-retail-server-api"></a>เพิ่มรหัสแอปพลิเคชันตัวอย่างของตัวเชื่อมต่อรถเข็นที่ถูกละทิ้งไปยังรายการอนุญาตสำหรับ Retail Server API

จากนั้น คุณต้องเพิ่มรหัสแอปพลิเคชันตัวอย่างของตัวเชื่อมต่อรถเข็นที่ถูกละทิ้งไปยังรายการอนุญาตสำหรับ Retail Server API สำหรับข้อมูลเกี่ยวกับวิธีการเพิ่มรหัสแอปพลิเคชันไปยังรายการอนุญาตใน Azure ดูที่ [การสนับสนุนการรับรองความถูกต้องของบริการกับบริการใน Retail Server](https://community.dynamics.com/ax/b/axforretail/posts/support-for-service-to-service-authentication-in-retail-server)

## <a name="configure-the-abandoned-cart-connector-sample-app"></a>ตั้งค่าคอนฟิกแอปตัวอย่างของตัวเชื่อมต่อรถเข็นที่ถูกละทิ้ง

เมื่อต้องการตั้งค่าคอนฟิกแอปตัวอย่างของตัวเชื่อมต่อรถเข็นที่ถูกละทิ้ง ให้แก้ไขไฟล์การตั้งค่าคอนฟิก **appSettings.json** ที่อยู่ที่ระดับรากของไดเรกทอรี **AbandonedCartDetectionSample** ตารางต่อไปนี้อธิบายคุณสมบัติของไฟล์การตั้งค่าคอนฟิก

### <a name="keyvaultoptions"></a>KeyVaultOptions

| คุณสมบัติ    | คำอธิบาย |
| ----------- | ----------- |
| KeyVaultURI | ชื่อ Domain Name System (DNS) ของ Key Vault ที่คุณใช้งานในพอร์ทัล Azure |

### <a name="retailserverclientoptions"></a>RetailServerClientOptions

| คุณสมบัติ                                      | คำอธิบาย |
| --------------------------------------------- | ----------- |
| TenantId                                      | รหัสผู้เช่า Azure AD ของผู้เช่า Azure ของคุณ |
| RetailServerAudienceId                        | รหัสผู้ชม Retail Server คุณสามารถปล่อยค่าเริ่มต้นไว้ได้ |
| AppIdKeyVaultSecretName                       | ชื่อของข้อมูลลับที่คุณสร้างสำหรับรหัสแอปพลิเคชันของแอปตัวอย่างตัวเชื่อมต่อรถเข็นที่ถูกละทิ้ง |
| AppSecretKeyVaultSecretName                   | ชื่อของข้อมูลลับที่คุณจัดเก็บข้อมูลลับของแอปสำหรับรหัสแอปพลิเคชันของแอปตัวอย่างตัวเชื่อมต่อรถเข็นที่ถูกละทิ้ง |
| RetailServerUrl                               | URL ของอินสแตนซ์ Retail Server ของคุณ คุณสามารถค้นหาค่านี้ใน LCS |
| หมายเลขหน่วยปฏิบัติงาน                           | หมายเลขหน่วยปฏิบัติงาน (OUN) คุณสามารถค้นหาค่านี้ในศูนย์ควบคุม Commerce |
| IncludeAbandonedCartsModifiedSinceLastMinutes | จุดเริ่มต้นของกรอบเวลาในรถเข็นที่ถูกละทิ้งซึ่งคุณต้องการเรียกข้อมูล ค่าจะแสดงเป็นเป็นจำนวนนาทีก่อนเวลาปัจจุบัน ตัวอย่างเช่น ตั้งค่าคุณสมบัตินี้เป็น **120** เพื่อเรียกข้อมูลรถเข็นทั้งหมดที่แก้ไขครั้งล่าสุดระหว่าง 120 นาทีที่ผ่านมา และการสิ้นสุดของกรอบเวลาที่กําหนดโดยคุณสมบัติ **ExcludeAbandonedCartsModifiedSinceLastMinutes** |
| ExcludeAbandonedCartsModifiedSinceLastMinutes | จุดสิ้นสุดของกรอบเวลาในรถเข็นที่ถูกละทิ้งซึ่งคุณต้องการเรียกข้อมูล ค่าจะแสดงเป็นเป็นจำนวนนาทีก่อนเวลาปัจจุบัน ตัวอย่างเช่น หากคุณสมบัติ **IncludeAbandonedCartsModifiedSinceLastMinutes** ตั้งค่าเป็น **120** ตั้งค่าคุณสมบัตินี้เป็น **30** เพื่อเรียกข้อมูลรถเข็นทั้งหมดที่แก้ไขระหว่าง 120 นาทีที่ผ่านมาและ 30 นาทีที่ผ่านมา ในทางปฏิบัติ คุณสมบัตินี้จะกําหนดจํานวนเวลาที่คุณต้องการรอก่อนที่จะประกาศว่ารถเข็นถูกละทิ้ง |
| ReturnToCartUrl                               | URL ของรถเข็นบนไซต์อีคอมเมิร์ซของคุณในรูปแบบที่ใช้ในไฟล์ **app.config** |

### <a name="azurecosmosoptions"></a>AzureCosmosOptions

สถานะงานการเรียกข้อมูลรถเข็นที่ถูกละทิ้ง รหัสรถเข็น และการประทับเวลาที่มีการแก้ไขถูกจัดเก็บอยู่ใน Azure Cosmos DB ตามค่าเริ่มต้น การตั้งค่าในไฟล์การตั้งค่าคอนฟิกจะชี้ไปที่อินสแตนซ์ตัวเลียนแบบเฉพาะภายในของ Azure Cosmos DB เมื่อคุณปรับใช้ตัวเชื่อมต่อกับการทำงานจริง คุณต้องอัปเดตการตั้งค่าเหล่านี้เพื่อให้ชี้ไปที่อินสแตนซ์ Azure Cosmos DB ในการสมัครใช้งาน Azure ของคุณ สำหรับการทดสอบแบบภายในหรือ sandbox คุณสามารถใช้ [Azure Cosmos Emulator](/azure/cosmos-db/local-emulator)

| คุณสมบัติ    | คำอธิบาย |
| ----------- | ----------- |
| EndPointUri | URI ปลายทางที่จัดหาโดย Azure หรือตัวเลียนแบบ |
| PrimaryKey  | คีย์หลักที่จัดหาโดย Azure หรือตัวเลียนแบบ |
| DatabaseId  | รหัสฐานข้อมูล คุณสามารถปล่อยค่าเริ่มต้นไว้หรือระบุด้วยตนเอง |
| ContainerId | รหัสคอนเทนเนอร์ คุณสามารถปล่อยค่าเริ่มต้นไว้หรือระบุด้วยตนเอง |

### <a name="emarsysclientoptions"></a>EmarsysClientOptions

> [!NOTE]
> ถ้าคุณรวมกับผู้ให้บริการการตลาดทางอีเมลอื่นที่ไม่ใช่ Emarsys คุณต้องขยายอินเทอร์เฟส **IEmailProvider** ตามความเหมาะสมในการสื่อสารกับผู้ให้บริการรายนั้น

| คุณสมบัติ                      | คำอธิบาย |
| ----------------------------- | ----------- |
| ApiUrl                        | `https://api.emarsys.net/api/v2/event/{0}/trigger` |
| ExternalEventId               | รหัสของเรกคอร์ดเหตุการณ์ภายนอกที่สร้างขึ้นใน Emarsys คุณสามารถดูค่าภายใต้ **การตั้งค่าทริกเกอร์** ในการส่งเสริมการขายที่คุณสร้างเพื่อส่งการแจ้งเตือนทางอีเมลของรถเข็นที่ถูกละทิ้ง |
| ApiUserNameKeyVaultSecretName | ชื่อของคีย์ที่จัดเก็บชื่อผู้ใช้ Emarsys API |
| ApiSecretKeyVaultSecretName   | ชื่อของคีย์ที่จัดเก็บข้อมูลลับของ Emarsys API |
| EmarsysContactKeyId           | รหัสของคอลัมน์อีเมลในฐานข้อมูลผู้ติดต่อ Emarsys ค่าเริ่มต้นคือ **3** และไม่ควรมีการเปลี่ยนแปลง |

### <a name="mediaoptions"></a>MediaOptions

ถ้าคุณใช้ความสามารถอีคอมเมิร์ซใน Commerce คุณสามารถใช้การจัดการสินทรัพย์ดิจิทัลของ Commerce เพื่อเรียกข้อมูลรูปภาพผลิตภัณฑ์ สำหรับข้อมูลเพิ่มเติมเกี่ยวกับความสามารถต่างๆ ของตัวปรับขนาดรูปภาพในการจัดการสินทรัพย์ดิจิทัล ดูที่ [การตั้งค่าคอนฟิกกรอบการมองเห็น ImageSettings](../e-commerce-extensibility/image-component.md#imagesettings-viewport-configuration)

| คุณสมบัติ                             | คำอธิบาย |
| ------------------------------------ | ----------- |
| ImageServerUrl                       | URL ระดับรากของตัวจัดการสินทรัพย์ดิจิทัลของไซต์ของคุณ คุณสามารถค้นหาค่าในคีย์คุณสมบัติ **URL ฐานของเซิร์ฟเวอร์สื่อ** ที่ **Retail และ Commerce \> การตั้งค่าช่องทาง \> โพรไฟล์ช่องทาง** ในศูนย์ควบคุม Commerce |
| ImageViewPorts                       | โหนดคอนเทนเนอร์สำหรับการตั้งค่าคอนฟิกกรอบการมองเห็นแต่ละรายการ |
| ImageViewPorts/viewport              | ข้อกำหนดของกรอบการมองเห็น ใช้คุณสมบัตินี้เพื่อระบุช่วงความกว้างของกรอบการมองเห็นในหน่วยพิกเซล ตัวอย่างแสดงวิธีการใช้คุณสมบัตินี้ ดูที่ไฟล์การตั้งค่าคอนฟิก **appSettings.json** |
| ImageViewPorts/imageWidth            | ความกว้างรูปภาพของกรอบการมองเห็นเป็นพิกเซล |
| imageViewPorts/imageHeight           | ความสูงรูปภาพของกรอบการมองเห็นเป็นพิกเซล |
| imageViewPorts/useForDefaultImageTag | ค่า **จริง**/**เท็จ** ที่ระบุว่าขนาดของรูปภาพที่กําหนดโดยมุมมองควรใช้หรือไม่ ถ้าแท็ก HTML ของ `<picture>` HTML ไม่ได้รับการสนับสนุนสำหรับเว็บเบราว์เซอร์หรือไคลเอ็นต์อีเมล |

[!INCLUDE[footer-include](../../includes/footer-banner.md)]
