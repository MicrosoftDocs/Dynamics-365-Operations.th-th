---
title: ตัวตรวจสอบความสอดคล้องกันของธุรกรรมการขายปลีก
description: หัวข้อนี้อธิบายฟังก์ชันการทำงานของตัวตรวจสอบความสอดคล้องกันของธุรกรรมใน Dynamics 365 Commerce
author: josaw1
manager: AnnBe
ms.date: 10/14/2019
ms.topic: index-page
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
audience: Application User
ms.reviewer: josaw
ms.search.scope: Core, Operations, Retail
ms.custom: ''
ms.assetid: ed0f77f7-3609-4330-bebd-ca3134575216
ms.search.region: global
ms.search.industry: Retail
ms.author: josaw
ms.search.validFrom: 2019-01-15
ms.dyn365.ops.version: 10
ms.openlocfilehash: eb5c7389ba29d50232f9321e40bccceecd5f5fc6
ms.sourcegitcommit: 02640a0f63daa9e509146641824ed623c4d69c7f
ms.translationtype: HT
ms.contentlocale: th-TH
ms.lasthandoff: 04/16/2020
ms.locfileid: "3265629"
---
# <a name="retail-transaction-consistency-checker"></a><span data-ttu-id="2832a-103">ตัวตรวจสอบความสอดคล้องกันของธุรกรรมการขายปลีก</span><span class="sxs-lookup"><span data-stu-id="2832a-103">Retail transaction consistency checker</span></span>

[!include [banner](includes/banner.md)]

<span data-ttu-id="2832a-104">หัวข้อนี้อธิบายฟังก์ชันการทำงานของตัวตรวจสอบความสอดคล้องกันของธุรกรรมใน Microsoft Dynamics 365 Commerce</span><span class="sxs-lookup"><span data-stu-id="2832a-104">This topic describes the transaction consistency checker functionality in Microsoft Dynamics 365 Commerce.</span></span> <span data-ttu-id="2832a-105">ตัวตรวจสอบความสอดคล้องกันจะระบุและจำแนกธุรกรรมที่ไม่สอดคล้องกันก่อนที่จะมีการจัดการต่อโดยกระบวนการลงรายการบัญชีใบแจ้งยอด</span><span class="sxs-lookup"><span data-stu-id="2832a-105">The consistency checker identifies and isolates inconsistent transactions before they are picked up by the statement posting process.</span></span>

<span data-ttu-id="2832a-106">เมื่อมีการลงรายการบัญชีใบแจ้งยอด การลงรายการบัญชีอาจล้มเหลวเนื่องจากข้อมูลที่ไม่สอดคล้องกันในตารางธุรกรรมการค้า</span><span class="sxs-lookup"><span data-stu-id="2832a-106">When a statement is posted, posting can fail due to inconsistent data in the commerce transaction tables.</span></span> <span data-ttu-id="2832a-107">ปัญหาข้อมูลอาจเกิดมาจากปัญหาที่ไม่คาดคิดในแอปพลิเคชันการขายหน้าร้าน (POS) หรือหากธุรกรรมมีการนำเข้าอย่างไม่ถูกต้องจากระบบ POS ของบริษัทอื่น</span><span class="sxs-lookup"><span data-stu-id="2832a-107">The data issue may be caused by unforeseen issues in the point of sale (POS) application, or if transactions were incorrectly imported from third-party POS systems.</span></span> <span data-ttu-id="2832a-108">ตัวอย่างของลักษณะความไม่สอดคล้องกันเหล่านี้ที่อาจปรากฏขึ้นได้แก่:</span><span class="sxs-lookup"><span data-stu-id="2832a-108">Examples of how these inconsistencies may appear include:</span></span> 

- <span data-ttu-id="2832a-109">ยอดรวมของธุรกรรมในตารางส่วนหัวไม่ตรงกับยอดรวมของธุรกรรมในรายการ</span><span class="sxs-lookup"><span data-stu-id="2832a-109">The transaction total on the header table does not match the transaction total on the lines.</span></span>
- <span data-ttu-id="2832a-110">จำนวนรายการในตารางส่วนหัวไม่ตรงกับจำนวนของรายการในตารางธุรกรรม</span><span class="sxs-lookup"><span data-stu-id="2832a-110">The line count on the header table does not match with the number of lines in the transaction table.</span></span>
- <span data-ttu-id="2832a-111">ภาษีในตารางส่วนหัวไม่ตรงกับยอดเงินภาษีในรายการ</span><span class="sxs-lookup"><span data-stu-id="2832a-111">Taxes on the header table do not match the tax amount on the lines.</span></span> 

<span data-ttu-id="2832a-112">เมื่อธุรกรรมที่ไม่สอดคล้องกันถูกจัดการต่อโดยกระบวนการลงรายการบัญชีใบแจ้งยอด จะมีการสร้างใบแจ้งหนี้การขายและสมุดรายวันการชำระเงินที่ไม่สอดคล้องกัน และทำให้กระบวนการลงรายการบัญชีใบแจ้งยอดทั้งหมดล้มเหลว</span><span class="sxs-lookup"><span data-stu-id="2832a-112">When inconsistent transactions are picked up by the statement posting process, inconsistent sales invoices and payment journals are created, and the entire statement posting process fails as a result.</span></span> <span data-ttu-id="2832a-113">การกู้คืนใบแจ้งยอดจากสถานะดังกล่าวเป็นการแก้ไขข้อมูลที่มีความซับซ้อนในตารางธุรกรรมหลายตาราง</span><span class="sxs-lookup"><span data-stu-id="2832a-113">Recovering the statements from such a state involves complex data fixes across multiple transaction tables.</span></span> <span data-ttu-id="2832a-114">ตัวตรวจสอบความสอดคล้องกันของธุรกรรมจะป้องกันปัญหาดังกล่าว</span><span class="sxs-lookup"><span data-stu-id="2832a-114">The transaction consistency checker prevents such issues.</span></span>

<span data-ttu-id="2832a-115">ตารางต่อไปนี้แสดงกระบวนการลงรายการบัญชีที่มีตัวตรวจสอบความสอดคล้องกันของธุรกรรม</span><span class="sxs-lookup"><span data-stu-id="2832a-115">The following chart illustrates the posting process with the transaction consistency checker.</span></span>

<span data-ttu-id="2832a-116">![กระบวนการลงรายการบัญชีใบแจ้งยอดที่มีตัวตรวจสอบความสอดคล้องกันของธุรกรรม](./media/validchecker.png "กระบวนการลงรายการบัญชีใบแจ้งยอดที่มีตัวตรวจสอบความสอดคล้องกันของธุรกรรมการขายปลีก")</span><span class="sxs-lookup"><span data-stu-id="2832a-116">![Statement posting process with transaction consistency checker](./media/validchecker.png "Statement posting process with retail transaction consistency checker")</span></span>

<span data-ttu-id="2832a-117">กระบวนการชุดงาน **ตรวจสอบความถูกต้องของธุรกรรมของร้านค้า** จะตรวจสอบความสอดคล้องกันของตารางธุรกรรมการค้าในสถานการณ์ต่อไปนี้</span><span class="sxs-lookup"><span data-stu-id="2832a-117">The **Validate store transactions** batch process checks the consistency of the commerce transaction tables for the following scenarios.</span></span>

- <span data-ttu-id="2832a-118">**บัญชีลูกค้า** – ตรวจสอบว่าบัญชีลูกค้าในตารางธุรกรรมมีอยู่ในข้อมูลหลักของลูกค้า HQ หรือไม่</span><span class="sxs-lookup"><span data-stu-id="2832a-118">**Customer account** – Validates that the customer account in the transaction tables exists in the HQ customer master.</span></span>
- <span data-ttu-id="2832a-119">**จำนวนรายการ** – ตรวจสอบว่าจำนวนของรายการตามที่บันทึกไว้ในตารางส่วนหัวของธุรกรรมตรงกับจำนวนรายการในตารางธุรกรรมการขายหรือไม่</span><span class="sxs-lookup"><span data-stu-id="2832a-119">**Line count** – Validates that the number of lines, as captured on the transaction header table, matches the number of lines in the sales transaction tables.</span></span>
- <span data-ttu-id="2832a-120">**ราคารวมภาษี** – ตรวจสอบว่าพารามิเตอร์ **ราคารวมภาษี** สอดคล้องกันกับรายการธุรกรรมหรือไม่</span><span class="sxs-lookup"><span data-stu-id="2832a-120">**Price includes tax** – Validates that the **Price includes tax** parameter is consistent across transaction lines.</span></span>
- <span data-ttu-id="2832a-121">**ยอดการชำระเงิน** - ตรวจสอบว่าเรกคอร์ดการชำระเงินตรงกับยอดการชำระเงินในส่วนหัวหรือไม่</span><span class="sxs-lookup"><span data-stu-id="2832a-121">**Payment amount** - Validates that the payment records match the payment amount on header.</span></span>
- <span data-ttu-id="2832a-122">**ยอดเงินรวม** – ตรวจสอบว่ายอดเงินรวมในส่วนหัวเป็นผลรวมของยอดเงินสุทธิในรายการบวกกับยอดเงินภาษีหรือไม่</span><span class="sxs-lookup"><span data-stu-id="2832a-122">**Gross amount** – Validates that the gross amount on the header is the sum of the net amounts on the lines plus the tax amount.</span></span>
- <span data-ttu-id="2832a-123">**ยอดเงินสุทธิ** – ตรวจสอบว่ายอดเงินสุทธิในส่วนหัวเป็นผลรวมของยอดเงินสุทธิในรายการหรือไม่</span><span class="sxs-lookup"><span data-stu-id="2832a-123">**Net amount** – Validates that the net amount on the header is the sum of the net amounts on the lines.</span></span>
- <span data-ttu-id="2832a-124">**การชำระเงินน้อยเกิน/การชำระเงินมากเกิน** – ตรวจสอบว่าความแตกต่างระหว่างยอดเงินรวมในส่วนหัวและยอดการชำระเงินไม่เกินกว่าการตั้งค่าคอนฟิกการชำระเงินน้อยเกิน/การชำระเงินมากเกินสูงสุดหรือไม่</span><span class="sxs-lookup"><span data-stu-id="2832a-124">**Under / Over payment** – Validates that the difference between the gross amount on the header and the payment amount doesn't exceed the maximum underpayment/overpayment configuration.</span></span>
- <span data-ttu-id="2832a-125">**ยอดส่วนลด** – ตรวจสอบว่ายอดส่วนลดในตารางส่วนลดและยอดส่วนลดในตารางรายการธุรกรรมสอดคล้องกันหรือไม่ และยอดส่วนลดในส่วนหัวเป็นผลรวมของยอดส่วนลดในรายการหรือไม่</span><span class="sxs-lookup"><span data-stu-id="2832a-125">**Discount amount** – Validates that the discount amount on the discount tables and the discount amount on the transaction line tables are consistent, and that the discount amount on the header is the sum of the discount amounts on the lines.</span></span>
- <span data-ttu-id="2832a-126">**ส่วนลดต่อรายการสินค้า** – ตรวจสอบว่าส่วนลดต่อรายการสินค้าในรายการธุรกรรมเป็นผลรวมของรายการทั้งหมดในตารางส่วนลดที่สัมพันธ์กับรายการธุรกรรมหรือไม่</span><span class="sxs-lookup"><span data-stu-id="2832a-126">**Line discount** – Validates that the line discount on the transaction line is the sum of all the lines in the discount table that corresponds to the transaction line.</span></span>
- <span data-ttu-id="2832a-127">**สินค้าจากบัตรของขวัญ** – Commerce ไม่รองรับการคืนสินค้าจากบัตรของขวัญ</span><span class="sxs-lookup"><span data-stu-id="2832a-127">**Gift card item** – Commerce doesn't support the return of gift card items.</span></span> <span data-ttu-id="2832a-128">อย่างไรก็ตาม ยอดดุลในบัตรของขวัญไม่สามารถแลกเป็นเงินสด สินค้าจากบัตรของขวัญที่ดำเนินการเป็นรายการส่งคืนแทนรายการแลกเป็นเงินสดไม่สามารถดำเนินกระบวนการลงรายการบัญชีใบแจ้งยอด</span><span class="sxs-lookup"><span data-stu-id="2832a-128">However, the balance on a gift card can be cashed out. Any gift card item that is processed as a return line instead of a cash-out line fails the statement posting process.</span></span> <span data-ttu-id="2832a-129">กระบวนการตรวจสอบความถูกต้องของสินค้าจากบัตรของขวัญจะช่วยรับประกันว่ามีเฉพาะสินค้าในรายการบัตรของขวัญในตารางธุรกรรมเท่านั้นที่เป็นรายการแลกเป็นเงินสดของบัตรของขวัญ</span><span class="sxs-lookup"><span data-stu-id="2832a-129">The validation process for gift card items helps guarantee that the only return gift card line items on the transaction tables are gift card cash-out lines.</span></span>
- <span data-ttu-id="2832a-130">**ราคาค่าลบ** – ตรวจสอบว่าไม่มีรายการธุรกรรมราคาค่าลบ</span><span class="sxs-lookup"><span data-stu-id="2832a-130">**Negative price** – Validates that there are no negative price transaction lines.</span></span>
- <span data-ttu-id="2832a-131">**สินค้าและสินค้าย่อย** – ตรวจสอบว่าสินค้าและสินค้าย่อยในรายการธุรกรรมมีอยู่ในไฟล์หลักสินค้าและสินค้าย่อยหรือไม่</span><span class="sxs-lookup"><span data-stu-id="2832a-131">**Item & Variant** – Validates that items and variants on the transaction lines exist in the item and variant master file.</span></span>
- <span data-ttu-id="2832a-132">**ยอดเงินภาษี** - ตรวจสอบว่าเรกคอร์ดภาษีตรงกับยอดเงินภาษีในรายการหรือไม่</span><span class="sxs-lookup"><span data-stu-id="2832a-132">**Tax amount** - Validates that tax records match the tax amounts on the lines.</span></span>
- <span data-ttu-id="2832a-133">**หมายเลขลำดับประจำสินค้า** - ตรวจสอบว่ามีหมายเลขลำดับประจำสินค้าอยู่ในรายการธุรกรรมสำหรับสินค้าที่ควบคุมโดยหมายเลขลำดับประจำสินค้าหรือไม่</span><span class="sxs-lookup"><span data-stu-id="2832a-133">**Serial number** - Validates that the serial number is present in the transaction lines for items that are controlled by serial number.</span></span>
- <span data-ttu-id="2832a-134">**เครื่องหมาย** - ตรวจสอบว่ามีเครื่องหมายสำหรับปริมาณและยอดเงินสุทธิเหมือนกันในรายการธุรกรรมทั้งหมดหรือไม่</span><span class="sxs-lookup"><span data-stu-id="2832a-134">**Sign** - Validates that the sign on the quantity and the net amount are the same in all the transaction lines.</span></span>
- <span data-ttu-id="2832a-135">**วันที่ทำการ** - ตรวจสอบว่ารอบระยะเวลาทางการเงินสำหรับวันที่ทำการทั้งหมดสำหรับธุรกรรมเปิดอยู่หรือไม่</span><span class="sxs-lookup"><span data-stu-id="2832a-135">**Business date** - Validates that the financial periods for all the business dates for the transactions are open.</span></span>

## <a name="set-up-the-consistency-checker"></a><span data-ttu-id="2832a-136">ตั้งค่าตัวตรวจสอบความสอดคล้องกัน</span><span class="sxs-lookup"><span data-stu-id="2832a-136">Set up the consistency checker</span></span>

<span data-ttu-id="2832a-137">ตั้งค่าคอนฟิกกระบวนการชุดงาน "ตรวจสอบความถูกต้องของธุรกรรมของร้านค้า" ที่ **Retail และ Commerce \> ข้อมูลไอทีสำหรับ Retail และ Commerce \> การลงรายการบัญชี POS** สำหรับการดำเนินการประจำงวด</span><span class="sxs-lookup"><span data-stu-id="2832a-137">Configure the "Validate store transactions" batch process, at **Retail and Commerce \> Retail and Commerce IT \> POS posting**, for periodic runs.</span></span> <span data-ttu-id="2832a-138">ชุดงานสามารถจัดกำหนดการตามลำดับชั้นขององค์กร เช่นเดียวกับวิธีการตั้งค่ากระบวนการ "คำนวณใบแจ้งยอดเป็นชุดงาน" และ "ลงรายการบัญชีใบแจ้งยอดเป็นชุดงาน"</span><span class="sxs-lookup"><span data-stu-id="2832a-138">The batch job can be scheduled based on store organization hierarchy, similar to how the "Calculate statement in batch" and "Post statement in batch" processes are set up.</span></span> <span data-ttu-id="2832a-139">เราขอแนะนำให้คุณตั้งค่าคอนฟิกกระบวนการชุดงานนี้เพื่อเรียกใช้วันละหลายครั้ง และจัดกำหนดการเพื่อให้ดำเนินการในตอนสิ้นสุดการดำเนินการของงาน P ทั้งหมด</span><span class="sxs-lookup"><span data-stu-id="2832a-139">We recommend that you configure this batch process to run multiple times in a day and schedule it so that it runs at the end of every P-job execution.</span></span>

## <a name="results-of-validation-process"></a><span data-ttu-id="2832a-140">ผลลัพธ์ของกระบวนการตรวจสอบความถูกต้อง</span><span class="sxs-lookup"><span data-stu-id="2832a-140">Results of validation process</span></span>

<span data-ttu-id="2832a-141">ผลลัพธ์ของการตรวจสอบความถูกต้องตามกระบวนการชุดงานได้รับการติดแท็กเป็นธุรกรรมที่เหมาะสม</span><span class="sxs-lookup"><span data-stu-id="2832a-141">The results of the validation check by the batch process are tagged on the appropriate transaction.</span></span> <span data-ttu-id="2832a-142">ฟิลด์ **สถานะการตรวจสอบความถูกต้อง** ในเรกคอร์ดธุรกรรมได้รับการตั้งค่าเป็น **สำเร็จ** หรือ **ผิดพลาด** และวันที่ของการดำเนินการตรวจสอบความถูกต้องครั้งล่าสุดจะปรากฏในฟิลด์ **เวลาที่ตรวจสอบความถูกต้องล่าสุด**</span><span class="sxs-lookup"><span data-stu-id="2832a-142">The **Validation status** field on the transaction record is either set to **Successful** or **Error**, and the date of the last validation run appears on the **Last validation time** field.</span></span>

<span data-ttu-id="2832a-143">หากต้องการดูข้อความคำอธิบายข้อผิดพลาดเพิ่มเติมที่เกี่ยวข้องกับความล้มเหลวในการตรวจสอบความถูกต้อง เลือกเรกคอร์ดธุรกรรมของร้านค้าที่เกี่ยวข้องและคลิกปุ่ม **ข้อผิดพลาดในการตรวจสอบความถูกต้อง**</span><span class="sxs-lookup"><span data-stu-id="2832a-143">To view more descriptive error text relating to a validation failure, select the relevant store transaction record and click the **Validation errors** button.</span></span>

<span data-ttu-id="2832a-144">ธุรกรรมที่ล้มเหลวในการตรวจสอบความถูกต้องและธุรกรรมที่ยังไม่ได้ตรวจสอบความถูกต้องจะไม่ถูกดึงลงในใบแจ้งยอด</span><span class="sxs-lookup"><span data-stu-id="2832a-144">Transactions that fail the validation check and transactions that have not yet been validated will not be pulled into statements.</span></span> <span data-ttu-id="2832a-145">ระหว่างกระบวนการ "คำนวณใบแจ้งยอด" ผู้ใช้จะได้รับแจ้งหากมีธุรกรรมที่น่าจะรวมอยู่ในใบแจ้งยอดแต่ไม่มีอยู่</span><span class="sxs-lookup"><span data-stu-id="2832a-145">During the "Calculate statement" process, users will be notified if there are transactions that could have been included in the statement but weren't.</span></span>

<span data-ttu-id="2832a-146">หากพบข้อผิดพลาดในการตรวจสอบความถูกต้อง วิธีเดียวในการแก้ไขข้อผิดพลาดคือการติดต่อฝ่ายสนับสนุนของ Microsoft</span><span class="sxs-lookup"><span data-stu-id="2832a-146">If a validation error is found, the only way to fix the error is to contact Microsoft Support.</span></span> <span data-ttu-id="2832a-147">ในรุ่นที่นำออกใช้ในอนาคต จะมีการเพิ่มความสามารถเพื่อให้ผู้ใช้สามารถแก้ไขเรกคอร์ดที่ล้มเหลวผ่านทางอินเทอร์เฟสผู้ใช้</span><span class="sxs-lookup"><span data-stu-id="2832a-147">In a future release, capability will be added so that users can fix the records that failed through the user interface.</span></span> <span data-ttu-id="2832a-148">ความสามารถในการลงบันทึกและการตรวจสอบยังสามารถใช้ในการติดตามประวัติการแก้ไขได้อีกด้วย</span><span class="sxs-lookup"><span data-stu-id="2832a-148">Logging and auditing capabilities will also be made available to trace the history of the modifications.</span></span>

> [!NOTE]
> <span data-ttu-id="2832a-149">กฎการตรวจสอบความถูกต้องเพิ่มเติมที่จะรองรับสถานการณ์อื่นๆ จะได้รับการเพิ่มลงในรุ่นที่นำออกใช้ในอนาคต</span><span class="sxs-lookup"><span data-stu-id="2832a-149">Additional validation rules to support more scenarios will be added in a future release.</span></span>
