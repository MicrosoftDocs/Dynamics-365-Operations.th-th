---
title: โพรไฟล์ใบรับรองที่ผู้ใช้กำหนดสำหรับร้านค้าปลีก
description: บทความนี้อธิบายภาพรวมของโพรไฟล์ใบรับรองที่พร้อมใช้งานใน Microsoft Dynamics 365 Commerce
author: josaw1
ms.date: 09/21/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: josaw
ms.search.region: Global
ms.author: v-chgriffin
ms.search.validFrom: 2020-10-09
ms.dyn365.ops.version: 10.0.15
ms.search.industry: Retail
ms.search.form: RetailFormLayout, RetailParameters
ms.openlocfilehash: 5baf043a43210d819b605546089e981c86922ca9
ms.sourcegitcommit: 4f28f262cfb8f047cb5c0070261aa0748835e74b
ms.translationtype: HT
ms.contentlocale: th-TH
ms.lasthandoff: 09/21/2022
ms.locfileid: "9558449"
---
# <a name="user-defined-certificate-profiles-for-retail-stores"></a>โพรไฟล์ใบรับรองที่ผู้ใช้กำหนดสำหรับร้านค้าปลีก

[!include [banner](../includes/banner.md)]

บทความนี้อธิบายภาพรวมของโพรไฟล์ใบรับรองที่พร้อมใช้งานใน Microsoft Dynamics 365 Commerce ฟังก์ชันนี้ขยายคุณลักษณะ [จัดการความลับสำหรับช่องทางการขายปลีก](../dev-itpro/manage-secrets.md) โดยการเพิ่มการสนับสนุนสำหรับใบรับรองเฉพาะที่

ในขณะที่การขายหน้าร้าน (POS) กำลังทำงานอยู่ในโหมดออฟไลน์ จะไม่สามารถเข้าถึงใบรับรองที่จัดเก็บอยู่ใน Microsoft Azure Key Vault ควรใช้ใบรับรองเฉพาะที่แทน ระบบสนับสนุนความสามารถต่อไปนี้:

- การใช้ใบรับรองเฉพาะที่ในสถานการณ์ทางเลือกสำรองของ Key Vault
- การใช้ใบรับรองเฉพาะที่โดยไม่มี Key Vault (ตัวอย่างเช่น ในการติดตั้งในสถานที่)
- การอัปเดตในใบรับรองแบบค่อยเป็นค่อยไป มีที่จัดเก็บและเทอร์มินัลบางร้านใช้ใบรับรองรุ่นใหม่ แต่ที่จัดเก็บและเทอร์มินัลอื่นๆ ยังคงใช้รุ่นก่อนหน้านี้

ฟังก์ชันของโพรไฟล์ใบรับรองช่วยให้คุณสามารถระบุใบรับรองเริ่มต้นและตั้งค่าใบสั่งที่ใบรับรองในโพรไฟล์ใบรับรองเดียวกันจะถูกค้นหา ฟังก์ชันนี้ยังมีวิธีการตั้งค่าที่คล้ายกันสำหรับใบรับรองเฉพาะที่และใบรับรอง Key Vault คุณสามารถเพิ่มการตั้งค่าเฉพาะบริษัทสำหรับใบรับรอง แต่จะมีการใช้ตัวระบุข้ามบริษัทเฉพาะสำหรับใบรับรองแต่ละใบในช่องทาง Commerce

### <a name="scenarios"></a>สถานการณ์

ฟังก์ชันของโพรไฟล์ใบรับรองสนับสนุนสถานการณ์ต่อไปนี้ในช่องทาง Commerce:

- ใช้ใบรับรองเฉพาะที่ในสถานการณ์ทางเลือกสำรองของ Key Vault ต่อไปนี้เป็นตัวอย่างของสถานการณ์ทางเลือกสำรองเหล่านี้:

    - ไม่สามารถเข้าถึงพื้นที่เก็บข้อมูลของ Key Vault ได้
    - ไม่พบใบรับรองในที่เก็บ Key Vault
    - POS กำลังรันอยู่ในโหมดออฟไลน์

- ใช้ใบรับรองเฉพาะที่ แต่ไม่มีการเก็บใบรับรองใน Key Vault (ตัวอย่างเช่น ในการติดตั้งในสถานที่)
- ทำการปรับปรุงใบรับรองแบบค่อยเป็นค่อยไป ที่ซึ่งใช้ใบรับรองรุ่นใหม่เท่านั้นในที่จัดเก็บหรือบนเทอร์มินัลที่มีรุ่นใหม่พร้อมใช้งานอยู่แล้ว
- ใช้ใบรับรองเดียวกันในหลายบริษัท

## <a name="set-up-certificate-profiles"></a>การตั้งค่าโพรไฟล์ใบรับรอง

กระบวนงานต่อไปนี้อธิบายวิธีการตั้งค่าโพรไฟล์ใบรับรอง

### <a name="set-up-key-vault"></a>ตั้งค่า Key Vault

คุณต้องปฏิบัติตามขั้นตอนต่อไปนี้ก่อนคุณจึงจะสามารถใช้ใบรับรองดิจิทัลที่จัดเก็บไว้ในที่จัดเก็บ Key Vault

1. สร้างบัญชีที่เก็บข้อมูล Key Vault ขอแนะนำว่าคุณควรใช้งานบัญชีที่เก็บข้อมูลในพื้นที่ทางภูมิศาสตร์เดียวกันกับ Commerce Scale Unit
1. อัปโหลดใบรับรองดิจิทัลไปยังบัญชีที่เก็บข้อมูล Key Vault
1. อนุญาตให้แอปพลิเคชัน Application Object Server (AOS) อ่านข้อมูลลับจากบัญชีที่เก็บข้อมูล Key Vault

หากต้องการทราบข้อมูลเพิ่มเติมเกี่ยวกับวิธีใช้งาน Key Vault โปรดดูที่ [เริ่มต้นการใช้งานกับ Azure Key Vault](/azure/key-vault/key-vault-get-started)

### <a name="set-up-system-parameters"></a>ตั้งค่าพารามิเตอร์ระบบ

ก่อนที่คุณจะตั้งค่าคอนฟิกโพรไฟล์ใบรับรองในช่องทาง Commerce คุณต้องเปิดใช้งาน Commerce เพื่อใช้ทั้งใบรับรองที่จัดเก็บอยู่ในโพรไฟล์ Key Vault และโพรไฟล์ใบรับรอง

ในการตั้งค่าพารามิเตอร์ระบบใน Commerce headquarters ให้ทำตามขั้นตอนเหล่านี้

1. บนหน้า **พารามิเตอร์ระบบ** ให้ตั้งค่าตัวเลือก **ใช้ที่เก็บใบรับรองขั้นสูง** เป็น **ใช่**
1. ในพื้นที่ทำงาน **การจัดการคุณลักษณะ** ให้เปิดคุณลักษณะ **โพรไฟล์ใบรับรองที่กำหนดโดยผู้ใช้สำหรับที่จัดเก็บปลีก**

### <a name="set-up-key-vault-parameters"></a>ตั้งค่าพารามิเตอร์ Key Vault

บนหน้า **พารามิเตอร์ Key Vault** คุณต้องระบุพารามิเตอร์ต่อไปนี้เพื่อเข้าถึงที่เก็บข้อมูล Key Vault:

- **ชื่อ** และ **คำอธิบาย** – ชื่อและคำอธิบายของบัญชีที่เก็บข้อมูล Key Vault
- **URL ของ Key Vault** – URL ของบัญชีที่เก็บข้อมูล Key Vault
- **ไคลเอ็นต์ Key Vault** – รหัสไคลเอ็นต์เชิงโต้ตอบของแอปพลิเคชัน Azure Active Directory (Azure AD) ที่เชื่อมโยงกับบัญชีที่เก็บข้อมูล Key Vault เพื่อวัตถุประสงค์การรับรองความถูกต้อง ไคลเอ็นต์นี้ควรจะมีสิทธิ์อ่านข้อมูลลับจากบัญชีที่เก็บข้อมูล
- **คีย์ลับ Key Vault** – คีย์ลับที่เชื่อมโยงกับแอปพลิเคชัน Azure AD ที่ใช้การรับรองความถูกต้องในบัญชีที่เก็บข้อมูล Key Vault
- **ชื่อ** **รายละเอียด** และ **การอ้างอิงข้อมูลลับ** – ชื่อ รายละเอียด และการอ้างอิงข้อมูลลับของใบรับรอง

สำหรับข้อมูลเพิ่มเติม ให้ดู [ตั้งค่าไคลเอ็นต์ของ Azure Key Vault](../../finance/localizations/setting-up-azure-key-vault-client.md)

### <a name="configure-a-certificate-profile"></a>ตั้งค่าคอนฟิกโพรไฟล์ใบรับรอง

หากต้องการตั้งค่าคอนฟิกโพรไฟล์ใบรับรองใน Commerce headquarters ให้ทำตามขั้นตอนต่อไปนี้

1. ไปที่ **การจัดการระบบ \> การตั้งค่า \> โพรไฟล์ใบรับรอง**
1. ในบานหน้าต่างการดำเนินการ เลือก **ใหม่** เพื่อสร้างเรกคอร์ด
1. ป่อนค่าในฟิลด์ **โพรไฟล์ใบรับรอง**, **ชื่อ** และ **คำอธิบาย**

    > [!NOTE]
    > โพรไฟล์ใบรับรองเป็นตัวระบุเฉพาะของใบรับรองระหว่างบริษัทและส่วนประกอบ Commerce ทั้งหมด

1. บนแท็บด่วน **นิติบุคคล** ให้เลือก **เพิ่ม** เพื่อเพิ่มบรรทัด
1. ภายใต้ **นิติบุคคล** ให้เลือกนิติบุคคล (บริษัท) ที่ควรใช้โพรไฟล์ใบรับรองปัจจุบัน

    ถ้าควรใช้โพรไฟล์ใบรับรองสำหรับนิติบุคคลหลายราย ให้ทำซ้ำขั้นตอนที่ 4 และ 5 เพื่อเพิ่มบรรทัดสำหรับแต่ละนิติบุคคลเพิ่มเติม

1. เลือก **การตั้งค่า** เพื่อเปิดหน้า **การตั้งค่าโพรไฟล์ใบรับรอง** ซึ่งคุณสามารถป้อนการตั้งค่าเฉพาะบริษัทสำหรับโพรไฟล์ใบรับรอง ระบุว่าจะใช้ใบรับรองใดเมื่อเรียกใช้โพรไฟล์ใบรับรองปัจจุบันในช่องทาง Commerce เพิ่มใบรับรองได้มากตามที่ต้องการ และตั้งค่าลำดับความสำคัญให้กับใบรับรอง ถ้าใบรับรองที่มีลำดับความสำคัญสูงกว่าไม่พร้อมใช้งาน ระบบจะใช้ใบรับรองลำดับถัดไปตามลำดับความสำคัญ สำหรับข้อมูลเพิ่มเติม โปรดดูส่วน [ลำดับงาน: การค้นหาใบรับรองใน Commerce Runtime](#workflow-searching-certificates-in-the-commerce-runtime)

    > [!NOTE]
    > ฟิลด์ **ลำดับความสำคัญ** จะถูกตั้งค่าโดยอัตโนมัติ ค่าของ **1** แสดงถึงระดับความสำคัญสูงสุด เมื่อมีการเพิ่มบรรทัดใหม่บนหน้า **การตั้งค่าโพรไฟล์ใบรับรอง** ระดับความสำคัญจะถูกตั้งค่าเป็นหมายเลขที่มากกว่าระดับความสำคัญของบรรทัดก่อนหน้านี้ เมื่อต้องการเปลี่ยนระดับความสำคัญของบรรทัดที่ระบุ ให้เลือกบรรทัด แล้วเลือก **เลื่อนขึ้น** เพื่อเพิ่มระดับความสำคัญหรือ **เลื่อนลง** เพื่อลดระดับความสำคัญ

1. เมื่อคุณเพิ่มบรรทัดใหม่ลงในหน้า **การตั้งค่าโพรไฟล์ใบรับรอง** ให้ตั้งค่าฟิลด์ต่อไปนี้:

    - **ชนิดของสถานที่** – เลือกสถานที่เก็บที่มีการจัดเก็บใบรับรอง ฟิลด์นี้มีค่าที่เป็นไปได้ที่เป็นไปได้สองค่า: **ใบรับรองเฉพาะที่** และ **Key Vault**
    - **ใบรับรอง Key Vault** – จำเป็นต้องใช้ฟิลด์นี้ถ้าคุณตั้งค่าฟิลด์ **ชนิดของสถานที่ที่** เป็น **Key Vault** ใช้เพื่อระบุความลับของใบรับรอง Key Vault
    - **ชื่อที่จัดเก็บ** – ฟิลด์นี้เป็นฟิลด์ที่ไม่จำเป็นต้องระบุและจะพร้อมใช้งานเฉพาะเมื่อคุณตั้งค่าฟิลด์ **ชนิดสถานที่** เป็น **ใบรับรองเฉพาะที่** เท่านั้น ใช้เพื่อระบุชื่อที่จัดเก็บเริ่มต้นที่ควรใช้ในการค้นหาใบรับรองเฉพาะที่
    - **ที่ตั้งที่จัดเก็บ** – ฟิลด์นี้เป็นฟิลด์ที่ไม่จำเป็นต้องระบุและจะพร้อมใช้งานเฉพาะเมื่อคุณตั้งค่าฟิลด์ **ชนิดสถานที่** เป็น **ใบรับรองเฉพาะที่** เท่านั้น ใช้เพื่อระบุที่ตั้งที่จัดเก็บเริ่มต้นที่ควรใช้ในการค้นหาใบรับรองเฉพาะที่

        > [!NOTE]
        > ชื่อที่จัดเก็บเริ่มต้นและที่ตั้งที่จัดเก็บจะถูกเพิ่มเพื่อทำให้กระบวนการของการค้นหาใบรับรองเฉพาะที่ใน Commerce Runtime เป็นไปได้ง่ายขึ้น X509StoreProvider มีรายการของโฟลเดอร์ที่จัดเก็บใบรับรอง ถ้าไม่ได้ระบุชื่อที่จัดเก็บเริ่มต้นและที่ตั้งที่จัดเก็บเริ่มต้น X509StoreProvider จะพยายามค้นหาใบรับรองในโฟลเดอร์อื่นในรายการ สำหรับข้อมูลเพิ่มเติมเกี่ยวกับค่าที่มีอยู่ของชื่อที่จัดเก็บและที่ตั้งที่จัดเก็บ โปรดดู [การแจงนับของ StoreName](/dotnet/api/system.security.cryptography.x509certificates.storename) และ [การแจงนับของ StoreLocation](//dotnet/api/system.security.cryptography.x509certificates.storelocation)

    - **รหัสประจำตัว** – ฟิลด์นี้เป็นฟิลด์ที่จำเป็นต้องระบุและจะพร้อมใช้งานเฉพาะเมื่อคุณตั้งค่าฟิลด์ **ชนิดสถานที่** เป็น **ใบรับรองเฉพาะที่** เท่านั้น ใช้เพื่อระบุรหัสประจำตัวของใบรับรอง

        > [!IMPORTANT]
        > คุณต้องตรวจสอบให้แน่ใจว่าผู้ใช้ที่เรียกใช้แอปพลิเคชันที่ต้องใช้ใบรับรองเฉพาะที่ (ตัวอย่างเช่น Modern POS ในโหมดออฟไลน์) มีสิทธิ์เข้าถึงคีย์ส่วนตัวของใบรับรองแบบอ่านอย่างเดียวเป็นอย่างน้อย

    - **ข้อคิดเห็น** – ฟิลด์นี้ไม่จำเป็นต้องระบุและให้ผู้ใช้ป้อนหมายเหตุ

## <a name="workflow-searching-certificates-in-the-commerce-runtime"></a>เวิร์กโฟลว์: กำลังค้นหาใบรับรองใน Commerce Runtime

ต่อไปนี้เป็นเวิร์กโฟลว์พื้นฐานที่ใช้ในการค้นหาใบรับรองเมื่อมีการเรียกใช้โพรไฟล์ใบรับรองใน Commerce Runtime

1. ระบบระบุว่าโพรไฟล์ใบรับรองมีการตั้งค่าเฉพาะบริษัทสำหรับนิติบุคคลปัจจุบันหรือไม่
1. ระบบพยายามค้นหาใบรับรองโดยใช้ค่าในหน้า **การตั้งค่าโพรไฟล์ใบรับรอง** สำหรับบรรทัดที่ฟิลด์ **ระดับความสำคัญ** ถูกตั้งค่าเป็น **1**

    - ถ้าฟิลด์ **ชนิดของสถานที่** ถูกตั้งค่าเป็น **Key Vault** ค่าของฟิลด์ **ความลับของใบรับรอง Key Vault** จะใช้ในการค้นหาใบรับรองบนหน้า **พารามิเตอร์ของ Key Vault** จากนั้นจะมีการค้นหาใบรับรองในที่เก็บ Key Vault
    - ถ้าฟิลด์ **ชนิดของสถานที่** ถูกตั้งค่าเป็น **ใบรับรองเฉพาะที่** X509StoreProvider จะค้นหาใบรับรองเป็นอันดับแรก โดยใช้ชื่อที่จัดเก็บและที่ตั้งที่จัดเก็บเริ่มต้น ถ้ามีการระบุพารามิเตอร์เหล่านี้ แล้วค้นหาในโฟลเดอร์อื่นๆ ทั้งหมดในรายการของโฟลเดอร์

1. ถ้าไม่พบใบรับรอง กระบวนการจะถูกทำซ้ำสำหรับบรรทัดที่ฟิลด์ **ระดับความสำคัญ** ถูกตั้งค่าเป็น **2** และต่อไป

> [!NOTE]
> ถ้าโพรไฟล์ใบรับรองไม่มีการตั้งค่าสำหรับนิติบุคคลปัจจุบัน หรือถ้าการค้นหาใบรับรองไม่สำเร็จสำหรับบรรทัดทั้งหมดในหน้า **การตั้งค่าโพรไฟล์ใบรับรอง** จะไม่พบใบรับรอง

### <a name="caching-the-results-of-certificate-searches"></a>การแคชผลลัพธ์ของการค้นหาใบรับรอง

ผลลัพธ์ของการค้นหาใบรับรองถูกแคช เวลาหมดอายุเริ่มต้นสำหรับแคชเป็นหนึ่งชั่วโมง อย่างไรก็ตาม คุณสามารถปรับแต่งเวลานี้และสามารถตั้งค่าสูงสุดได้ 24 ชั่วโมง

## <a name="gradual-update"></a>ปรับปรุงแบบค่อยเป็นค่อยไป

ถ้ามีการนำใบรับรองรุ่นใหม่ไปใช้ แต่จะไม่สามารถอัปเดตในที่จัดเก็บทั้งหมดในเวลาเดียวกัน ฟังก์ชันของโพรไฟล์ใบรับรองเปิดใช้งานใบรับรองจะถูกอัปเดตแบบค่อยเป็นค่อยไป

1. ค้นหาโพรไฟล์ใบรับรองและบรรทัดที่ควรได้รับการอัปเดต แล้วเลือก **การตั้งค่า**
1. เพิ่มบรรทัด และระบุการตั้งค่าที่เกี่ยวข้องกับใบรับรองรุ่นล่าสุด
1. เพิ่มค่า **ระดับความสำคัญ** ของบรรทัดใหม่ ใช้ปุ่ม **เลื่อนขึ้น** เพื่อเลื่อนบรรทัดเพื่อให้อยู่เหนือบรรทัดสำหรับใบรับรองเดียวกันกับรุ่นก่อนหน้านี้
> [!NOTE]
> ใน Commerce Runtime ใบรับรองรุ่นใหม่จะถูกเรียกก่อน ถ้าใบรับรองยังไม่ได้รับการอัปเดตบนที่จัดเก็บหรือบนเทอร์มินัลเฉพาะหนึ่งๆ จะมีการเรียกรุ่นก่อนหน้านี้


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
