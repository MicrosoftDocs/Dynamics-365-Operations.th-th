---
title: ตัวอย่างการรวมอุปกรณ์ควบคุมสำหรับสวีเดน
description: บทความนี้อธิบายภาพรวมของตัวอย่างการรวมทางบัญชีสำหรับสวีเดนใน Microsoft Dynamics 365 Commerce
author: EvgenyPopovMBS
ms.date: 12/20/2021
ms.topic: article
audience: Application User, Developer, IT Pro
ms.reviewer: v-chgriffin
ms.search.region: Global
ms.author: epopov
ms.search.validFrom: 2019-10-08
ms.openlocfilehash: 11ce0b146f2e64092b0d03dc7416660d76380cd0
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: th-TH
ms.lasthandoff: 06/03/2022
ms.locfileid: "8885413"
---
# <a name="control-unit-integration-sample-for-sweden"></a>ตัวอย่างการรวมอุปกรณ์ควบคุมสำหรับสวีเดน

[!include [banner](../includes/banner.md)]

บทความนี้อธิบายภาพรวมของตัวอย่างการรวมทางบัญชีสำหรับสวีเดนใน Microsoft Dynamics 365 Commerce

> [!NOTE]
> ฟังก์ชันการรวมทางการเงินตัวอย่างนี้จะแทนที่ [ตัวอย่างการรวม POS กับอุปกรณ์ควบคุมสำหรับสวีเดน](retail-sdk-control-unit-sample.md) ก่อนหน้านี้ ตัวอย่างก่อนหน้านี้ไม่ได้ใช้ประโยชน์จาก [กรอบงานการรวมทางการเงิน](./fiscal-integration-for-retail-channel.md) และจะล้าสมัยในการอัปเดตในอนาคต หากต้องการทราบข้อมูลเพิ่มเติมเกี่ยวกับวิธีการย้ายจากตัวอย่างก่อนหน้านี้ไปยังตัวอย่างที่สอดคล้องกับ Dynamics 365 Commerce รุ่น **10.0.22 และก่อนหน้านั้น** โปรดดู [การย้ายจากตัวอย่างการรวมก่อนหน้านี้](emea-swe-fi-sample-sdk.md#migrating-from-the-earlier-integration-sample)

ฟังก์ชัน Commerce สำหรับสวีเดนรวมตัวอย่างการรวมจุดขายหน้าร้าน (POS) เข้ากับอุปกรณ์การเงินเฉพาะสวีเดน ซึ่งเรียกอีกอย่างว่า *อุปกรณ์ควบคุม* ตัวอย่างนี้จะขยาย [ฟังก์ชันการรวมทางการเงิน](fiscal-integration-for-retail-channel.md) สมมุติว่าอุปกรณ์ควบคุมเชื่อมต่อทางกายภาพกับสถานีฮาร์ดแวร์ที่ POS จับคู่ด้วย ตัวอย่างเช่น ตัวอย่างนี้จะใช้ Application Programming Interface (API) ของอุปกรณ์ควบคุม [CleanCash Type A](https://www.retailinnovation.se/produkter) โดย Retail Innovation HTT AB ใช้รุ่น 1.1.4 ของ CleanCash API

ตัวอย่างมีให้ในรูปแบบของรหัสต้นฉบับและเป็นส่วนหนึ่งของชุดการพัฒนาซอฟต์แวร์ (SDK) ของการขายปลีก

Microsoft ไม่ได้ปล่อยฮาร์ดแวร์ ซอฟต์แวร์ หรือเอกสารใดๆ จาก Retail Innovation HTT AB หากต้องการทราบข้อมูลเพิ่มเติมเกี่ยวกับวิธีใช้งานอุปกรณ์ควบคุมและดําเนินงาน ให้ติดต่อ [Retail Innovation HTT AB](https://www.retailinnovation.se/)

## <a name="scenarios"></a>สถานการณ์จำลอง

ตัวอย่างการรวมอุปกรณ์ควบคุมสำหรับสวีเดนประกอบด้วยความสามารถต่อไปนี้

- การขาย การส่งคืน และสำเนาใบเสร็จจะได้รับการลงทะเบียนโดยอัตโนมัติในอุปกรณ์ควบคุมที่เชื่อมต่อกับสถานีฮาร์ดแวร์ที่จับคู่กับ POS
- รหัสควบคุมและหมายเลขการผลิตของอุปกรณ์ควบคุมองธุรกรรมที่ลงทะเบียนจะถูกรวบรวมจากอุปกรณ์ควบคุมและบันทึกในธุรกรรม ข้อมูลนี้ยังถูกอ้างอิงเป็น *การตอบสนองทางการเงิน* การตอบสนองทางการเงินสามารถดูในหน้า **ธุรกรรมของร้านค้า**
- ฟิลด์ที่กำหนดเองของรหัสควบคุมและหมายเลขการผลิตของหน่วยควบคุมสามารถเพิ่มในโครงร่างใบเสร็จได้ ด้วยวิธีนี้ คุณสามารถพิมพ์การตอบสนองทางการเงินของธุรกรรมบนใบเสร็จได้
- การตอบสนองทางการเงินจะแสดงอยู่ในรายงานช่องทาง **สมุดรายวันทางอิเล็กทรอนิกส์ (สวีเดน)**
- มีตัวเลือกในการจัดการข้อผิดพลาดอยู่หลายตัวเลือก ยกตัวอย่างเช่น

    - ลองลงทะเบียนทางการเงินอีกครั้ง ถ้าสามารถลองใหม่ได้ คุณสามารถลองลงทะเบียนทางการเงินใหม่ได้ ตัวอย่างเช่น ถ้าอุปกรณ์ควบคุมไม่เชื่อมต่อ ไม่พร้อม หรือไม่ตอบสนอง
    - เลื่อนการลงทะเบียนทางการเงินออกไป
    - ข้ามการลงทะเบียนทางการเงิน หรือเลือกธุรกรรมเป็นลงทะเบียนแล้ว และรวมรหัสข้อมูลเพื่อรวบรวมข้อมูลเหตุผลของความล้มเหลวและข้อมูลเพิ่มเติม
    - ตรวจสอบความพร้อมใช้งานของอุปกรณ์ควบคุมก่อนที่จะเปิดธุรกรรมการขายใหม่ หรือสรุปธุรกรรมการขายแล้ว

### <a name="limitations-of-the-sample"></a>ข้อจํากัดของตัวอย่าง

ตัวอย่างการรวมอุปกรณ์ควบคุมสำหรับสวีเดนไม่สนับสนุนสถานการณ์ใบสั่งของลูกค้าในปัจจุบัน

## <a name="setting-up-the-integration-with-control-units"></a>การตั้งค่าการรวมระบบ POS กับอุปกรณ์ควบคุม

หากต้องการทราบข้อมูลเพิ่มเติมเกี่ยวกับการตั้งค่าที่ต้องใช้ในสวีเดน โปรดดูที่ [การตั้งค่า Commerce สำหรับสวีเดน](./emea-swe-cash-registers.md#setting-up-commerce-for-sweden)

### <a name="configuring-swedenspecific-receipts"></a>การตั้งค่าคอนฟิกใบเสร็จเฉพาะสวีเดน

#### <a name="configure-custom-fields-so-that-they-can-be-used-in-receipt-formats-for-sales-receipts"></a>ตั้งค่าคอนฟิกฟิลด์ที่กําหนดเองเพื่อให้สามารถใช้ฟิลด์เหล่านั้นในรูปแบบใบเสร็จของใบเสร็จได้

คุณสามารถตั้งค่าคอนฟิกข้อความภาษาและฟิลด์ที่กําหนดเองที่ใช้ในรูปแบบใบเสร็จ POS ได้ บริษัทเริ่มต้นของผู้ใช้ที่สร้างการตั้งค่าใบเสร็จควรเป็นนิติบุคคลเดียวกันที่มีการสร้างการตั้งค่าข้อความภาษาขึ้น หรือควรสร้างข้อความภาษาเดียวกันในทั้งบริษัทเริ่มต้นของผู้ใช้และนิติบุคคลของร้านค้าที่มีการสร้างการตั้งค่าให้

ในหน้า **ข้อความภาษา** ให้เพิ่มเรกคอร์ดต่อไปนี้ของป้ายชื่อของฟิลด์แบบกำหนดเองเป็นโครงร่างของใบเสร็จ โปรดทราบว่ามีเพียงค่า **รหัสภาษา** **รหัสข้อความ** และ **ข้อความ** ที่แสดงในตารางเท่านั้น คุณสามารถเปลี่ยนเพื่อให้ตรงกับความต้องการของคุณได้ อย่างไรก็ตาม ค่า **รหัสข้อความ** ที่คุณใช้ต้องเป็นค่าเฉพาะ และต้องเท่ากับหรือมากกว่า 900001

เพิ่มป้ายชื่อ POS ต่อไปนี้ลงในส่วน **POS** ของหน้า **ข้อความภาษา**

| รหัสภาษา | รหัสข้อความ | ข้อความ                  |
|-------------|---------|-----------------------|
| th       | 900001  | รหัสควบคุมการลงทะเบียน |
| th       | 900002  | อุปกรณ์ลงทะเบียน       |

ในหน้า **ฟิลด์ที่กำหนดเอง** ให้เพิ่มเรกคอร์ดต่อไปนี้ของฟิลด์แบบกำหนดเองเป็นโครงร่างของใบเสร็จ โปรดทราบว่าค่า **รหัสข้อความคำอธิบาย** ต้องสอดคล้องกับค่า **รหัสข้อความ** ที่คุณระบุไว้ในหน้า **ข้อความภาษา**

| ชื่อ                         | ชนิด    | รหัสข้อความของคำอธิบาย |
|------------------------------|---------|-----------------|
| SE_FISCALREGISTERCONTROLCODE | ใบเสร็จรับเงิน | 900001          |
| SE_FISCALREGISTERID          | ใบเสร็จรับเงิน | 900002          |

> [!NOTE]
> คุณควรระบุชื่อฟิลด์ที่ศุลกากรซึ่งถูกต้อง ตามที่แสดงรายการไว้ในตารางข้างบน ชื่อฟิลด์ที่กำหนดเองไม่ถูกต้องจะทําให้เกิดข้อมูลที่ขาดหายไปในใบเสร็จ

#### <a name="configure-receipt-formats"></a>ตั้งค่าคอนฟิกรูปแบบใบเสร็จ

สำหรับรูปแบบใบเสร็จที่จำเป็นทั้งหมด ให้เปลี่ยนค่าของฟิลด์ **ลักษณะการพิมพ์** เป็น **พิมพ์เสมอ**

ในตัวออกแบบรูปแบบใบเสร็จ ให้เพิ่มฟิลด์ที่กำหนดเองต่อไปนี้ลงในส่วน **ท้าย** โปรดสังเกตว่าชื่อฟิลด์จะตรงกับข้อความภาษาที่คุณกําหนดไว้ในส่วนก่อนหน้านี้ของบทความนี้

- **รหัสควบคุมการลงทะเบียน** – ฟิลด์นี้จะพิมพ์รหัสควบคุม
- **อุปกรณ์ลงทะเบียน** – ฟิลด์นี้จะพิมพ์หมายเลขการผลิตของอุปกรณ์ควบคุม

สำหรับข้อมูลเพิ่มเติมเกี่ยวกับวิธีทำงานกับรูปแบบใบเสร็จ ดู [รูปแบบใบเสร็จและการพิมพ์](../receipt-templates-printing.md)

### <a name="set-up-fiscal-integration-for-sweden"></a>ตั้งค่าการรวมทางการเงินสำหรับสวีเดน

ตัวอย่างการรวมอุปกรณ์ควบคุมของสวีเดนยึดตาม [ฟังก์ชันการรวมทางการเงิน](fiscal-integration-for-retail-channel.md) และเป็นส่วนหนึ่งของ Retail SDK ตัวอย่างอยู่ในโฟลเดอร์ **src\\FiscalIntegration\\CleanCash** ของที่เก็บ [โซลูชัน Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/) (ตัวอย่างเช่น [ตัวอย่างในรุ่น/9.33](https://github.com/microsoft/Dynamics365Commerce.Solutions/tree/release/9.33/src/FiscalIntegration/CleanCash)) ตัวอย่าง [ประกอบด้วย](fiscal-integration-for-retail-channel.md#fiscal-registration-process-and-fiscal-integration-samples-for-fiscal-devices-and-services) ของตัวให้บริการเอกสารทางการเงิน ซึ่งเป็นส่วนขยายของ Commerce Runtime (CRT) และตัวเชื่อมต่อทางการเงิน ซึ่งเป็นส่วนขยายของ Commerce Hardware Station หากต้องการทราบข้อมูลเพิ่มเติมเกี่ยวกับวิธีการใช้ Retail SDK โปรดดู [สถาปัตยกรรม Retail SDK](../dev-itpro/retail-sdk/retail-sdk-overview.md) และ [ตั้งค่าไปป์ไลน์การสร้างของ SDK บรรจุภัณฑ์อิสระ](../dev-itpro/build-pipeline.md)

> [!WARNING]
> เนื่องจากข้อจํากัดของ [แบบจำลองบรรจุภัณฑ์และส่วนขยายอิสระใหม่](../dev-itpro/build-pipeline.md) จึงไม่สามารถใช้กับตัวอย่างการรวมทางการเงินนี้ได้ในขณะนี้ คุณต้องใช้ Retail SDK บนเครื่องเสมือนของนักพัฒนา (VM) ใน Microsoft Dynamics Lifecycle Services (LCS) รุ่นก่อนหน้านี้ หากต้องการข้อมูลเพิ่มเติม โปรดดูที่ [แนวทางการปรับใช้งานตัวอย่างการรวมอุปกรณ์ควบคุมของสวีเดน (ดั้งเดิม)](emea-swe-fi-sample-sdk.md)
>
> มีการวางแผนการสนับสนุนรูปแบบบรรจุภัณฑ์และส่วนขยายอิสระใหม่จากตัวอย่างการรวมทางการเงินกับรุ่นที่ใหม่กว่า

ปฏิบัติตามขั้นตอนการตั้งค่าการรวมทางการเงินตามที่อธิบายไว้ใน [การตั้งค่าการรวมทางการเงินของช่องทาง Commerce](setting-up-fiscal-integration-for-retail-channel.md)

1. [ตั้งค่ากระบวนการการลงทะเบียนทางการเงิน](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process) นอกจากนี้ ให้จดบันทึกการตั้งค่าต่างๆ ของกระบวนการลงทะเบียนทางการเงินที่ใช้กับ [ตัวอย่างการรวมอุปกรณ์ควบคุมนี้โดยเฉพาะ](#set-up-the-registration-process)
1. [กำหนดการตั้งค่าการจัดการข้อผิดพลาด](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings)
1. [เปิดใช้งานการดำเนินการด้วยตนเองของการลงทะเบียนทางการเงินที่เลื่อนออกไปแล้ว](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration)
1. [ตั้งค่าคอนฟิกส่วนประกอบช่องทาง](#configure-channel-components)

### <a name="set-up-the-registration-process"></a>ตั้งค่ากระบวนการลงทะเบียน

เมื่อต้องการเปิดใช้งานกระบวนการการลงทะเบียน ให้ทําตามขั้นตอนต่อไปนี้เพื่อตั้งค่าศูนย์ควบคุม Commerce สำหรับข้อมูลเพิ่มเติม ดูที่ [ตั้งค่าการรวมทางการเงินสำหรับช่องทาง Commerce](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process)

1. ดาวน์โหลดไฟล์การตั้งค่าคอนฟิกสำหรับผู้ให้บริการเอกสารทางการเงินและตัวเชื่อมต่อทางการเงิน:

    1. เปิดที่เก็บ [โซลูชัน Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/)
    1. เลือกรุ่นสาขาที่นำออกใช้ที่ถูกต้องตามรุ่น SDK/แอปพลิเคชันของคุณ (ตัวอย่างเช่น **[รุ่น/9.33](https://github.com/microsoft/Dynamics365Commerce.Solutions/tree/release/9.33)**)
    1. เปิด **src \> FiscalIntegration \> CleanCash**
    1. ดาวน์โหลดไฟล์การตั้งค่าคอนฟิกผู้ให้บริการเอกสารทางการเงินที่ **CommerceRuntime \> DocumentProvider.CleanCashSample \> Configuration \> DocumentProviderFiscalCleanCashSample.xml** (ตัวอย่างเช่น [ไฟล์ของรุ่น/9.33](https://github.com/microsoft/Dynamics365Commerce.Solutions/blob/release/9.33/src/FiscalIntegration/CleanCash/CommerceRuntime/DocumentProvider.CleanCashSample/Configuration/DocumentProviderFiscalCleanCashSample.xml))
    1. ดาวน์โหลดไฟล์การตั้งค่าคอนฟิกตัวเชื่อมต่อทางการเงินที่ **HardwareStation \> Connector.CleanCashSample \> Configuration \> ConnectorCleanCashSample.xml** (ตัวอย่างเช่น [ไฟล์สำหรับรุ่น/9.33](https://github.com/microsoft/Dynamics365Commerce.Solutions/blob/release/9.33/src/FiscalIntegration/CleanCash/HardwareStation/Connector.CleanCashSample/Configuration/ConnectorCleanCashSample.xml))

    > [!WARNING]
    > เนื่องจากข้อจํากัดของ [แบบจำลองบรรจุภัณฑ์และส่วนขยายอิสระใหม่](../dev-itpro/build-pipeline.md) จึงไม่สามารถใช้กับตัวอย่างการรวมทางการเงินนี้ได้ในขณะนี้ คุณต้องใช้ Retail SDK บน VM สำหรับนักพัฒนาใน LCS ไฟล์การตั้งค่าคอนฟิกของตัวอย่างการรวมทางการเงินนี้อยู่ในโฟลเดอร์ต่อไปนี้ของ Retail SDK บน VM สำหรับนักพัฒนาใน LCS:
    >
    > - **ไฟล์การตั้งค่าคอนฟิกผู้ให้บริการเอกสารทางการเงิน:** RetailSdk\\SampleExtensions\\CommerceRuntime\\Extensions.DocumentProvider.CleanCashSample\\Configuration\\DocumentProviderFiscalCleanCashSample.xml
    > - **ไฟล์การตั้งค่าคอนฟิกตัวเชื่อมต่อทางการเงิน:** RetailSdk\\SampleExtensions\\HardwareStation\\Extension.CleanCashSample\\Configuration\\ConnectorCleanCashSample.xml
    > 
    > มีการวางแผนการสนับสนุนรูปแบบบรรจุภัณฑ์และส่วนขยายอิสระใหม่จากตัวอย่างการรวมทางการเงินกับรุ่นที่ใหม่กว่า

1. ไปที่ **Retail และ Commerce \> การตั้งค่าศูนย์ควบคุม \> พารามิเตอร์ \> พารามิเตอร์ที่ใช้ร่วมกันของ Commerce** บนแท็บ **ทั่วไป** ให้ตั้งค่าตัวเลือก **เปิดใช้งานการรวมทางการเงิน** เป็น **ใช่**
1. ไปที่ **การขายปลีกและการค้า \> การตั้งค่าช่องทาง \> การรวมทางการเงิน \> ผู้ให้บริการเอกสารทางการเงิน** และโหลดไฟล์การตั้งค่าคอนฟิกผู้ให้บริการเอกสารทางการเงินที่คุณดาวน์โหลดก่อนหน้านี้
1. ไปที่ **การขายปลีกและการค้า \> การตั้งค่าช่องทาง \> การรวมทางการเงิน \> ตัวเชื่อมต่อทางการเงิน** และโหลดไฟล์การตั้งค่าคอนฟิกตัวเชื่อมต่อทางการเงินที่คุณดาวน์โหลดก่อนหน้านี้
1. ไปที่ **การขายปลีกและการพาณิชย์ \> การตั้งค่าช่องทางการขาย \> การรวมทางการเงิน \> โปรไฟล์ฟังก์ชันของตัวเชื่อมต่อ** สร้างโปรไฟล์ฟังก์ชันของตัวเชื่อมต่อใหม่ เลือกผู้ให้บริการเอกสารและตัวเชื่อมต่อที่คุณโหลดไว้ก่อนหน้านี้ อัปเดต [การตั้งค่าการแมปข้อมูล](#default-data-mapping) ตามที่ต้องการ
1. ไปที่ **การขายปลีกและการพาณิชย์ \> การตั้งค่าช่องทางการขาย \> การรวมทางการเงิน \> โปรไฟล์ทางเทคนิคของตัวเชื่อมต่อ** สร้างโปรไฟล์ทางเทคนิคของตัวเชื่อมต่อใหม่ และเลือกตัวเชื่อมต่อทางการเงินที่คุณโหลดไว้ก่อนหน้านี้ อัปเดต [การตั้งค่าตัวเชื่อมต่อ](#fiscal-connector-settings) ตามที่ต้องการ
6. ไปที่ **การขายปลีกและการพาณิชย์ \> การตั้งค่าช่องทางการขาย \> การรวมทางการเงิน \> กลุ่มตัวเชื่อมต่อทางการเงิน** สร้างกลุ่มตัวเชื่อมต่อทางการเงินใหม่สำหรับโปรไฟล์ฟังก์ชันของตัวเชื่อมต่อที่คุณสร้างไว้ก่อนหน้านี้
7. ไปที่ **การขายปลีกและการพาณิชย์ \> การตั้งค่าช่องทางการขาย \> การรวมทางการเงิน \> กระบวนการลงทะเบียนทางการเงิน** สร้างกระบวนการลงทะเบียนทางการเงินใหม่และขั้นตอนกระบวนการลงทะเบียนทางการเงิน และเลือกกลุ่มตัวเชื่อมต่อทางการเงินที่คุณสร้างก่อนหน้านี้
8. ไปที่ **การขายปลีกและการค้า \> การตั้งค่าช่องทาง \> การตั้งค่า POS \> โพรไฟล์POS \> โพรไฟล์ฟังก์ชัน** เลือกโปรไฟล์ฟังก์ชันที่เชื่อมโยงกับร้านค้าที่ควรมีการเรียกใช้งานกระบวนการลงทะเบียน บน FastTab **กระบวนการลงทะเบียนทางการเงิน** ให้เลือกกระบวนการลงทะเบียนทางการเงินที่คุณสร้างไว้ก่อนหน้านี้
9. ไปที่ **การขายปลีกและการค้า \> การตั้งค่าช่องทาง \> การตั้งค่า POS \> โพรไฟล์POS \> โปรไฟล์ฮาร์ดแวร์** เลือกโปรไฟล์ฮาร์ดแวร์ที่เชื่อมโยงกับสถานีฮาร์ดแวร์ที่เครื่องพิมพ์ทางการเงินจะเชื่อมต่อด้วย บน FastTab **อุปกรณ์ต่อพ่วงทางการเงิน** ให้เลือกโปรไฟล์ทางเทคนิคของตัวเชื่อมต่อที่คุณสร้างก่อนหน้านี้
10. เปิดกำหนดการจัดจำหน่าย (**การขายปลีกและการค้า \> การขายปลีกและการค้าไอที \> กำหนดการจัดจำหน่าย**) และเลือกงาน **1070** และ **1090** เพื่อโอนย้ายข้อมูลไปยังฐานข้อมูลช่องทาง

#### <a name="default-data-mapping"></a>การแมปข้อมูลเริ่มต้น

การแมปข้อมูลเริ่มต้นต่อไปนี้รวมอยู่ในการตั้งค่าคอนฟิกผู้ให้บริการเอกสารทางการเงินที่ให้ไว้โดยเป็นส่วนหนึ่งของตัวอย่างการรวมทางการเงิน:

- **การแมปรหัสภาษีมูลค่าเพิ่ม (VAT)** – การแมปนี้จะตั้งค่ารหัสภาษีมูลค่าเพิ่มเฉพาะอุปกรณ์ (VAT) กับรหัสภาษีขายที่เกี่ยวข้อง การแมปรหัส VAT ควรมีรูปแบบต่อไปนี้:

    ```
    1 : code1 ; 2 : code2
    ```

    ต่อไปนี้เป็นคำอธิบายของรูปแบบนี้:

    - *1* และ *2* เป็นรหัส VAT เฉพาะอุปกรณ์
    - อัฒภาค (;) ใช้เป็นตัวแบ่ง
    - *code1* และ *code2* คือรหัสภาษีขายที่ตั้งค่าคอนฟิกในศูนย์ควบคุม Commerce คุณต้องปรับเปลี่ยนการแมปตัวอย่างตามรหัสภาษีที่ตั้งค่าคอนฟิกในแอปพลิเคชันของคุณ

    อุปกรณ์ควบคุมสนับสนุนรหัส VAT ที่แตกต่างกันไม่เกินสี่รหัส ดังนั้น การแมปรหัส VAT อาจถูกตั้งค่าในลักษณะต่อไปนี้:

    ```
    1 : code1 ; 2 : code2 ; 3 : code3 ; 4 : code4
    ```

    > [!NOTE]
    > รหัสภาษีขายหลายรหัสสามารถแมปกับรหัส VAT เฉพาะอุปกรณ์เดียวกัน

#### <a name="fiscal-connector-settings"></a>การตั้งค่าตัวเชื่อมต่อทางการเงิน

การตั้งค่าต่อไปนี้รวมอยู่ในการตั้งค่าคอนฟิกตัวเชื่อมต่อทางการเงินที่ให้ไว้โดยเป็นส่วนหนึ่งของตัวอย่างการรวมทางการเงิน:

- **สตริงการเชื่อมต่อ** – การตั้งค่าการเชื่อมต่ออุปกรณ์ควบคุม
- **การหมดเวลา** – จํานวนเวลาเป็นมิลลิวินาที ซึ่งพนักงานขับรถจะรอการตอบสนองจากอุปกรณ์ควบคุม

### <a name="configure-channel-components"></a>ตั้งค่าคอนฟิกส่วนประกอบช่องทาง

> [!WARNING]
> เนื่องจากข้อจํากัดของ [แบบจำลองบรรจุภัณฑ์และส่วนขยายอิสระใหม่](../dev-itpro/build-pipeline.md) จึงไม่สามารถใช้กับตัวอย่างการรวมทางการเงินนี้ได้ในขณะนี้ คุณต้องใช้ Retail SDK บน VM สำหรับนักพัฒนาใน LCS หากต้องการข้อมูลเพิ่มเติม โปรดดูที่ [แนวทางการปรับใช้งานตัวอย่างการรวมอุปกรณ์ควบคุมของสวีเดน (ดั้งเดิม)](emea-swe-fi-sample-sdk.md)
>
> มีการวางแผนการสนับสนุนรูปแบบบรรจุภัณฑ์และส่วนขยายอิสระใหม่จากตัวอย่างการรวมทางการเงินกับรุ่นที่ใหม่กว่า

#### <a name="set-up-the-development-environment"></a>ตั้งค่าสภาพแวดล้อมการพัฒนา

หากต้องการตั้งค่าสภาพแวดล้อมการพัฒนาเพื่อทดสอบและขยายตัวอย่าง ให้ปฏิบัติตามขั้นตอนต่อไปนี้

1. ลอกแบบหรือดาวน์โหลดที่เก็บ [โซลูชัน Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions) เลือกรุ่นสาขาที่นำออกใช้ที่ถูกต้องตามรุ่น SDK/แอปพลิเคชันของคุณ สำหรับข้อมูลเพิ่มเติม โปรดดูที่ [ดาวน์โหลดตัวอย่าง Retail SDK และแพคเกจอ้างอิงจาก GitHub และ NuGet](../dev-itpro/retail-sdk/sdk-github.md)
1. เปิดโซลูชันการรวมอุปกรณ์ควบคุมที่ **Dynamics365Commerce.Solutions\\FiscalIntegration\\CleanCash\\CleanCash.sln** และสร้าง
1. ติดตั้งส่วนขยาย CRT:

    1. ค้นหาตัวติดตั้งส่วนขยาย CRT:

        - **Commerce Scale Unit:** ในโฟลเดอร์ **CleanCash\\ScaleUnit\\ScaleUnit.CleanCash.Installer\\bin\\Debug\\net461** ให้ค้นหาตัวติดตั้ง **ScaleUnit.CleanCash.Installer**
        - **CRT เฉพาะที่บน Modern POS:** ในโฟลเดอร์ **CleanCash\\ModernPOS\\ModernPOS.CleanCash.Installer\\bin\\Debug\\net461** ให้ค้นหาตัวติดตั้ง **ModernPOS.CleanCash.Installer**

    2. เริ่มต้นตัวติดตั้งส่วนขยาย CRT จากบรรทัดใบสั่ง:

        - **Commerce Scale Unit:**

            ```Console
            ScaleUnit.CleanCash.Installer.exe install --verbosity 0
            ```

        - **CRT เฉพาะที่บน Modern POS:**

            ```Console
            ModernPOS.CleanCash.Installer.exe install --verbosity 0
            ```

1. ติดตั้งส่วนขยายสถานีฮาร์ดแวร์:

    1. ในโฟลเดอร์ **CleanCash\\HardwareStation\\HardwareStation.CleanCash.Installer\\bin\\Debug\\net461** ให้ค้นหาตัวติดตั้ง **HardwareStation.CleanCash.Installer**
    1. เริ่มต้นตัวติดตั้งส่วนขยายจากบรรทัดใบสั่ง:

        ```Console
        HardwareStation.CleanCash.Installer.exe install --verbosity 0
        ```

#### <a name="production-environment"></a>สภาพแวดล้อมการทำงานจริง

ปฏิบัติตามขั้นตอนต่างๆ ใน [การตั้งค่าไปป์ไลน์การสร้างตัวอย่างการรวมทางการเงิน](fiscal-integration-sample-build-pipeline.md) เพื่อสร้างและปล่อย Cloud Scale Unit และแพคเกจที่ปรับใช้ได้แบบบริการตนเองในตัวอย่างการรวมทางการเงิน ไฟล์ YAML เทมเพลต **CleanCash build-pipeline.yml** สามารถพบได้ในโฟลเดอร์ **Pipeline\\YAML_Files** ของที่เก็บ [โซลูชัน Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions)

## <a name="design-of-the-extensions"></a>การออกแบบของส่วนขยาย

ตัวอย่างการรวมอุปกรณ์ควบคุมของสวีเดนยึดตาม [ฟังก์ชันการรวมทางการเงิน](fiscal-integration-for-retail-channel.md) และเป็นส่วนหนึ่งของ Retail SDK ตัวอย่างอยู่ในโฟลเดอร์ **src\\FiscalIntegration\\CleanCash** ของที่เก็บ [โซลูชัน Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/) (ตัวอย่างเช่น [ตัวอย่างในรุ่น/9.33](https://github.com/microsoft/Dynamics365Commerce.Solutions/tree/release/9.33/src/FiscalIntegration/CleanCash)) ตัวอย่าง [ประกอบด้วย](fiscal-integration-for-retail-channel.md#fiscal-registration-process-and-fiscal-integration-samples-for-fiscal-devices-and-services) ของตัวให้บริการเอกสารทางการเงิน ซึ่งเป็นส่วนขยายของ CRT และตัวเชื่อมต่อทางการเงิน ซึ่งเป็นส่วนขยายของ Commerce Hardware Station หากต้องการทราบข้อมูลเพิ่มเติมเกี่ยวกับวิธีการใช้ Retail SDK โปรดดู [สถาปัตยกรรม Retail SDK](../dev-itpro/retail-sdk/retail-sdk-overview.md) และ [ตั้งค่าไปป์ไลน์การสร้างของ SDK บรรจุภัณฑ์อิสระ](../dev-itpro/build-pipeline.md)

> [!WARNING]
> เนื่องจากข้อจํากัดของ [แบบจำลองบรรจุภัณฑ์และส่วนขยายอิสระใหม่](../dev-itpro/build-pipeline.md) จึงไม่สามารถใช้กับตัวอย่างการรวมทางการเงินนี้ได้ในขณะนี้ คุณต้องใช้ Retail SDK บน VM สำหรับนักพัฒนาใน LCS หากต้องการข้อมูลเพิ่มเติม โปรดดูที่ [แนวทางการปรับใช้งานตัวอย่างการรวมอุปกรณ์ควบคุมของสวีเดน (ดั้งเดิม)](emea-swe-fi-sample-sdk.md) มีการวางแผนการสนับสนุนรูปแบบบรรจุภัณฑ์และส่วนขยายอิสระใหม่จากตัวอย่างการรวมทางการเงินกับรุ่นที่ใหม่กว่า

### <a name="crt-extension-design"></a>การออกแบบของส่วนขยาย CRT

วัตถุประสงค์ของส่วนขยายที่เป็นผู้ให้บริการเอกสารทางการเงินคือการสร้างเอกสารเฉพาะบริการ และจัดการการตอบสนองจากอุปกรณ์ควบคุม

#### <a name="request-handler"></a>ตัวจัดการคำขอ

มีตัวจัดการคำขอ **DocumentProviderCleanCash** หนึ่งตัวจัดการสำหรับตัวจัดการเอกสาร ตัวจัดการนี้ใช้ในการสร้างเอกสารทางการเงินเกี่ยวกับอุปกรณ์ควบคุม

ตัวจัดการสืบทอดมาจากอินเทอร์เฟส **INamedRequestHandler** วิธีการ **HandlerName** จะรับผิดชอบการส่งคืนชื่อของตัวจัดการ ชื่อตัวจัดการควรตรงกับชื่อผู้ให้บริการเอกสารตัวเชื่อมต่อที่ระบุในศูนย์ควบคุม Commerce

ตัวเชื่อมต่อสนับสนุนคำขอต่อไปนี้:

- **GetFiscalDocumentDocumentProviderRequest** – คำขอนี้จะมีข้อมูลเกี่ยวกับเอกสารใดที่ควรถูกสร้างขึ้น โดยจะส่งคืนเอกสารเฉพาะบริการที่ควรลงทะเบียนในอุปกรณ์ควบคุม
- **GetSupportedRegistrableEventsDocumentProviderRequest** – คำขอนี้จะส่งคืนรายการเหตุการณ์ที่จะสมัครเป็นสมาชิก ปัจจุบัน สนับสนุนเหตุการณ์การขายและเหตุการณ์การตรวจสอบ

#### <a name="configuration"></a>การกำหนดค่า

ไฟล์การตั้งค่าคอนฟิกสำหรับผู้ให้บริการเอกสารทางการเงินอยู่ที่ **src\\FiscalIntegration\\CleanCash\\CommerceRuntime\\DocumentProvider.CleanCashSample\\Configuration\\DocumentProviderFiscalCleanCashSample.xml** ในที่เก็บ [โซลูชัน Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/) วัตถุประสงค์ของไฟล์นี้คือเพื่อเปิดใช้งานการตั้งค่าของผู้ให้บริการเอกสารที่จะตั้งค่าคอนฟิกจากศูนย์ควบคุม Commerce รูปแบบไฟล์จะสอดคล้องกับข้อกําหนดของการตั้งค่าคอนฟิกการรวมทางการเงิน

### <a name="hardware-station-extension-design"></a>การออกแบบส่วนขยายสถานีฮาร์ดแวร์

วัตถุประสงค์ของส่วนขยายที่เป็นตัวเชื่อมต่อทางการเงินคือเพื่อสื่อสารกับอุปกรณ์ควบคุม ส่วนขยายนี้ใช้โปรโทคอล HTTP เพื่อส่งเอกสารที่ส่วนขยาย CRT สร้างขึ้นไปยังอุปกรณ์ควบคุม และยังจัดการการตอบสนองที่ได้รับจากอุปกรณ์ควบคุมด้วย

#### <a name="request-handler"></a>ตัวจัดการคำขอ

ตัวจัดการคำขอ **CleanCashHandler** เป็นจุดเข้าใช้งานเพื่อจัดการคำขอไปยังอุปกรณ์ควบคุม

ตัวจัดการสืบทอดมาจากอินเทอร์เฟส **INamedRequestHandler** วิธีการ **HandlerName** จะรับผิดชอบการส่งคืนชื่อของตัวจัดการ ชื่อตัวจัดการควรตรงกับชื่อตัวเชื่อมต่อทางการเงินที่ระบุในศูนย์ควบคุม Commerce

ตัวเชื่อมต่อสนับสนุนคำขอต่อไปนี้:

- **SubmitDocumentFiscalDeviceRequest** – คำขอนี้จะส่งเอกสารไปยังอุปกรณ์ควบคุมและส่งคืนการตอบสนองจากอุปกรณ์ควบคุม
- **IsReadyFiscalDeviceRequest** – คำขอนี้ใช้เพื่อตรวจสอบความสมบูรณ์ของอุปกรณ์ควบคุม
- **InitializeFiscalDeviceRequest** – คำขอนี้ใช้สำหรับการเริ่มต้นอุปกรณ์ควบคุม

#### <a name="configuration"></a>การกำหนดค่า

ไฟล์การตั้งค่าคอนฟิกสำหรับตัวเชื่อมต่ออยู่ที่ **src\\FiscalIntegration\\CleanCash\\HardwareStation\\Connector.CleanCashSample\\Configuration\\ConnectorCleanCashSample.xml** ในที่เก็บ [โซลูชัน Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/) วัตถุประสงค์ของไฟล์คือเพื่อเปิดใช้งานการตั้งค่าของตัวเชื่อมต่อทางการเงินที่จะตั้งค่าคอนฟิกจากศูนย์ควบคุม Commerce รูปแบบไฟล์จะสอดคล้องกับข้อกําหนดของการตั้งค่าคอนฟิกการรวมทางการเงิน

[!INCLUDE[footer-include](../../includes/footer-banner.md)]
