---
title: ตั้งค่าคอนฟิก CPOS เพื่อใช้แอป Azure AD ที่กําหนดเอง
description: หัวข้อนี้อธิบายวิธีการตั้งค่าคอนฟิก Cloud POS (CPOS) เพื่อใช้แอป Azure Active Directory ที่กําหนดเอง (Azure AD)
author: boycez
ms.date: 08/02/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: josaw
ms.search.region: global
ms.author: boycez
ms.search.validFrom: ''
ms.dyn365.ops.version: 10.0.21
ms.openlocfilehash: baa0c3da25308345037b5dd1b4c5907d6213e7f7
ms.sourcegitcommit: bd3b55e1af28e592c97b540de1e87cd8ba9c35a8
ms.translationtype: HT
ms.contentlocale: th-TH
ms.lasthandoff: 08/03/2022
ms.locfileid: "9222977"
---
# <a name="configure-cpos-to-use-a-custom-azure-ad-app"></a>ตั้งค่าคอนฟิก CPOS เพื่อใช้แอป Azure AD ที่กําหนดเอง

[!include [banner](includes/banner.md)]

ตามค่าเริ่มต้น Cloud POS (CPOS) ใน Microsoft Dynamics 365 Commerce จะชี้ไปยังแอป Microsoft ฝ่ายแรกที่ลงทะเบียนใน Azure Active Directory (Azure AD) ดังนั้น คุณจึงสามารถใช้ CPOS ได้โดยไม่ต้องเปลี่ยนแปลงใดๆ ใน Azure AD อย่างไรก็ตาม คุณอาจต้องการชี้อินสแตนซ์ของคุณของ CPOS ไปยังแอป Azure AD ที่กำหนดเองที่คุณควบคุม หัวข้อนี้อธิบายวิธีการตั้งค่าคอนฟิก CPOS เพื่อใช้แอป Azure AD ที่กําหนดเอง

## <a name="set-up-a-custom-retail-server-app-in-azure-ad"></a>ตั้งค่าแอป Retail Server ที่กำหนดเองใน Azure AD

หากต้องการสร้างและตั้งค่าคอนฟิกแอป Retail Server ที่กําหนดเอง ใน Azure AD ให้ปฏิบัติตามขั้นตอนต่อไปนี้

1. ลงชื่อเข้าใช้ [ศูนย์การจัดการ Azure Active Directory](https://aad.portal.azure.com) โดยใช้บัญชีผู้ใช้ Azure AD บัญชีผู้ใช้ไม่ต้องมีสิทธิ์ระดับผู้ดูแลระบบ
1. เลือก **Azure Active Directory**
1. เลือก **การลงทะเบียนแอป** แล้วเลือก **การลงทะเบียนใหม่** เพื่อเปิดกล่องโต้ตอบ **ลงทะเบียนโปรแกรมประยุกต์**
1. ตั้งค่าฟิลด์เหล่านี้:

    - **ชื่อ** – ป้อนชื่อที่กำหนดเองสำหรับแอป ตัวอย่างเช่น ป้อน **Retail Server ที่กำหนดเอง**
    - **ชนิดบัญชีการสนับสนุน** – เลือกตัวเลือกเริ่มต้น **บัญชีในไดเรกทอรีองค์กรนี้เท่านั้น (Microsoft เท่านั้น - ผู้เช่าคนเดียว)**
    - **เปลี่ยนเส้นทาง URI** – ฟิลด์นี้ไม่จำเป็นต้องระบุ ปล่อยว่างไว้
    - **รหัสแผนภูมิบริการ** – ฟิลด์นี้ไม่จำเป็นต้องระบุ ปล่อยว่างไว้
    
1. เลือก **การลงทะเบียน** หน้าการตั้งค่าคอนฟิกของแอปที่ลงทะเบียนใหม่จะปรากฏขึ้น
1. ในส่วน **ภาพรวม\> สิ่งจำเป็น** ให้เลือก **เพิ่ม URI รหัสโปแกรมประยุกต์** แล้วเลือก **ตั้งค่า** ถัดจาก **URI รหัสโปแกรมประยุกต์** สร้างหมายเหตุค่าที่แนะนาแล้วเลือก **บันทึก** เพื่อยอมรับค่านั้น 
1. เลือก **เพิ่มขอบเขต** และจากนั้นตั้งค่าฟิลด์ต่อไปนี้:

    - **ชื่อขอบเขต** – ป้อนชื่อที่กำหนดเองสำหรับขอบเขต ตัวอย่างเช่น ป้อน **Legacy.Access.full**
    - **ผู้ที่สามารถยินยอม** – ระบุว่าทั้งผู้ดูแลระบบและผู้ใช้หรือผู้ดูแลระบบเท่านั้นที่สามารถให้การยินยอมตามนโยบายความปลอดภัยขององค์กรของคุณ
    - **ชื่อที่แสดงการยินยอมของผู้ดูแลระบบ** – ป้อนชื่อที่แสดง ตัวอย่างเช่น ป้อน **เข้าถึง Retail Server**
    - **คำอธิบายการยินยอมของผู้ดูแลระบบ** – ให้ป้อนคำอธิบาย ตัวอย่างเช่น ป้อน **ให้การเข้าถึง API ของ Retail Server**

1. เลือก **เพิ่มขอบเขต** เพื่อทำกระบวนการสร้างขอบเขตให้เสร็จสมบูรณ์

## <a name="set-up-a-custom-cpos-app-in-azure-ad"></a>ตั้งค่าแอป CPOS ที่กำหนดเองใน Azure AD

หากต้องการสร้างและตั้งค่าคอนฟิกแอป CPOS ที่กําหนดเองใน Azure AD ให้ปฏิบัติตามขั้นตอนต่อไปนี้

1. ลงชื่อเข้าใช้ [ศูนย์การจัดการ Azure Active Directory](https://aad.portal.azure.com) โดยใช้บัญชีผู้ใช้ Azure AD บัญชีผู้ใช้ไม่ต้องมีสิทธิ์ระดับผู้ดูแลระบบ
1. เลือก **Azure Active Directory**
1. เลือก **การลงทะเบียนแอป** แล้วเลือก **การลงทะเบียนใหม่** เพื่อเปิดกล่องโต้ตอบ **ลงทะเบียนโปรแกรมประยุกต์**
1. ตั้งค่าฟิลด์เหล่านี้:

    - **ชื่อ** – ป้อนชื่อสำหรับแอป ตัวอย่างเช่น ป้อน **Cloud POS ที่กำหนดเอง**
    - **ชนิดบัญชีการสนับสนุน** – เลือกตัวเลือกเริ่มต้น **บัญชีในไดเรกทอรีองค์กรนี้เท่านั้น (Microsoft เท่านั้น - ผู้เช่าคนเดียว)**
    - **เปลี่ยนเส้นทาง URI** – เลือก **โปรแกรมประยุกต์หน้าเดียว (SPA)** ในรายการแบบหล่นลง แล้วป้อน CPOS URI ของคุณ
    - **รหัสแผนภูมิบริการ** – ฟิลด์นี้ไม่จำเป็นต้องระบุ ปล่อยว่างไว้

1. เลือก **การลงทะเบียน** หน้าการตั้งค่าคอนฟิกของแอปที่ลงทะเบียนใหม่จะปรากฏขึ้น
1. ในส่วน **Manifest** ให้ตั้งค่าพารามิเตอร์ **oauth2AllowIdTokenImplicitFlow** และ **oauth2AllowImplicitFlow** เป็น **จริง** แล้วเลือก **บันทึก**
1. ในส่วน **การตั้งค่าคอนฟิกโทเคน** ให้ปฏิบัติตามขั้นตอนต่อไปนี้เพื่อเพิ่มการอ้างสิทธิ์สองรายการ:

    - เลือก **เพิ่มการเรียกร้องที่เป็นตัวเลือก** ตั้งค่าฟิลด์ **ชนิดโทเคน** เป็น **รหัส** แล้วเลือกการเรียกร้อง **sid** เลือก **เพิ่ม**
    - เลือก **เพิ่มการเรียกร้องที่เป็นตัวเลือก** ตั้งค่าฟิลด์ **ชนิดโทเคน** เป็น **การเข้าถึง** แล้วเลือกการเรียกร้อง **sid** เลือก **เพิ่ม**

1. ในส่วน **สิทธิ์ของ API** ให้เลือก **เพิ่มสิทธิ์**
1. บนแท็บ **API ขององค์กรของฉันใช้** ให้ค้นหาแอป Retail Server ที่คุณสร้างไว้ในส่วน [ตั้งค่าแอป Retail Server ที่กำหนดเองใน Azure AD](#set-up-a-custom-retail-server-app-in-azure-ad) จากนั้นเลือก **เพิ่มสิทธิ์**
1. ในส่วน **ภาพรวม** ให้บันทึกค่าในฟิลด์ **รหัสโปรแกรมประยุกต์ (ไคลเอ็นต์)**

## <a name="update-the-cpos-configuration-file"></a>อัปเดตไฟล์การตั้งค่าคอนฟิก CPOS

เปิดไฟล์ CPOS config.json และอัปเดตต่อไปนี้ในไฟล์

1. แทนที่ค่าคีย์ **AADClientId** ด้วยค่า **รหัสโปรแกรมประยุก (ไคลเอ็นต์)** ของแอป CPOS ที่กำหนดเองที่คุณสร้างขึ้นในส่วน [ตั้งค่าแอป CPOS ที่กำหนดเองใน Azure AD](#set-up-a-custom-cpos-app-in-azure-ad)
1. แทนที่ค่าคีย์ **AADRetailServerResourceId** ด้วยค่า **URI ของรหัสโปรแกรมประยุก** ของแอป Retail Server ที่กำหนดเองที่คุณสร้างขึ้นในส่วน [ตั้งค่าแอป Retail Server ที่กำหนดเองใน Azure AD](#set-up-a-custom-retail-server-app-in-azure-ad)

CPOS จะใช้พารามิเตอร์ทั้งสองเมื่อส่งการร้องขอให้ Azure AD ได้รับโทเคนความปลอดภัย

## <a name="update-identity-providers-settings-in-commerce-headquarters"></a>อัปเดตการตั้งค่าตัวให้บริการข้อมูลเฉพาะตัวใน Commerce headquarters

ถัดไป คุณต้องอัปเดตการตั้งค่าตัวให้บริการข้อมูลเฉพาะตัวใน Commerce headquarters

1. ใน Commerce headquarters เปิดหน้า **พารามิเตอร์ที่ใช้ร่วมกันของ Commerce**
1. บนแท็บ **ตัวให้บริการข้อมูลเฉพาะตัว** ในส่วน **ตัวให้บริการข้อมูลเฉพาะตัว** ให้เลือกแถวที่มีฟิลด์ **ชนิด** ตั้งค่าเป็น **Azure Active Directory** และฟิลด์ **ผู้ออก** ชี้ไปยังผู้เช่าของคุณ Azure AD การตั้งค่านี้จะประกาศที่คุณจะใช้งานกริดรองที่มีข้อมูลที่เกี่ยวข้องกับตัวให้บริการข้อมูลเฉพาะตัวที่ตรงกับผู้เช่า Azure AD ของคุณ
1. ในส่วน **ฝ่ายที่พึ่งพา** ให้เลือก **เพิ่ม** เพื่อเพิ่มแถว
1. ตั้งค่าฟิลด์เหล่านี้:

    - **ClientId** – ป้อนค่า **รหัสโปรแกรมประยุก (ไคลเอ็นต์)** ของแอป CPOS ที่กำหนดเองที่คุณสร้างขึ้นในส่วน [ตั้งค่าแอป CPOS ที่กำหนดเองใน Azure AD](#set-up-a-custom-cpos-app-in-azure-ad)
    - **ชนิด** – เลือก **สาธารณะ**
    - **UserType** – เลือก **ผู้ปฏิบัติงาน**

1. เลือกแถวคุณเพิ่มเข้ามา ส่วน **รหัสทรัพยากรเซิร์ฟเวอร์** ที่อยู่ใต้ส่วน **ฝ่ายที่พึ่งพา** จะแสดงรหัสแอป Retail Server ที่สามารถเข้าถึงได้โดยแอปที่คุณเลือกในกริด **ฝ่ายที่พึ่งพา**
1. ในส่วน **รหัสทรัพยากรเซิร์ฟเวอร์** ให้เลือก **เพิ่ม** เพื่อเพิ่มแถว
1. ในฟิลด์ **รหัสทรัพยากรเซิร์ฟเวอร์** ป้อนค่า **URI ของรหัสโปรแกรมประยุก** ของแอป Retail Server ที่กำหนดเองที่คุณสร้างขึ้นในส่วน [ตั้งค่าแอป Retail Server ที่กำหนดเองใน Azure AD](#set-up-a-custom-retail-server-app-in-azure-ad)

    > [!IMPORTANT]
    > ฟิลด์ทั้งหมดที่กล่าวถึงในขั้นตอนก่อนหน้านี้จะตรงตามตัวพิมพ์ ค่าที่คุณป้อนต้องตรงกับค่าที่ตั้งค่าคอนฟิกในศูนย์การจัดการ Azure AD

1. ไปที่ **การขายปลีกและการค้า \> กำหนดการกระจาย** และเรียกใช้งาน **1110** (**การตั้งค่าคอนฟิกแบบครอบคลุม**)

ตอนนี้คุณสามารถเปิดใช้งานอุปกรณ์ CPOS ได้โดยใช้แอป Azure AD ของคุณเอง

## <a name="additional-resources"></a>ทรัพยากรเพิ่มเติม

[การเปิดใช้งานอุปกรณ์ที่จุดขาย (POS)](dev-itpro/retail-device-activation.md)

[จัดการบัญชีการเรียกใช้และตรวจสอบความถูกต้องของอุปกรณ์](set-up-activation-accounts-validate-devices-hq.md)

[!INCLUDE[footer-include](../includes/footer-banner.md)]
