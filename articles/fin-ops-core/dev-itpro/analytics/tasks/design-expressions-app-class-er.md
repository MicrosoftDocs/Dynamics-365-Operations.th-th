---
title: ออกแบบนิพจน์ ER เพื่อเรียกใช้วิธีการของคลาสแอพลิเคชัน
description: บทความนี้อธิบายวิธีการใช้ซ้ำตรรกะแอปพลิเคชันที่มีอยู่ในการตั้งค่าคอนฟิกการรายงานอิเล็กทรอนิกส์ โดยการเรียกใช้วิธีที่ต้องการของคลาสแอปพลิเคชัน
author: NickSelin
ms.date: 11/02/2021
ms.topic: business-process
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: kfend
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2016-06-30
ms.dyn365.ops.version: Version 7.0.0
ms.openlocfilehash: 0fb0a9725d882fdc330d7adbb49bd3dcadf7805f
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: th-TH
ms.lasthandoff: 06/03/2022
ms.locfileid: "8883638"
---
# <a name="design-er-expressions-to-call-application-class-methods"></a>ออกแบบนิพจน์ ER เพื่อเรียกใช้วิธีการของคลาสแอพลิเคชัน

[!include [banner](../../includes/banner.md)]

บทความนี้จะแสดงข้อมูลเกี่ยวกับวิธีการใช้ตรรกะของแอพลิเคชันที่มีอยู่ซ้ำในการตั้งค่าคอนฟิก [การรายงานอิเล็กทรอนิกส์ (ER)](../general-electronic-reporting.md) โดยการเรียกใช้วิธีที่จำเป็นของคลาสแอพลิเคชันในนิพจน์ ER สามารถกําหนดค่าของอาร์กิวเมนต์ของคลาสการเรียกแบบไดนามิกขณะที่รันไทม์ได้ ตัวอย่างเช่น ค่าอาจขึ้นอยู่กับข้อมูลในเอกสารการแยกวิเคราะห์ เพื่อให้แน่ใจว่าค่านั้นถูกต้อง

ตัวอย่างในบทความนี้เช่น คุณกำลังออกแบบกระบวนการแยกวิเคราะห์ใบแจ้งยอดจากธนาคารขาเข้าสำหรับการปรับปรุงข้อมูลแอพลิเคชัน คุณจะได้รับใบแจ้งยอดจากธนาคารขาเข้าเป็นไฟล์ข้อความ (.txt) ที่มีรหัสหมายเลขบัญชีธนาคารระหว่างประเทศ (IBAN) ในฐานะที่เป็นส่วนหนึ่งของกระบวนการนำเข้าใบแจ้งยอดจากธนาคาร คุณต้องตรวจสอบความถูกต้องของรหัส IBAN นี้โดยใช้ตรรกะที่มีอยู่แล้ว

## <a name="prerequisites"></a>ข้อกำหนดเบื้องต้น

กระบวนในบทความนี้มีไว้สำหรับผู้ใช้ที่ได้รับมอบหมายให้มีบทบาท **ผู้ดูแลระบบ** หรือ **นักพัฒนาการรายงานทางอิเล็กทรอนิกส์**

ขั้นตอนดังกล่าวสามารถเสร็จสมบูรณ์ได้โดยใช้ชุดข้อมูลใดๆ

เพื่อให้ดำเนินการเสร็จสมบูรณ์ คุณต้องดาวน์โหลดและบันทึกไฟล์นี้ [SampleIncomingMessage.txt](https://download.microsoft.com/download/8/0/a/80adbc89-f23c-46d9-9241-e0f19125c04b/SampleIncomingMessage.txt)

ในบทความนี้ คุณจะสร้างการตั้งค่าคอนฟิก ER ที่จำเป็นสำหรับบริษัทตัวอย่าง Litware, Inc. ดังนั้น ก่อนที่คุณจะดำเนินกระบวนการทำงานในบทความนี้ให้เสร็จสมบูรณ์ คุณต้องดำเนินการตามขั้นตอนดังต่อไปนี้

1. ไปที่ **การจัดการองค์กร** \> **พื้นที่ทำงาน** \> **การรายงานทางอิเล็กทรอนิกส์**
2. ในหน้า **การตั้งค่าคอนฟิกการแปล** ให้ตรวจสอบว่ามีผู้ให้บริการการตั้งค่าคอนฟิกสำหรับบริษัทตัวอย่าง **Litware, Inc.** และได้รับการระบุว่า ดำเนินการอยู่ ถ้าคุณไม่เห็นผู้ให้บริการการตั้งค่าคอนฟิกนี้ ก่อนอื่นคุณต้องดำเนินขั้นตอนต่างๆ ใน [สร้างผู้ให้บริการการตั้งค่าคอนฟิก และทำระบุว่า ดำเนินงานอยู่](er-configuration-provider-mark-it-active-2016-11.md) ให้เสร็จสมบูรณ์

## <a name="import-a-new-er-model-configuration"></a>นำเข้าการตั้งค่าคอนฟิกแบบจำลองของ ER ใหม่

1. บนหน้า **การตั้งค่าคอนฟิกการแปล** ในส่วน **ผู้ให้บริการการตั้งค่าคอนฟิก** เลือกไทล์สำหรับผู้ให้บริการการตั้งค่าคอนฟิกของ **Microsoft**
2. เลือก **ที่เก็บ**
3. บนหน้า **ที่เก็บการแปล** ให้เลือก **แสดงตัวกรอง**
4. เมื่อต้องการเลือกเรกคอร์ดที่เก็บส่วนกลาง ให้เพิ่มฟิลด์ตัวกรอง **ชื่อ**
5. ในฟิลด์ **ชื่อ** ให้ป้อน **Global** จากนั้นเลือกตัวควบคุมตัวกรอง **จำกัดวง**
6. เลือก **นำไปใช้**
7. เลือก **[เปิด](../er-download-configurations-global-repo.md#open-configurations-repository)** เพื่อดูรายการของการตั้งค่าคอนฟิก ER ในที่เก็บที่เลือก
8. บนหน้า **ที่เก็บการกำหนดค่าคอนฟิก** ในแผนภูมิการตั้งค่าคอนฟิก ให้เลือก **แบบจำลองการชำระเงิน**
9. บน FastTab **รุ่น** ถ้ามีปุ่ม **นำเข้า** ให้เลือกปุ่มนั้น จากนั้น เลือก **ใช่**

    ถ้าไม่มีปุ่ม **นำเข้า** แสดงว่าคุณได้นำเข้ารุ่นของการกำหนดค่าคอนฟิก ER ของ **แบบจำลองการชำระเงิน** ที่ถูกเลือกแล้ว

10. ปิดหน้า **ที่เก็บการกำหนดค่าคอนฟิก** แล้วปิดหน้า **ที่เก็บการแปล**

## <a name="add-a-new-er-format-configuration"></a>เพิ่มการตั้งค่าคอนฟิกรูปแบบของ ER ใหม่

เพิ่มรูปแบบ ER ใหม่เพื่อแยกวิเคราะห์ใบแจ้งยอดจากธนาคารขาเข้าในรูปแบบ TXT

1. บนหน้า **การตั้งค่าคอนฟิกการแปล** ให้เลือกไทล์ **การตั้งค่าคอนฟิกการรายงาน**
2. บนหน้า **การตั้งค่าคอนฟิก** ในแผนภูมิการตั้งค่าคอนฟิกในบานหน้าต่างด้านซ้าย ให้เลือก **แบบจำลองการชำระเงิน**
3. เลือก **สร้างการตั้งค่าคอนฟิก** 
4. ในกล่องโต้ตอบรายการแบบหล่นลง ให้ทำตามขั้นตอนเหล่านี้:

    1. ในฟิลด์ **สร้าง** ป้อน **รูปแบบตามแบบจำลองข้อมูล PaymentModel**
    2. ในฟิลด์ **ชื่อ** ให้ใส่ข้อมูล **รูปแบบการนำเข้าใบแจ้งยอดจากธนาคาร (ตัวอย่าง)**
    3. ในฟิลด์ **รองรับการนำเข้าข้อมูล** ให้เลือก **ใช่**
    4. เลือก **สร้างการกำหนดค่าคอนฟิก** เพื่อสร้างการตั้งค่าคอนฟิกให้เสร็จสมบูรณ์

## <a name="design-the-er-format-configuration--format"></a>การออกแบบการตั้งค่าคอนฟิกรูปแบบ ER - Format

การออกแบบรูปแบบ ER ที่แสดงถึงโครงสร้างของไฟล์ภายนอกที่คาดไว้ในรูปแบบ TXT

1. รูปแบบการกำหนดค่าคอนฟิกของ **รูปแบบการนําเข้าใบแจ้งยอดจากธนาคาร (ตัวอย่าง)** ที่คุณได้เพิ่มเข้าไป ให้เลือก **ตัวออกแบบ**
2. บนหน้า **ตัวออกแบบรูปแบบ** ในรูปแบบโครงสร้างแผนภูมิในบานหน้าต่างด้านซ้าย ให้เลือก **Add root**
3. ในกล่องโต้ตอบที่ปรากฎขึ้น ให้ทำตามขั้นตอนเหล่านี้:

    1. ในแผนภูมิ ให้เลือก **ข้อความ\\ลำดับ** เพื่อเพิ่มส่วนประกอบของรูปแบบ **ลำดับ**
    2. ในฟิลด์ **ชื่อ** ให้ป้อน **Root**
    3. ในฟิลด์ **อักขระพิเศษ** ให้เลือก **รายการใหม่ - Windows (CR LF)** บนพื้นฐานของการตั้งค่านี้ แต่ละรายการในไฟล์แยกวิเคราะห์จะถูกพิจารณาให้เป็นเรกคอร์ดแยกต่างหาก
    4. เลือก **ตกลง**

4. เลือก **เพิ่ม**
5. ในกล่องโต้ตอบที่ปรากฎขึ้น ให้ทำตามขั้นตอนเหล่านี้:

    1. ในแผนภูมิ ให้เลือก **ข้อความ\\ลำดับ'**
    2. ในฟิลด์ **ชื่อ** ให้ป้อน **แถว**
    3. ในฟิลด์ **ความหลากหลาย** ให้เลือก **หนึ่งต่อหลายรายการ** บนพื้นฐานของการตั้งค่านี้ มีการคาดหวังว่ารายการอย่างน้อยหนึ่งรายการจะปรากฏในไฟล์แยกวิเคราะห์
    4. เลือก **ตกลง**

6. ในแผนภูมิ ให้เลือก **Root\\Rows** จากนั้นเลือก **Add Sequence**
7. ในกล่องโต้ตอบที่ปรากฎขึ้น ให้ทำตามขั้นตอนเหล่านี้:

    1. ในฟิลด์ **ชื่อ** ให้ป้อน **ฟิลด์**
    2. ในฟิลด์ **ความหลากหลาย** ให้เลือก **เพียงรายการเดียว**
    3. เลือก **ตกลง**

8. ในแผนภูมิ ให้เลือก **Root\\Rows\\Fields** จากนั้นเลือก **Add**
9. ในกล่องโต้ตอบที่ปรากฎขึ้น ให้ทำตามขั้นตอนเหล่านี้:

    1. ในแผนภูมิ ให้เลือก **Text\\String**
    2. ในฟิลด์ **ชื่อ** ให้ป้อน **IBAN**
    3 เลือก **ตกลง**

10. เลือก **บันทึก**

มีการตั้งค่าคอนฟิกที่แต่ละรายการในไฟล์แยกวิเคราะห์ประกอบด้วยรหัส IBAN เท่านั้น

![การกำหนดค่าคอนฟิกของรูปแบบ รูปแบบการนําเข้าใบแจ้งยอดจากธนาคาร (ตัวอย่าง) ในหน้าตัวออกแบบรูปแบบ](../media/design-expressions-app-class-er-01.png)

## <a name="design-the-er-format-configuration--mapping-to-a-data-model"></a>การออกแบบการตั้งค่าคอนฟิกรูปแบบของ ER – การแม็ปไปยังแบบจำลองข้อมูล

การออกแบบการแม็ปรูปแบบของ ER ที่ใช้ข้อมูลจากไฟล์แยกวิเคราะห์เพื่อกรอกข้อมูลในแบบจำลองข้อมูล

1. บนหน้า **ตัวออกแบบรูปแบบ** บนแผงการดำเนินการ ให้เลือก **แม็ปรูปแบบสู่แบบจำลอง**
2. บนหน้า **การแม็ปแบบจำลองกับแหล่งข้อมูล** ให้เลือก **ใหม่** บนแผงดำเนินการ
3. ในฟิลด์ **คำนิยาม** ให้เลือก **BankToCustomerDebitCreditNotificationInitiation**
4. ในฟิลด์ **ชื่อ** ให้ป้อน **การแม็ปไปยังแบบจำลองข้อมูล**
5. เลือก **บันทึก**
6. เลือก **ตัวออกแบบ**
7. บนหน้า **ตัวออกแบบการแม็ปรูปแบบ** ในแผนภูมิ **ชนิดแหล่งข้อมูล** ให้เลือก **Dynamics 365 for Operations\\คลาส**
8. ในส่วน **แหล่งข้อมูล** ให้เลือก **Add root** เพื่อเพิ่มแหล่งข้อมูลที่เรียกตรรกะแอพลิเคชันที่มีอยู่เพื่อการตรวจสอบความถูกต้องของรหัส IBAN
9. ในกล่องโต้ตอบที่ปรากฎขึ้น ให้ทำตามขั้นตอนเหล่านี้:

    1. ในฟิลด์ **ชื่อ** ให้ป้อน **ตรวจสอบ\_รหัส**
    2. ในฟิลด์ **คลาส** ให้ป้อนหรือเลือก **ISO7064**
    3. เลือก **ตกลง**

10. ในแผนภูมิ **ชนิดของแหล่งข้อมูล** ให้ทำตามขั้นตอนดังนี้

    1. ขยาย **รูปแบบ** แหล่งข้อมูล
    2. ขยาย **รูปแบบ\\Root: ลำดับ(Root)**
    3. ขยาย **รูปแบบ\\Root: ลำดับ(Root)\\แถว: ลำดับ 1..\* (แถว)**
    4. ขยาย **รูปแบบ\\Root: ลำดับ(Root)\\แถว: ลำดับ 1..\* (แถว)\\ฟิลด์: ลำดับ 1..1 (ฟิลด์)**

11. ในแผนภูมิ **แบบจำลองข้อมูล** ให้ทำตามขั้นตอนดังนี้

    1. ขยายฟิลด์ **การชำระเงิน** ของแบบจำลองข้อมูล
    2. ขยาย **การชำระเงิน\\บัญชีเจ้าหนี้(CreditorAccount)**
    3. ขยาย **การชำระเงิน\\บัญชีเจ้าหนี้(CreditorAccount)\\บัตรประจำตัว**
    4. ขยาย **การชำระเงิน\\บัญชีเจ้าหนี้(CreditorAccount)\\บัตรประจำตัว\\IBAN**

12. ปฏิบัติตามขั้นตอนต่อไปนี้เพื่อผูกส่วนประกอบของรูปแบบที่ได้รับการกำหนดค่าคอนฟิกเข้ากับฟิลด์โมเดลแบบจำลองข้อมูล

    1. เลือก **รูปแบบ\\Root: ลำดับ(Root)\\แถว: ลำดับ 1..\* (แถว)**
    2. เลือก **การชำระเงิน**
    3. เลือก **ผูก** บนพื้นฐานของการตั้งค่านี้ แต่ละรายการในไฟล์แยกวิเคราะห์จะถูกพิจารณาให้เป็นเรกคอร์ดเดี่ยว
    4. เลือก **รูปแบบ\\Root: ลำดับ(Root)\\แถว: ลำดับ 1..\* (แถว)\\ฟิลด์: ลำดับ 1..1 (ฟิลด์)\\IBAN: สตริง(IBAN)**
    5. เลือก **การชำระเงิน\\บัญชีเจ้าหนี้(CreditorAccount)\\บัตรประจำตัว\\IBAN**
    6. เลือก **ผูก** บนพื้นฐานของการตั้งค่านี้ ฟิลด์ **IBAN** ของแบบจำลองข้อมูลจะถูกเติมด้วยค่าจากไฟล์แยกวิเคราะห์

    ![การผูกส่วนประกอบรูปแบบกับฟิลด์แบบจำลองข้อมูลในหน้าตัวออกแบบการแม็ปแบบแบบจำลอง](../media/design-expressions-app-class-er-02.png)

13. บนแท็บ **การตรวจสอบความถูกต้อง** ให้ปฏิบัติตามขั้นตอนต่อไปนี้เพื่อเพิ่ม [การตรวจสอบความถูกต้อง](../general-electronic-reporting-formula-designer.md#Validation) กฎที่แสดงข้อความที่ผิดพลาดในรายการใด ๆ ในไฟล์แยกวิเคราะห์ที่มีรหัส IBAN ที่ไม่ถูกต้อง

    1. เลือก **ใหม่** แล้วเลือก **แก้ไขเงื่อนไข**
    2. บนหน้า **ตัวออกแบบสูตร** ในแผนภูมิ **แหล่งข้อมูล** ให้ขยาย **ตรวจสอบ\_รหัส** ของแหล่งข้อมูลที่แสดงคลาสของแอพลิเคชัน **ISO7064** เพื่อดูวิธีการที่พร้อมใช้งานของคลาสนี้
    3. เลือก **ตรวจสอบ\_รหัส\\ตรวจสอบความถูกต้องMOD1271\_36**
    4. เลือก **เพิ่มแหล่งข้อมูล**
    5. ในฟิลด์ **สูตร** ให้ป้อนข้อมูลตามนี้ [แสดงผล](../general-electronic-reporting-formula-designer.md#Binding): **ตรวจสอบ\_รหัส.ตรวจสอบความถูกต้องMOD1271\_36(รูปแบบ.Root.Rows.Fields.IBAN)**
    6. เลือก **ตกลง** และจากนั้นปิดหน้า
    7. เลือก **แก้ไขข้อความ**
    8. ในหน้า **ตัวออกแบบสูตร** ในฟิลด์ **สูตร** ให้ป้อน **CONCATENATE("Invalid IBAN code has been found:&nbsp;", format.Root.Rows.Fields.IBAN)**
    9. เลือก **ตกลง** และจากนั้นปิดหน้า

    บนพื้นฐานของการตั้งค่าเหล่านี้ เงื่อนไขในการตรวจสอบจะส่ง *[เท็จ](../er-formula-supported-data-types-primitive.md#boolean)* กลับสำหรับรหัส IBAN ใดๆ ที่ไม่ถูกต้อง โดยการเรียกวิธีการ **verifyMOD1271\_36** ที่มีอยู่ของคลาสแอพลิเคชัน **ISO7064** ให้สังเกตุว่า ค่าของรหัส IBAN ถูกกำหนดแบบพลวัตรขณะที่รันไทม์เป็นอาร์กิวเมนต์ของวิธีการเรียกวิธีการ โดยยึดตามเนื้อหาของไฟล์แยกวิเคราะห์ที่เป็นลายลักษณ์อักษร

    ![กฎการตรวจสอบความถูกต้องในหน้าตัวออกแบบการแม็ปแบบจำลอง](../media/design-expressions-app-class-er-03.png)

14. เลือก **บันทึก**
15. ปิดหน้า **ตัวออกแบบการแม็ปแบบจำลอง** แล้วปิดหน้า **การแม็ปแบบแบบจำลองกับแหล่งข้อมูล**

## <a name="run-the-format-mapping"></a>รันการแม็ปรูปแบบ

เพื่อเป็นการทดสอบวัตถุประสงค์ ให้รันการแม็ปรูปแบบโดยใช้ไฟล์ SampleIncomingMessage.txt ซึ่งคุณดาวน์โหลดไว้ก่อนหน้านี้ เอาท์พุทที่สร้างขึ้นจะรวมข้อมูลที่จะถูกนำเข้าจากไฟล์ตัวอักษรที่เลือกและย้ายไปยังแบบจำลองข้อมูลที่กำหนดเองในระหว่างการนำเข้าจริง

1. ในหน้า **การแม็ปแบบจำลองกับแหล่งข้อมูล** ให้เลือก **ดำเนินการ**
2. ในหน้า **พารามิเตอร์รายงานอิเล็กทรอนิกส์** ให้เลือก **เรียกดู** เรียกดูไฟล์ **SampleIncomingMessage.txt** ที่คุณได้ดาวน์โหลดไว้และเลือกไฟล์นั้น
3. เลือก **ตกลง**
4. โปรดสังเกตว่าหน้า **การแม็ปแบบจำลองกับแหล่งข้อมูล** จะแสดงข้อความที่ผิดพลาดเกี่ยวกับรหัส IBAN ที่ไม่ถูกต้อง

    ![ผลของการดำเนินงานการแม๊ปรูปแบบบนหน้าการแม็ปแบบจำลองกับแหล่งข้อมูล](../media/design-expressions-app-class-er-04.png)

5. ตรวจสอบเอาท์พุทในรูปแบบ XML ซึ่งแสดงข้อมูลที่ได้ถูกนำเข้าจากไฟล์ที่เลือก และถูกนำไปยังแบบจำลองข้อมูล โปรดสังเกตว่ามีเพียงสามบรรทัดของไฟล์ข้อความนำเข้าเท่านั้น ที่จะถูกประมวลผลโดยไม่มีข้อผิดพลาด รหัส IBAN ในบรรทัดที่ 4 จะไม่ถูกต้องและถูกข้ามไป

    ![XML เอาท์พุท](../media/design-expressions-app-class-er-05.png)

[!INCLUDE[footer-include](../../../../includes/footer-banner.md)]
