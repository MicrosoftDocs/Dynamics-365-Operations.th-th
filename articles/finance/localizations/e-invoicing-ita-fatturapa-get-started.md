---
title: ตั้งค่าการรวมโดยตรงของ FatturaPA ของอิตาลีกับ SDI
description: บทความนี้แสดงข้อมูลที่จะช่วยคุณเริ่มต้นด้วยการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์สำหรับอิตาลี และตั้งค่าการรวมโดยตรงของ FatturaPA ของอิตาลีกับระบบ Exchange (SDI)
author: abaryshnikov
ms.date: 07/27/2022
ms.topic: article
audience: Application User, Developer
ms.reviewer: kfend
ms.search.region: Global
ms.author: abaryshnikov
ms.search.validFrom: 2021-10-18
ms.dyn365.ops.version: AX 10.0.20
ms.openlocfilehash: 363b7b5e3d5abbb990fea8f8ad4d0c1bebf80102
ms.sourcegitcommit: 6d9fcb52d723ac5022a3002e0ced8e7b56e9bc2a
ms.translationtype: HT
ms.contentlocale: th-TH
ms.lasthandoff: 07/27/2022
ms.locfileid: "9203183"
---
# <a name="set-up-direct-integration-of-italian-fatturapa-with-sdi"></a>ตั้งค่าการรวมโดยตรงของ FatturaPA ของอิตาลีกับ SDI

[!include [banner](../includes/banner.md)]

> [!IMPORTANT]
> การออกใบแจ้งหนี้อิเล็กทรอนิกส์สำหรับอิตาลีอาจไม่สนับสนุนฟังก์ชันทั้งหมดที่พร้อมใช้งานสำหรับใบแจ้งหนี้อิเล็กทรอนิกส์ใน Microsoft Dynamics 365 Finance และ Dynamics 365 Supply Chain Management ในขณะนี้

บทความนี้จะให้ข้อมูลซึ่งจะช่วยคุณในการเริ่มต้นใช้งานการออกใบแจ้งหนี้อิเล็กทรอนิกส์สำหรับอิตาลีใน Finance และ Supply Chain Management โดยจะแนะนำให้คุณทราบถึงขั้นตอนการตั้งค่าคอนฟิกที่มีประเทศ/ภูมิภาคขึ้นอยู่กับใน Regulatory Configuration Services (RCS) ขั้นตอนเหล่านี้เพิ่มเติมเกี่ยวกับขั้นตอนที่อธิบายไว้ใน [เริ่มต้นใช้งานด้วยการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์](e-invoicing-get-started.md)

## <a name="prerequisites"></a>ข้อกำหนดเบื้องต้น

ก่อนที่คุณจะสามารถทำขั้นตอนให้เสร็จสมบูรณ์ในบทความนี้ ต้องเป็นไปตามข้อกำหนดเบื้องต้นต่อไปนี้:

- ปฏิบัติตามขั้นตอนใน [เริ่มต้นใช้งานการออกใบแจ้งหนี้อิเล็กทรอนิกส์](e-invoicing-get-started.md)
- นําเข้าคุณลักษณะการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์ **FatturaPA (IT) ของอิตาลี** ลงใน RCS จากที่เก็บส่วนกลาง สำหรับข้อมูลเพิ่มเติม ดูที่ส่วน [นําเข้าคุณลักษณะการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์จากผู้ให้บริการการตั้งค่าคอนฟิกของ Microsoft](e-invoicing-get-started.md#import-an-electronic-invoicing-feature-from-the-microsoft-configuration-provider) ในบทความ "เริ่มต้นใช้งานการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์"
- เพิ่มลิงก์จากใบรับรองที่ต้องการลงในสภาพแวดล้อมบริการ ใบรับรองที่ต้องใช้ ได้แก่ ใบรับรองลายเซ็นดิจิทัล ผู้ให้บริการออกใบรับรอง (CA) และใบรับรองของไคลเอนต์ สำหรับข้อมูลเพิ่มเติม ให้ดูที่ส่วน [สร้างข้อมูลลับของใบรับรองดิจิทัล](e-invoicing-get-started-service-administration.md#create-a-digital-certificate-secret) ของบทความ "เริ่มต้นใช้งานการจัดการบริการการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์"

## <a name="country-specific-configuration-for-the-italian-fatturapa-it-electronic-invoicing-feature"></a>การกำหนดค่าคอนฟิกเฉพาะประเทศสำหรับคุณลักษณะการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์ FatturaPA (IT) ของอิตาลี

ปฏิบัติตามกระบวนงานต่อไปนี้ให้เสร็จสิ้น ก่อนที่คุณจะปรับใช้การตั้งค่าแอป Finance หรือ Supply Chain Management ที่เชื่อมต่อของคุณ

ส่วนนี้จะเสริมส่วน [การตั้งค่าคอนฟิกเฉพาะประเทศของการตั้งค่าแอปพลิเคชัน](e-invoicing-get-started.md#country-specific-configuration-of-application-setup) ของบทความ "เริ่มต้นใช้งานการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์"

### <a name="create-a-new-feature"></a>สร้างคุณลักษณะใหม่

1. ลงชื่อเข้าใช้ RCS
2. ในพื้นที่ทำงาน **การรายงานทางอิเล็กทรอนิกส์** ในส่วน **ผู้ให้บริการการตั้งค่าคอนฟิก** ให้กําหนดผู้ให้บริการการตั้งค่าคอนฟิกของบริษัทของคุณว่าใช้งานอยู่
3. ในพื้นที่ทำงาน **คุณลักษณะที่ใช้ทั่วโลก** ในส่วน **คุณลักษณะ** เลือกไทล์ **การออกใบแจ้งหนี้อิเล็กทรอนิกส์**
4. บนหน้า **คุณลักษณะการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์** ให้เลือก **เพิ่ม** \> **ตามคุณลักษณะที่มีอยู่**
5. ภายใต้ **ผู้ให้บริการการตั้งค่าคอนฟิก Microsoft** ให้เลือก **FatturaPA (IT) ของอิตาลี** เป็นคุณลักษณะพื้นฐาน ป้อนชื่อ แล้วเลือก **สร้างคุณลักษณะ**

### <a name="set-up-application-specific-parameters"></a>ตั้งค่าพารามิเตอร์เฉพาะแอปพลิเคชัน

1. บนหน้า **คุณลักษณะการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์** ให้เลือกคุณลักษณะที่จะแก้ไข
2. บนแท็บ **เวอร์ชัน** ตรวจสอบว่าเวอร์ชัน **ดราฟท์** ได้ถูกเลือก
3. บนแท็บ **การตั้งค่าคอนฟิก** เลือกการตั้งค่าคอนฟิก แล้วเลือก **พารามิเตอร์เฉพาะแอปพลิเคชัน**
4. ในส่วน **การค้นหา** โปรดตรวจสอบให้แน่ใจว่ามีการเลือกการค้นหา **รายการของประเภทย่อยของค่าธรรมเนียมย้อนกลับ**
5. ในส่วน **เงื่อนไข** ให้เลือก **เพิ่ม**
6. เพิ่มเงื่อนไขเฉพาะให้กับประเภทย่อยแต่ละประเภทที่กําหนดไว้ในระบบ แล้วบันทึกการเปลี่ยนแปลงของคุณ

    > [!NOTE]
    > ในคอลัมน์ **ชื่อ** คุณสามารถเลือกค่าตัวยึด **\*ว่างเปล่า\*** หรือ **\*ไม่ว่างเปล่า\*** แทนค่าที่ระบุ

### <a name="configure-a-processing-pipeline-for-export"></a>ตั้งค่าคอนฟิกไปป์ไลน์การประมวลผลสำหรับการส่งออก

1. บนหน้า **คุณลักษณะการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์** ให้เลือกคุณลักษณะที่จะแก้ไข
2. บนแท็บ **การตั้งค่า** ให้เลือก **ใบแจ้งหนี้การขาย** แล้วจากนั้น เลือก **แก้ไข**
3. ในส่วน **ไปป์ไลน์การประมวลผล** ให้ไปที่การกระบวนการต่างๆ และตั้งค่าฟิลด์ที่ต้องใช้ทั้งหมดดังนี้:

    - สำหรับการดำเนินการ **ลงชื่อในเอกสาร** ในฟิลด์ **ชื่อใบรับรอง** ให้ระบุใบรับรองลายเซ็นดิจิทัล
    - สำหรับการดำเนินการ **ส่ง** ตั้งค่าฟิลด์ **ที่อยู่ URL** และ **ใบรับรอง** ค่าของฟิลด์ **ใบรับรอง** คือกลุ่มใบรับรอง กลุ่มแรกคือใบรับรอง CA ราก (caentrate.cer) และกลุ่มที่สองคือใบรับรองของไคลเอนต์

4. ในส่วน **กฎการใช้งาน** ให้ไปที่อนุประโยค และตรวจทานหรือตั้งค่าฟิลด์ที่ต้องใช้ดังนี้
    - ตรวจสอบอนุประโยค **LegalEntityID** และอัปเดตด้วยค่าที่ถูกต้องจากนิติบุคคลของคุณ

5. เลือก **ตรวจสอบความถูกต้อง** เพื่อให้แน่ใจว่าได้ตั้งค่าฟิลด์ที่ต้องใช้ทั้งหมดแล้ว
6. บันทึกการเปลี่ยนแปลงของคุณ และปิดหน้า
7. บนแท็บ **การตั้งค่า** ให้เลือก **ใบแจ้งหนี้โครงการ** แล้วจากนั้น เลือก **แก้ไข**
8. ทําซ้ำขั้นตอนที่ 3 ถึง 6 ของใบแจ้งหนี้โครงการ

### <a name="configure-the-processing-pipeline-for-import"></a>ตั้งค่าคอนฟิกไปป์ไลน์การประมวลผลสำหรับการนำเข้า

1. บนหน้า **คุณลักษณะการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์** ให้เลือกคุณลักษณะที่จะแก้ไข
2. บนแท็บ **การตั้งค่า** ให้เลือก **นำเข้าใบแจ้งหนี้** แล้วจากนั้น เลือก **แก้ไข**
3. ในส่วน **ช่องทางข้อมูล** บนแท็บ **พารามิเตอร์** ในฟิลด์ **ช่องทางข้อมูล** ให้ป้อนค่าสตริง
4. บนแท็บ **กฎการนำไปใช้ได้** ให้ตั้งค่าฟิลด์ของการตั้งค่า คุณสามารถใช้อนุประโยค **ช่องทาง** เริ่มต้นโดยส่งผ่านค่าที่คุณตั้งค่าไว้ให้กับฟิลด์ **ช่องทางข้อมูล** ในขั้นตอนก่อนหน้านี้ไปยังฟิลด์ **ค่า**

    ![การตั้งค่ากฎการบังคับใช้](media/e-invoicing-ita-fatturapa-get-started-apprules-setup.png)

5. เลือก **ตรวจสอบความถูกต้อง** เพื่อให้แน่ใจว่าได้ตั้งค่าฟิลด์ที่ต้องใช้ทั้งหมดแล้ว

### <a name="deploy-the-feature"></a>ปรับใช้งานคุณลักษณะ

1. ทำให้เสร็จสมบูรณ์ เผยแพร่และปรับใช้คุณลักษณะกับสภาพแวดล้อมบริการ สำหรับข้อมูลเพิ่มเติม ดูที่ส่วน [ปรับใช้คุณลักษณะการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์กับสภาพแวดล้อมบริการ](e-invoicing-get-started.md#deploy-the-electronic-invoicing-feature-to-service-environment) ของบทความ "เริ่มต้นใช้งานการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์"
2. ปรับใช้คุณลักษณะกับแอปพลิเคชันที่เชื่อมต่อ สำหรับข้อมูลเพิ่มเติม ดูที่ส่วน [ปรับใช้คุณลักษณะการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์กับแอปพลิเคชันที่เชื่อมต่อ](e-invoicing-get-started.md#deploy-the-electronic-invoicing-feature-to-connected-application) ของบทความ "เริ่มต้นใช้งานการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์"

### <a name="set-up-finance"></a>ตั้งค่า Finance

1. ลงชื่อเข้าใช้สภาพแวดล้อม Finance ของคุณ
2. ในพื้นที่ทำงาน **รายงานอิเล็กทรอนิกส์** ในส่วน **ผู้ให้บริการการตั้งค่าคอนฟิก** ให้เลือก **Microsoft**
3. เลือก **ที่เก็บ** \> **ส่วนกลาง** \> **เปิด**
4. เลือกและนําเข้าการตั้งค่าคอนฟิก **แบบจำลองบริบทใบแจ้งหนี้ของลูกค้า** และ **การนําเข้าใบแจ้งหนี้ของผู้จัดจำหน่าย (IT)**
5. ไปที่ **การจัดการองค์กร** \> **การตั้งค่า** \> **พารามิเตอร์เอกสารอิเล็กทรอนิกส์**
6. บนแท็บ **คุณลักษณะ** ให้ค้นหาและเลือกคุณลักษณะ **ใบแจ้งหนี้อิเล็กทรอนิกส์ของอิตาลี** แล้วเลือกกล่องกาเครื่องหมาย **เปิดใช้งาน**
7. บนแท็บ **เอกสารอิเล็กทรอนิกส์** โปรดตรวจสอบให้แน่ใจว่าฟิลด์สำหรับ **สมุดรายวันใบแจ้งหนี้ของลูกค้า** และ **ใบแจ้งหนี้โครงการ** มีการตั้งค่าตามข้อมูลใน [ตั้งค่าคอนฟิกการตั้งค่าแอปพลิเคชัน](e-invoicing-get-started.md#configure-the-application-setup)

### <a name="set-up-vendor-invoice-import"></a>ตั้งค่าการนำเข้าใบแจ้งหนี้ของผู้จัดจำหน่าย 

1. ใน Finance ในพื้นที่ทำงาน **การรายงานทางอิเล็กทรอนิกส์** ในส่วน **ผู้ให้บริการการตั้งค่าคอนฟิก** ให้กําหนดผู้ให้บริการการตั้งค่าคอนฟิกของบริษัทของคุณว่าใช้งานอยู่
2. เลือก **การตั้งค่าคอนฟิกการรายงาน**
3. เลือก **แบบจำลองบริบทใบแจ้งหนี้ของลูกค้า** และจากนั้นเลือก **สร้างการตั้งค่าคอนฟิก**
4. เลือก **ได้รับมาจากชื่อ: บริบทใบแจ้งหนี้ของลูกค้า Microsoft** เพื่อสร้างการตั้งค่าคอนฟิกที่ได้รับ
5. ในรุ่น **แบบร่าง** ให้เลือก **ผู้ออกแบบ**
6. ในแผนภูมิ **รูปแบบข้อมูล** ให้เลือก **แมปแบบจำลองกับแหล่งข้อมูล**
7. ในแผนภูมิ **คำนิยาม** ให้เลือก **DataChannel** แล้วจากนั้น เลือก **ผู้ออกแบบ**
8. ในแผนภูมิ **แหล่งข้อมูล** ให้ขยายคอนเทนเนอร์ **\$บริบท\_ช่องทาง**
9. ในฟิลด์ **ค่า** ให้เลือก **แก้ไข** 
10. ป้อนชื่อของช่องทางข้อมูล ชื่อควรมีอักขระสูงสุดไม่เกิน 10 อักขระ ซึ่งควรตรงกับค่าของพารามิเตอร์ **ช่องทางข้อมูล** ของช่องทางข้อมูลสำหรับคุณลักษณะการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์ใน RCS
11. บันทึกการเปลี่ยนแปลงของคุณ แล้วไปที่ **การตั้งค่าคอนฟิกการรายงาน** \> **ทำรุ่นการตั้งค่าคอนฟิกให้เสร็จสมบูรณ์**
12. บนแท็บ **ช่องทางภายนอก** ในส่วน **ช่องทาง** ให้เลือก **เพิ่ม**
13. ในฟิลด์ **ช่องทาง** ให้ป้อนค่า **\$ช่องทางบริบท**
14. ป้อนค้าในฟิลด์ **คำอธิบาย** และ **บริษัท**
15. ในฟิลด์ **บริบทเอกสาร** ให้เลือกการตั้งค่าคอนฟิกที่คุณได้รับมาใหม่จาก **แบบจำลองบริบทใบแจ้งหนี้ของลูกค้า** คำอธิบายการแมปควรเป็น **บริบทช่องทางข้อมูล**
16. บนแท็บ **นําเข้าแหล่งที่มา** เลือก **เพิ่ม** และจากนั้นตั้งค่าต่อไปนี้:

    - **ชื่อ:** OutputFile
    - **ชื่อเอนทิตีข้อมูล:** ส่วนหัวของใบแจ้งหนี้ของผู้จัดจำหน่าย (**เอนทิตีข้อมูล:** VendorInvoiceHeaderEntity)
    - **การแมปแบบจำลอง:** นําเข้าใบแจ้งหนี้ของผู้จัดจำหน่าย (IT)

> [!NOTE]
> ถ้าคุณมีการนําเข้าใบแจ้งหนี้ของผู้จัดจำหน่ายจากแหล่งที่มาต่างๆ คุณสามารถสร้างช่องทางภายนอกหลายช่องทาง และการตั้งค่าคอนฟิกที่ได้รับมาหลายค่ามีค่า **\$ช่องทางบริบท** ที่แตกต่างกัน ตัวอย่างเช่น คุณอาจต้องการนําเข้าใบแจ้งหนี้ของผู้จัดจำหน่ายสำหรับนิติบุคคลต่างๆ

## <a name="proxy-server-setup"></a>การตั้งค่าพร็อกซีเซิร์ฟเวอร์

ส่วนนี้แสดงข้อมูลที่จะช่วยคุณตั้งค่าและตั้งค่าคอนฟิกบริการพร็อกซีเพื่อการสื่อสารระหว่างระบบ Exchange (SDI) และบริการการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์

### <a name="create-an-app-registration"></a>สร้างการลงทะเบียนแอป

1. ใช้สคริปต์ Windows PowerShell ต่อไปนี้เพื่อสร้างใบรับรองที่มีการลงชื่อด้วยตนเองสำหรับการรับรองความถูกต้องแบบบริการต่อบริการ (S2S)

    ```powershell
    $certOutputLocation = "C:\certs\proxytest"
    $certName = "sdiProxyClientS2SCert"
    $certPassword = "123"

    $certCerFile = Join-Path $certOutputLocation "$certName.cer"
    $certPfxFile = Join-Path $certOutputLocation "$certName.pfx"

    $securePassword = ConvertTo-SecureString $certPassword -AsPlainText -Force

    $cert = New-SelfSignedCertificate -KeyLength 2048 -KeyExportPolicy Exportable -FriendlyName "CN=$certName" -CertStoreLocation Cert:\CurrentUser\My -Subject $certName -Provider "Microsoft Enhanced RSA and AES Cryptographic Provider"

    Export-Certificate -Cert $cert -FilePath $certCerFile -type CERT | Out-Null
    Export-PfxCertificate -Cert $cert -FilePath $certPfxFile -Password $securePassword | Out-Null
    ```

2. บันทึกไฟล์ใบรับรอง .pfx ลงใน Key Vault แล้วลบสําเนาเฉพาะที่
3. เข้าสู่ระบบ [พอร์ทัล Azure](https://portal.azure.com) ในฐานะผู้ดูแลระบบ
4. สร้างการลงทะเบียนแอปสำหรับบริการพร็อกซี SDI

    1. ไปที่ **การลงทะเบียนแอป** สร้างการลงทะเบียน แล้วตั้งค่าต่อไปนี้:

        - **ชื่อ:** พร็อกซีไคลเอนต์ SDI
        - **ชนิดบัญชีที่ได้รับการสนับสนุน:** บัญชีในไดเรกทอรีองค์กรนี้เท่านั้น (ผู้เช่ารายเดียว)

    2. เลือก **ลงทะเบียน** แล้วเลือกการลงทะเบียนแอปที่คุณเพิ่งสร้างขึ้น
    3. ไปที่ **สิทธิ์ของ API** และเลือก **ให้การยินยอมแก่ผู้ดูแลระบบ**
    4. ไปที่ **ใบรับรองและข้อมูลลับ** เลือก **การอัปโหลดใบรับรอง** และอัปโหลดไฟล์ใบรับรอง .cer สำหรับการรับรองความถูกต้อง S2S
    5. ไปที่ **แอปพลิเคชันขององค์กร** และเลือกแอปที่คุณสร้างขึ้น
    6. บันทึก **รหัสแอปพลิเคชัน** (รหัสไคลเอนต์) และค่า **รหัสออบเจ็กต์** ของแอป
    7. ทีมงานบริการออกใบแจ้งหนี้ต้องให้สิทธิ์เข้าถึงบริการแก่แอป ส่งค่าของพารามิเตอร์ต่อไปนี้ไปยัง <D365EInvoiceSupport@microsoft.com>:

        - รหัสผู้เช่า AAD
        - รหัสสภาพแวดล้อม LCS
        - รหัสแอปพลิเคชัน
        - รหัสออบเจ็กต์

5. ใน RCS เพิ่มแอปไปยังรายการแอปพลิเคชันสำหรับสภาพแวดล้อมบริการของคุณ

    1. ไปที่ **คุณลักษณะที่ใช้ทั่วโลก** \> **สภาพแวดล้อม** \> **การออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์** \> **สภาพแวดล้อมบริการ** และเลือกสภาพแวดล้อมของคุณ
    2. ในส่วน **แอปพลิเคชัน** ให้เพิ่มแถวลงในกริด และป้อนชื่อและรหัสออบเจ็กต์ของแอป

        ![การเพิ่มแอปพลิเคชันในสภาพแวดล้อมการบริการ](media/e-invoicing-ita-fatturapa-get-started-add-app-to-env.png)

    3. เลือก **บันทึก** จากนั้น เลือก **เผผยแพร่**

### <a name="create-an-azure-virtual-machine"></a>สร้างเครื่องเสมือน Azure

1. ใน [พอร์ทัล Azure](https://portal.azure.com) ไปที่ **เครื่องเสมือน** แล้วเลือก **สร้างใหม่**
2. บนแท็บ **พื้นฐาน** ให้เลือกการสมัครใช้งานและกลุ่มทรัพยากรของคุณ ค่าควรเป็นการสมัครใช้งานและกลุ่มทรัพยากรที่เป็นที่ตั้งของ Key Vault และที่เก็บข้อมูล Blob ของคุณ
3. เลือกภูมิภาค ค่านี้ควรเป็นภูมิภาคที่ปรับใช้ในสภาพแวดล้อม Finance ของคุณ
4. เพิ่มชื่อผู้ใช้และรหัสผ่านของผู้ดูแลระบบ แล้วบันทึกลงใน Key Vault
5. ในฟิลด์ **เลือกพอร์ตขาเข้า** เลือก **HTTPS (443)** และ **RPD (3389)**

    > [!NOTE]
    > ขอแนะนำว่าคุณควรปิดใช้งานพอร์ต **RDP (3389)** เมื่อระบบเข้าสู่การทำงานจริง คุณสามารถเปิดใช้งานใหม่ได้ถ้าคุณต้องเชื่อมต่อกับเครื่องเสมือน (VM) เพื่อการแก้ไขปัญหาเบื้องต้น

    ![การตั้งค่าฟิลด์บนแท็บพื้นฐานเพื่อสร้าง Azure VM](media/e-invoicing-ita-fatturapa-get-started-create-vm-1.png)

6. บนแท็บ **ดิสก์** บน FastTab **ขั้นสูง** ให้เลือกกล่องกาเครื่องหมาย **ใช้ดิสก์ที่มีการจัดการ** ล้างกล่องกาเครื่องหมาย **ดิสก์ Eppingeral OS**

    ![การตั้งค่าฟิลด์บนแท็บดิสก์เพื่อสร้าง Azure VM](media/e-invoicing-ita-fatturapa-get-started-create-vm-2.png)

7. บนแท็บ **การสร้างเครือข่าย** ภายใต้ฟิลด์ **IP สาธารณะ** ให้เลือก **สร้างใหม่**

    ![การตั้งค่าฟิลด์บนแท็บการสร้างเครือข่ายเพื่อสร้าง Azure VM](media/e-invoicing-ita-fatturapa-get-started-create-vm-3.png)

8. ในกล่องโต้ตอบ **สร้างที่อยู่ IP สาธารณะ** ในกลุ่มฟิลด์ **SKU** เลือกตัวเลือก **มาตรฐาน** ในกลุ่มฟิลด์ **การกำหนด** ให้เลือกตัวเลือก **แบบคงที่**

    ![การสร้างที่อยู่ IP สาธารณะ](media/e-invoicing-ita-fatturapa-get-started-create-vm-4.png)

9. บนแท็บ **การจัดการ** ให้ล้างกล่องกาเครื่องหมาย **ปิดอัตโนมัติ** เพื่อปิดใช้งานการปิดอัตโนมัติ
10. ตั้งค่าฟิลด์ **การอัปเดต OS ของผู้เยี่ยมชม** เป็น **ด้วยตนเอง** แล้วตั้งค่านโยบายอื่นๆ
11. รีวิวและสร้าง VM
12. ใน VM ใหม่ ไปที่ **ข้อมูลประจำตัว** \> **กำหนดโดยระบบ** และตั้งค่าตัวเลือก **สถานะ** เป็น **เปิด**
13. อนุญาตการเข้าถึงให้ VM ไปยัง Key Vault

    1. ใน Key Vault ไปที่ **การควบคุมการเข้าถึง (IAM)** \> **การกำหนดบทบาท**
    2. เลือก **เพิ่มการกำหนดบทบาท** และจากนั้นตั้งค่าฟิลด์ต่อไปนี้:

        1. ในฟิลด์ **บทบาท** ให้ระบุ **ผู้ใช้ข้อมูลลับ Key Vault**
        2. ในฟิลด์ **กําหนดการเข้าถึงไปยัง** ให้ระบุ **เครื่องเสมือน**
        3. ในฟิลด์ **การสมัครใช้งาน** ให้ระบุการสมัครใช้งานของคุณ
        4. ในฟิลด์ **เลือก** ระบุ VM ของคุณ

    3. ไปที่ **นโยบายการเข้าถึง**
    4. เลือก **เพิ่มนโยบายการเข้าถึง** และจากนั้นตั้งค่าฟิลด์ต่อไปนี้:

        1. ในฟิลด์ **เงินต้นที่เลือก** ให้เลือก VM ของคุณ
        2. ในส่วน **ใบรับรอง** เลือกสิทธิ์ **รายการ** และ **รับ**

14. ใน [พอร์ทัล Azure](https://portal.azure.com) ไปที่ **ที่อยู่ IP สาธารณะ** และเลือกที่อยู่ IP ที่สร้างไว้ใน VM
15. ไปที่ **การตั้งค่าคอนฟิก** และตั้งค่าชื่อ Domain Name System (DNS)

### <a name="prepare-the-proxy-service-environment"></a>จัดเตรียมสภาพแวดล้อมบริการของพร็อกซี

ปฏิบัติตามขั้นตอนต่อไปนี้บนเครื่องที่โฮสต์บริการพร็อกซี

1. เชื่อมต่อกับ VM โดยใช้การเชื่อมต่อ Remote Desktop
2. เปิดคำสั่งใบรับรองในเครื่องคอมพิวเตอร์ของคุณ สำหรับข้อมูลเพิ่มเติม ดูที่ [วิธีการ: ดูใบรับรองที่มีคำสั่ง MMC](/dotnet/framework/wcf/feature-details/how-to-view-certificates-with-the-mmc-snap-in)
3. นําเข้าใบรับรอง **caentrate.cer** สำหรับการทำงานจริงและ **CAEntratetest.cer** สำหรับการทดสอบลงใน [ที่จัดเก็บหน่วยงานที่ออกใบรับรองหลักที่เชื่อถือได้](/dotnet/framework/wcf/feature-details/working-with-certificates#certificate-stores) (**CAEntratetest.cer** คือใบรับรอง CA รากที่หน่วยงานนี้ให้มา)
4. ในแผงควบคุม ให้เปิด **เปิดหรือปิดคุณลักษณะของ Windows** หรือไปที่ **Server Manager** \> **เพิ่มบทบาทและคุณลักษณะ** สำหรับระบบปฏิบัติการเซิร์ฟเวอร์ (OS) และเปิดคุณลักษณะ Internet Information Services (IIS):

    - เครื่องมือการจัดการเว็บ
        - คอนโซลการจัดการ IIS
    - บริการเวิลด์ไวด์เว็บ
        - คุณลักษณะการพัฒนาแอปพลิเคชัน
            - .NET Extensibility 4.7 (หรือ 4.8)
            - ASP
            - ASP.NET 4.7 (หรือ 4.8)
            - CGI
            - ส่วนขยาย ISAPI
            - ตัวกรอง ISAPI
        - คุณลักษณะ HTTP ทั่วไป
            - เอกสารเริ่มต้น
            - การเลือกดูไดเรกทอรี
            - ข้อผิดพลาด HTTP
            - เนื้อหาแบบคงที่
        - สภาพและการวินิจฉัย
            - การล็อก HTTP
            - การติดตาม
        - คุณลักษณะด้านประสิทธิภาพ
            - การบีบอัดเนื้อหาแบบคงที่
        - ความปลอดภัย
            - คำขอการกรอง

    ![เปิดคุณลักษณะ IIS](media/e-invoicing-ita-fatturapa-get-started-turnon-features.png)

### <a name="set-up-the-sdi-proxy-service-in-iis"></a>ตั้งค่าบริการพร็อกซี SDI ใน IIS

1. ใน Microsoft Dynamics Lifecycle Services (LCS) ไปที่ไลบรารีแอสเซทที่ใช้ร่วมกัน และเลือก **แพคเกจข้อมูล** เป็นชนิดสินทรัพย์
2. ค้นหา **พร็อกซี Sdi ของบริการการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์** และดาวน์โหลดไปยัง VM
3. ตั้งค่าคอนฟิกบริการ

    1. แตกไฟล์โฟลเดอร์เก็บถาวร **พร็อกซี Sdi บริการการออกใบแจ้งหนี้ทางอิเล็กทรอนิกส์** ที่คุณดาวน์โหลด
    2. ในโฟลเดอร์ **src\\FattureService** ให้เปิดไฟล์ **appsettings.json** และตั้งค่าพารามิเตอร์ต่อไปนี้:

        - **KeyVaultUri** – ระบุที่อยู่ของ Key Vault ที่จัดเก็บใบรับรองของไคลเอนต์สำหรับบริการการออกใบแจ้งหนี้
        - **TenantId** – ระบุรหัสเฉพาะสากล (GUID) ของผู้เช่าของลูกค้า
        - **EnvironmentId** – ระบุรหัสของสภาพแวดล้อม LCS
        - **ClientId** – ระบุรหัสแอปของการลงทะเบียนแอปบริการระหว่างกลางในผู้เช่าของลูกค้า
        - **ClientCertificateName** – ระบุชื่อของใบรับรอง S2S ใน Key Vault
        - **SecurityServiceClientOptions.Endpoint** – ระบุ URL ของบริการความปลอดภัย
        - **SecurityServiceClientOptions.Resource** – ระบุขอบเขตที่จะรับโทเคน
        - **InvoicingServiceClientOptions.Endpoint** – ระบุปลายทางของบริการการออกใบแจ้งหนี้ ค่านี้ควรเป็นปลายทางเดียวกับที่ใช้กับ RCS และ Finance
        - **InvoicingServiceClientOptions.ServiceEnvironmentId** – ระบุชื่อของสภาพแวดล้อมการบริการ ค่านี้ควรเป็นชื่อของสภาพแวดล้อม Finance ของคุณ
        - **NotificationsFolder** – ระบุโฟลเดอร์ที่จะบันทึกไฟล์การแจ้งเตือนขาเข้า

    3. ในไฟล์ **web.config** ให้ค้นหาบรรทัดต่อไปนี้ และเพิ่มรหัสประจำตัวของใบรับรองพร็อกซีเซิร์ฟเวอร์

        `<serviceCertificate findValue="[certificate thumbprint]" storeLocation="LocalMachine" storeName="My" x509FindType="FindByThumbprint">`

        > [!TIP]
        > เมื่อระบบเข้าสู่การทำงานจริง คุณสามารถเปลี่ยนค่าบางค่าในไฟล์ web.config เพื่อช่วยลดปริมาณข้อมูลล็อกที่รวบรวมไว้และช่วยประหยัดพื้นที่ดิสก์ได้ ในโหนด **\<system.diagnostics\>\<source\>** ให้เปลี่ยนค่าของ **switchValue** เป็น **Critical,Error** สำหรับข้อมูลเพิ่มเติม ให้ดูที่ [MS Service Trace Viewer](/dotnet/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe)

4. เปิด IIS Manager ในแผนภูมิทางด้านซ้าย ให้ยังคงอยู่ในโหนดราก ให้เลือก **ใบรับรองเซิร์ฟเวอร์** ที่ด้านขวา

    ![การเลือกใบรับรองบริการใน IIS Manager](media/e-invoicing-ita-fatturapa-get-started-proxy-cert-1.png)

5. เปิดเมนู และเลือก **นําเข้า**
6. ในกล่องโต้ตอบ **นําเข้าใบรับรอง** ในฟิลด์ **ไฟล์ใบรับรอง (.pfx)** ให้ระบุพาธของไฟล์ .pfx ของใบรับรองเซิร์ฟเวอร์พร็อกซี่

    ![การระบุไฟล์ใบรับรองของบริการพร็อกซี](media/e-invoicing-ita-fatturapa-get-started-proxy-cert-2.png)

7. เลือกค้างไว้ (หรือคลิกขวา) **ไซต์** แล้วเลือก **เพิ่มเว็บไซต์**
8. ในกล่องโต้ตอบ **เพิ่มเว็บไซต์** ในฟิลด์ **ชื่อไซต์** ให้ป้อนชื่อสำหรับไซต์นั้น
9. ในฟิลด์ **พาธจริง** ให้ชี้ไปที่โฟลเดอร์ **src\\FattureService**
10. ในฟิลด์ **ชนิดการผูก** เลือก **https**
11. ในฟิลด์ **ชื่อโฮสต์** ให้ระบุชื่อโฮสต์
12. ปล่อยให้ฟิลด์ **ที่อยู่ IP** และ **พอร์ต** เป็นค่าเริ่มต้น
13. ตรวจสอบให้แน่ใจว่ากล่องกาเครื่องหมาย **ต้องใช้การบ่งชี้ชื่อเซิร์ฟเวอร์** ไม่ถูกเลือกแล้ว เนื่องจาก SDI ไม่สนับสนุนเทคโนโลยีนั้น
14. ในฟิลด์ **ใบรับรอง SSL** ให้เลือกใบรับรองพร็อกซีเซิร์ฟเวอร์ที่คุณนําเข้า
15. ในฟิลด์ **พูลแอปพลิเคชัน** ให้ระบุพูลของไซต์ และตั้งชื่อกลุ่มของไซต์นั้น (ตัวอย่างเช่น **SdiAppPool)**

    ![การเพิ่มเว็บไซต์](media/e-invoicing-ita-fatturapa-get-started-proxy-iis-setup-1.png)

16. หลังจากที่คุณสร้างเว็บไซต์เสร็จสิ้นแล้ว ให้เปิดเมนูของ **การตั้งค่า SSL**

    ![เปิดเมนูของการตั้งค่า SSL](media/e-invoicing-ita-fatturapa-get-started-proxy-iis-setup-2.png)

17. เลือกกล่องกาเครื่องหมาย **ต้องการ SSL** จากนั้นในกลุ่มฟิลด์ **ใบรับรองของไคลเอนต์** ให้เลือกตัวเลือก **ต้องการ**

    ![การตั้งค่าคอนฟิกการตั้งค่า SSL](media/e-invoicing-ita-fatturapa-get-started-proxy-iis-setup-3.png)

18. เปิด **การเลือกดูไดเรกทอรี** และเลือก **เปิดใช้งาน**
19. ในเว็บเบราว์เซอร์ใดๆ ให้ไปที่ **serverDNS/TrasmissionreFatture.svc** หน้ามาตรฐานเกี่ยวกับบริการต้องปรากฏ

    ![การตรวจสอบบริการในเบราเซอร์](media/e-invoicing-ita-fatturapa-get-started-proxy-open-browser.png)

20. สร้างโฟลเดอร์ต่อไปนี้เพื่อจัดเก็บล็อกและไฟล์:

    - **C:\\Logs\\** – จัดเก็บล็อกไฟล์ที่นี่ ไฟล์เหล่านี้สามารถดูโดย [MS Service Trace Viewer](/dotnet/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe)
    - **C:\\Files\\** – จัดเก็บไฟล์การตอบสนองทั้งหมดที่นี่

21. ใน File Explorer ให้สิทธิ์เข้าถึง **บริการเครือข่าย** และ **IIS AppPool\\SdiAppPool** (หรือ **IIS AppPool\\DefaultAppPool** ถ้าคุณใช้กลุ่มเริ่มต้น) ไปยังโฟลเดอร์ **ล็อก** และ **ไฟล์**

    1. เลือกค้างไว้ (หรือคลิกขวา) ที่โฟลเดอร์หรึ่งๆ แล้วเลือก **คุณสมบัติ**
    2. ในกล่องโต้ตอบ **คุณสมบัติ** บนแท็บ **ความปลอดภัย** ให้เลือก **แก้ไข**
    3. เพิ่มผู้ใช้ถ้าไม่มีอยู่ในรายการ
    4. ทำซ้ำขั้นตอนที่ 1 ถึง 3 สำหรับโฟลเดอร์อื่น

    ![การเพิ่มสิทธิ์ให้กับผู้ใช้การบริการ](media/e-invoicing-ita-fatturapa-get-started-proxy-add-user.png)

## <a name="privacy-notice"></a>ประกาศความเป็นส่วนตัว 

การเปิดใช้งานคุณลักษณะ **ใบแจ้งหนี้อิเล็กทรอนิกส์ของอิตาลี** อาจต้องการให้มีการส่งข้อมูลที่จํากัด ข้อมูลนี้ประกอบด้วยรหัสทะเบียนภาษีขององค์กร ผู้ดูแลระบบสามารถเปิดใช้งานและปิดใช้งานคุณลักษณะใบแจ้งหนี้อิเล็กทรอนิกส์ของอิตาลี หากต้องการปิดใช้งานคุณลักษณะ ให้ทำตามขั้นตอนเหล่านี้

1. ไปที่ **การจัดการองค์กร** \> **การตั้งค่า** \> **พารามิเตอร์เอกสารอิเล็กทรอนิกส์**
2. บนแท็บ **คุณลักษณะ** เลือกแถวที่มี **ใบแจ้งหนี้อิเล็กทรอนิกส์ของอิตาลี** แล้วเลือก **ปิดใช้งานตอนนี้**

ข้อมูลที่นำเข้าจากระบบภายนอกเหล่านี้ไปยังบริการออนไลน์ของ Dynamics 365 อยู่ภายใต้ [คำชี้แจงสิทธิส่วนบุคคล](https://go.microsoft.com/fwlink/?LinkId=512132) ของเรา สำหรับข้อมูลเพิ่มเติม ให้ดูที่ส่วน "ประกาศเกี่ยวกับความเป็นส่วนตัว" ในเอกสารประกอบลักษณะเฉพาะของประเทศ/ภูมิภาค

## <a name="additional-resources"></a>ทรัพยากรเพิ่มเติม

- [ภาพรวมของการออกใบแจ้งหนี้อิเล็กทรอนิกส์](e-invoicing-service-overview.md)
- [เริ่มต้นใช้งานการจัดการบริการการออกใบแจ้งหนี้อิเล็กทรอนิกส์](e-invoicing-get-started-service-administration.md)
- [เริ่มต้นใช้งานการออกใบแจ้งหนี้อิเล็กทรอนิกส์](e-invoicing-get-started.md)

[!INCLUDE[footer-include](../../includes/footer-banner.md)]
