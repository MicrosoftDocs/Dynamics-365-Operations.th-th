---
title: "อัพเกรดข้อมูลในสภาพแวดล้อม Sandbox"
description: "หัวข้อนี้อธิบายวิธีการดำเนินการอัพเกรดข้อมูลจาก AX 2012 เป็น Dynamics 365 สำหรับการเงินและการดำเนินงานในสภาพแวดล้อม sandbox"
author: tariqbell
manager: AnnBe
ms.date: 06/16/2017
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-platform
ms.technology: 
audience: Developer, IT Pro
ms.reviewer: margoc
ms.search.scope: Operations, UnifiedOperations, Platform
ms.search.region: Global
ms.author: tabell
ms.search.validFrom: 2017-06-16
ms.dyn365.ops.version: Platform update 8
ms.translationtype: Human Translation
ms.sourcegitcommit: 6816e3820ab77c71bbf9bde4a068375448331671
ms.openlocfilehash: 7140bf740f37a5eb970a5103750a7095d12a33cc
ms.contentlocale: th-th
ms.lasthandoff: 06/15/2017

---

# <a name="data-upgrade-in-a-sandbox-environment"></a>อัพเกรดข้อมูลในสภาพแวดล้อม Sandbox

[!include[banner](../includes/banner.md)]

[!include[upgrade banner](../includes/upgrade-banner.md)]

ผลลัพธ์ของงานนี้คือ ฐานข้อมูลที่อัพเกรดที่คุณสามารถใช้ในสภาพแวดล้อม sandbox ได้ สภาพแวดล้อม sandbox เป็นสภาพแวดล้อมที่ผู้ใช้ทางธุรกิจและสมาชิกในทีมงานสามารถตรวจสอบฟังก์ชันแอพลิเคชันได้ ฟังก์ชันนี้รวมถึงการกำหนดเองและข้อมูลที่ถูกนำไปข้างหน้าจาก Microsoft Dynamics AX 2012

เราขอแนะนำให้ คุณรันกระบวนการอัพเกรดข้อมูลในสภาพแวดล้อมการพัฒนา ก่อนที่คุณจะรันในสภาพแวดล้อม sandbox ที่ใช้ร่วมกัน เนื่องจากวิธีการนี้จะช่วยลดเวลาทั้งหมดที่จำเป็นสำหรับการอัพเกรดข้อมูลที่เสร็จเรียบร้อยแล้ว สำหรับข้อมูลเพิ่มเติม ดู [การอัพเกรดข้อมูลในสภาพแวดล้อมการพัฒนา](prepare-data-upgrade.md)

## <a name="overview-of-the-sandbox-data-upgrade-process"></a>ภาพรวมของกระบวนการอัพเกรดข้อมูล sandbox

ก่อนที่คุณจะเริ่มต้นการอัพเกรดข้อมูลในสภาพแวดล้อม sandbox คุณจะได้อัพเกรดข้อมูลในสภาพแวดล้อมการพัฒนาแล้ว ตามที่อธิบายไว้ใน [การอัพเกรดข้อมูลในสภาพแวดล้อมการพัฒนา](prepare-data-upgrade.md) กระบวนการสองกระบวนการคล้ายกันมาก ๆ ความแตกต่างหลักคือ สภาพแวดล้อม sandbox ใช้ฐานข้อมูล SQL Microsoft Azure สำหรับที่จัดเก็บข้อมูล ในขณะที่สภาพแวดล้อมการพัฒนาใช้ Microsoft SQL Server ความแตกต่างทางเทคนิคนี้ในชั้นฐานข้อมูลจำเป็นต้องให้คุณปรับเปลี่ยนขั้นตอนการอัพเกรดข้อมูลในสภาพแวดล้อม sandbox เล็กน้อย เนื่องจากการสำรองข้อมูลจากอินสแตนซ์ฐานข้อมูล AX 2012 ไม่สามารถคืนค่าฐานข้อมูล SQL ได้

![กระบวนการอัพเกรดข้อมูล Sandbox](./media/data-upgrade-sandbox.png)

นี่เป็นขั้นตอนในระดับสูงในกระบวนการอัพเกรด

1. สร้างสำเนาของฐานข้อมูล AX 2012 เราขอแนะนำให้คุณใช้สำเนา เนื่องจากคุณต้องลบบางออบเจ็กต์ในสำเนาที่จะถูกส่งออก
2. ส่งออกฐานข้อมูลที่คัดลอกไปยังแฟ้ม bacpac โดยใช้เครื่องมือเซิร์ฟเวอร์ SQL อิสระที่มีชื่อว่า SQLPackage.exe เครื่องมือนี้แสดงชนิดพิเศษของการสำรองฐานข้อมูล ที่สามารถถูกนำเข้าลงในฐานข้อมูล SQL
3. อัพโหลดไฟล์ bacpac ไปยังที่จัดเก็บ Azure
4. ดาวน์โหลดไฟล์ bacpac ไปยังเครื่อง Application Object Server (AOS) ในสภาพแวดล้อม sandbox และนำเข้าโดยใช้ SQLPackage.exe จากนั้น คุณต้องรันสคริปต์ฐานข้อมูลที่นำเข้า เพื่อตั้งค่าผู้ใช้ฐานข้อมูล SQL ใหม่
5. เรียกใช้แพคเกจ MajorVersionDataUpgrade.zip เพื่อรันการอัพเกรดข้อมูลฐานข้อมูลที่นำเข้า

## <a name="create-a-copy-of-the-ax-2012-database"></a>สร้างสำเนาของฐานข้อมูล AX 2012

คุณต้องสร้างสำเนาของฐานข้อมูล AX 2012 ที่คุณกำลังปรับรุ่น เนื่องจากคุณต้องลบบางออบเจ็กต์จากฐานข้อมูล ออบเจ็กต์เหล่านี้รวมถึงผู้ใช้ที่ได้รับรองความถูกต้องของ Microsoft Windows ใด ๆ การเปลี่ยนแปลงเหล่านี้ทำให้ฐานข้อมูลที่ถูกปรับเปลี่ยนไม่สามารถใช้ได้สำหรับ AX 2012 ในระหว่างขั้นตอนนี้ คุณจะสร้างสำเนาของฐานข้อมูล และลบออบเจ็กต์เหล่านี้

ต้องทำขั้นตอนนี้โดยผู้ดูแลฐานข้อมูล (DBA) หรือบุคคลที่มีความรู้และประสบการณ์ที่ใกล้เคียง

ในการสร้างสำเนาฐานข้อมูล ทำสำเนาสำรองของฐานข้อมูลต้นฉบับ และคืนสภาพภายใต้ชื่อใหม่ ตรวจสอบให้แน่ใจว่า มีเนื้อที่เพียงพอสำหรับฐานข้อมูลทั้งสอง คุณสามารถสร้างสำเนาบนเซิร์ฟเวอร์อื่นได้ เวอร์ชันของอินสแตนซ์ SQL Server ที่เรียกใช้ฐานข้อมูล ไม่ใช่สิ่งสำคัญ

นี่เป็นตัวอย่างของรหัสที่สร้างสำเนาของฐานข้อมูล คุณต้องปรับเปลี่ยนตัวอย่างนี้เพื่อสะท้อนถึงชื่อของฐานข้อมูลเฉพาะของคุณ

    BACKUP DATABASE [AxDB] TO  DISK = N'D:\Backups\axdb_copyForUpgrade.bak' WITH NOFORMAT, NOINIT,  
    NAME = N'AxDB_copyForUpgrade-Full Database Backup', SKIP, NOREWIND, NOUNLOAD, COMPRESSION,  STATS = 10
    GO

    RESTORE DATABASE [AxDB_copyForUpgrade] FROM  DISK = N'D:\Backups\axdb_copyForUpgrade.bak'   WITH  FILE = 1,  
    MOVE N'AXDBBuild_Data' TO N'F:\MSSQL_DATA\AxDB_copyForUpgrade.mdf',  
    MOVE N'AXDBBuild_Log' TO N'G:\MSSQL_LOGS\AxDB_CopyForUpgrade.ldf',  
    NOUNLOAD,  STATS = 5

หลังจากที่มีการสร้างสำเนา รันสคริปต์ Transact-SQL (T-SQL) ต่อไปนี้
สิ่งที่ต้องทำ 

### <a name="export-the-copied-database-to-a-bacpac-file"></a>ส่งออกฐานข้อมูลที่คัดลอกไปยังไฟล์ bacpac

ส่งออกฐานข้อมูลที่คัดลอกไปยังแฟ้ม bacpac โดยใช้เครื่องมือ SQLPackage.exe ขั้นตอนนี้ควรจะกระทำโดย DBA หรือสมาชิกทีมงานที่มีความรู้ที่เทียบเท่า

จำเป็นอย่างยิ่งที่คุณต้องติดตั้งเวอร์ชันล่าสุดของ SQL Server Management Studio ก่อนที่คุณเริ่มต้นขั้นตอนนี้ ถึงแม้ว่า SQLPackage อยู่ในเวอร์ชันก่อนหน้าของ Management Studio จะไม่ทำงานอย่างถูกต้องสำหรับขั้นตอนนี้ ยกเว้นว่าคุณติดตั้งเวอร์ชันล่าสุดก่อน

ขั้นตอนนี้มีความสำคัญ เนื่องจากจะต้องมีการส่งออกอีกครั้งในระหว่างการหยุดทำงาน ก่อนการเริ่มใช้งานจริง นี่คือคำแนะนำบางอย่าง:

- กระบวนการ bacpac มีลักษณะ I/O และ CPU มาก ๆ ดังนั้น รันการส่งออกบนเครื่องจักรแรงสูง
- SQLPackage ควรถูกรันเฉพาะที่บนเครื่องที่โฮสต์ฐานข้อมูล อย่าเรียกใช้ SQLPackage บนแล็ปท็อปท้องถิ่นที่คุณเชื่อมต่อกับเครื่องฐานข้อมูล เนื่องจากกระบวนการนี้ใช้เครือข่ายมากเช่นกัน

ต่อไป เปิดหน้าต่าง **พร้อมท์คำสั่ง** ในโหมดผู้ดูแลระบบ และรันคำสั่งต่อไปนี้:

    cd C:\Program Files (x86)\Microsoft SQL Server\130\DAC\bin\

    SqlPackage.exe /a:export /ssn:localhost /sdn:<database to export> /tf:D:\Exportedbacpac\my.bacpac /p:CommandTimeout=1200 /p:VerifyFullTextDocumentTypesSupported=false

นี่เป็นคำอธิบายเกี่ยวกับพารามิเตอร์:

- **ssn** (ชื่อเซิร์ฟเวอร์แหล่งที่มา) – ชื่อของ SQL Server ที่จะส่งออกจาก สำหรับกระบวนการของเรา พารามิเตอร์นี้ควรจะถูกกำหนดเป็น **localhost**
- **sdn** (ชื่อฐานข้อมูลแหล่งที่มา) – ชื่อของฐานข้อมูลที่จะส่งออก
- **tf** (ไฟล์เป้าหมาย) – พาธและชื่อไฟล์ของไฟล์ที่จะส่งออกไป ควรมีโฟลเดอร์อยู่แล้ว แต่จะมีการสร้างไฟล์ตามกระบวนการ
- **/p:CommandTimeout** – ค่าการหมดเวลาสำหรับแต่ละแบบสอบถาม พารามิเตอร์นี้ทำให้ตารางที่มีขนาดใหญ่ขึ้นสามารถถูกส่งออกได้ โดยไม่กระทบกับการหมดเวลา

### <a name="upload-the-bacpac-file-to-azure-storage"></a>อัพโหลดไฟล์ bacpac ไปยังที่จัดเก็บ Azure

อัพโหลดไฟล์ bacpac ของคุณไปยังที่จัดเก็บ Azure ดู UsingStorageExplorer.docx TODO

### <a name="import-the-bacpac-file-into-sql-database"></a>นำเข้าไฟล์ bacpac ลงในฐานข้อมูล SQL

ในระหว่างขั้นตอนนี้ คุณจะนำเข้าไฟล์ bacpac ที่ส่งออกไปยังอินสแตนซ์ฐานข้อมูล SQL ที่สภาพแวดล้อม sandbox ของคุณใช้ คุณต้องติดตั้งเวอร์ชันล่าสุดของ Management Studio บนเครื่อง AOS sandbox ของคุณ จากนั้น คุณจะนำเข้าไฟล์ได้โดยใช้เครื่องมือ SQLPackage.exe

คุณต้องดำเนินการงานเหล่านี้ได้โดยตรงบนเครื่อง AOS ในสภาพแวดล้อม sandbox ของคุณ เนื่องจากมีกฎไฟร์วอลล์ที่จำกัดการเข้าถึงอินสแตนซ์ฐานข้อมูล SQL อย่างไรก็ตาม โดยการใช้เครื่องจักร AOS คุณสามารถเข้าถึงได้

เช่นเดียวกับขั้นตอนการส่งออก คุณต้องมี Management Studio เวอร์ชันล่าสุด ก่อนที่คุณเริ่มต้นการนำเข้า ขั้นตอนนี้จะไม่ทำงาน ถ้าคุณมีเวอร์ชันเก่ากว่า

สำหรับเหตุผลด้านประสิทธิภาพ เราขอแนะนำให้คุณใส่แฟ้ม bacpac ในไดรฟ์ D บนเครื่อง AOS บนเครื่องเสมือน Azure (VMs) ไดรฟ์ D คือ ดิสก์ทางกายภาพที่มีประสิทธิภาพสูงกว่าดิสก์อื่น ๆ ที่ใช้โดยทั่วไป

เปิดหน้าต่าง **พร้อมท์คำสั่ง** ในโหมดผู้ดูแลระบบ และรันคำสั่งต่อไปนี้:

    cd C:\Program Files (x86)\Microsoft SQL Server\130\DAC\bin\

    SqlPackage.exe /a:import /sf:D:\Exportedbacpac\my.bacpac /tsn:<azure sql database server name>.database.windows.net /tu:sqladmin /tp:<password from LCS> /tdn:<New database name> /p:CommandTimeout=1200 /p:DatabaseEdition=Premium /p:DatabaseServiceObjective=P1

นี่เป็นคำอธิบายเกี่ยวกับพารามิเตอร์:

- **tsn** (ชื่อเซิร์ฟเวอร์เป้าหมาย) – ชื่อของเซิร์ฟเวอร์ SQL Azure ที่จะนำเข้าไป ชื่อสามารถถูกพบได้ใน LCS ลงคำต่อท้ายด้วย **database.windows.net**
- **tdn** (ชื่อฐานข้อมูลเป้าหมาย) – ชื่อของฐานข้อมูลที่จะนำเข้า ฐานข้อมูลไม่ควรมีอยู่แล้ว กระบวนการนำเข้าจะสร้างขึ้น
- **sf** (ไฟล์แหล่งกำเนิด) – พาธและชื่อไฟล์ที่จะนำเข้ามาจาก
- **tp** (รหัสผ่านเป้าหมาย) – รหัสผ่าน SQL สำหรับอินสแตนซ์ฐานข้อมูล SQL เป้าหมาย
- **tu** (ผู้ใช้ผ่านเป้าหมาย) – ชื่อผู้ใช้ SQL สำหรับอินสแตนซ์ฐานข้อมูล SQL เป้าหมาย เราแนะนำให้คุณใช้ **sqladmin** คุณสามารถดึงข้อมูลรหัสผ่านของผู้ใช้รายนี้จากโครงการของคุณ LCS ได้
- **/p:CommandTimeout** – ค่าการหมดเวลาสำหรับแต่ละแบบสอบถาม พารามิเตอร์นี้ทำให้ตารางที่มีขนาดใหญ่ขึ้นสามารถถูกส่งออกได้ โดยไม่กระทบกับการหมดเวลา
- **/p:DatabaseServiceObjective** – ระดับชั้นบริการของฐานข้อมูลที่ถูกสร้างขึ้น คุณสามารถตรวจสอบค่าสำหรับฐานข้อมูลที่มีอยู่ โดยใช้ Management Studio ได้ คลิกขวาที่ฐานข้อมูล แล้วเลือก  **คุณสมบัติ**

หลังจากที่คุณรันคำสั่ง คุณจะได้รับคำเตือนต่อไปนี้ คุณสามารถละเว้นได้อย่างปลอดภัย

![ข้อผิดพลาด sandbox](./media/sandbox-2.png)
 
### <a name="run-the-majorversiondataupgradezip-package"></a>เรียกใช้แพคเกจ MajorVersionDataUpgrade.zip

เรียกใช้แพคเกจที่สามารถปรับใช้ได้ในการอัพเกรดข้อมูลตามที่อธิบายไว้ใน [อัพเกรดข้อมูลในสภาพแวดล้อมการพัฒนา สาธิต หรือ sandbox](upgrade-data-to-latest-update.md)

### <a name="upgrade-a-copy-of-the-database-in-a-development-environment"></a>อัพเกรด - สำเนาของฐานข้อมูลในสภาพแวดล้อมการพัฒนา

ซึ่งเป็นประโยชน์ที่จะอัพเกรดฐานข้อมูลเดียวกันในสภาพแวดล้อมการพัฒนา ถ้าคุณมีสำเนาของฐานข้อมูลพร้อมใช้งานสำหรับสภาพแวดล้อมการพัฒนา จะง่ายกว่ามากในการสืบหาบักที่ถูกพบในสภาพแวดล้อม sandbox ที่อัพเกรดแล้ว

